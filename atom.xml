<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>lie on this ip ，I am lin</title>
  
  <subtitle>Technical blog</subtitle>
  <link href="//atom.xml" rel="self"/>
  
  <link href="babylovelin.github.io/"/>
  <updated>2018-08-22T00:04:26.396Z</updated>
  <id>babylovelin.github.io/</id>
  
  <author>
    <name>lin</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Es5Basis-2</title>
    <link href="babylovelin.github.io/2018/08/22/Es5Basis-2/"/>
    <id>babylovelin.github.io/2018/08/22/Es5Basis-2/</id>
    <published>2018-08-21T23:09:29.000Z</published>
    <updated>2018-08-22T00:04:26.396Z</updated>
    
    <content type="html"><![CDATA[<h2 id="表达式和运算符"><a href="#表达式和运算符" class="headerlink" title="表达式和运算符"></a>表达式和运算符</h2><h4 id="原始表达式"><a href="#原始表达式" class="headerlink" title="原始表达式"></a>原始表达式</h4><p><code>true //返回布尔值 真false //返回布尔值 假null //返回值 空this //返回当前对象</code></p><p>在一个方法体内，this返回调用这个方法的对象。</p><h4 id="函数表达式"><a href="#函数表达式" class="headerlink" title="函数表达式"></a>函数表达式</h4><p>函数表达式可以称为‘函数直接量’，</p><p><code>var square = function(){  return x*x;}</code></p><p><code>+</code> 运算符</p><p><code>1 + 2 = 3;&#39;1&#39; + &#39;2&#39; = &#39;12&#39;;&#39;hello&#39; + 1 = &#39;hello1&#39;;&#39;12&#39; + 1 = &#39;121&#39;</code></p><p><code>in</code>运算符</p><p><code>var data = [7,8,9];&#39;0&#39; in data //true1 in data //true3 in data //false</code></p><p>这里 in 前面的值，是键</p><p><code>instanceof</code>运算符</p><p>左操作数是一个对象，右操作数标识对象的类。</p><p>如果左侧对象是右侧类的实例，则返回true</p><p>所有对象都是object的实例。</p><p>为了计算 <code>0 in f</code> js首先计算f.prototype,然后在原型链中查找o，如果找到，那么o是f的实例。</p><p>如果 f.prototype不在o的原型链中，那么o不是f的实例。</p><h4 id="表达式计算"><a href="#表达式计算" class="headerlink" title="表达式计算"></a>表达式计算</h4><p>jiavascript可以解释运行由javascript源码组成的字符串，并产生一个值。通过全局函数<code>eval()</code></p><p><code>eval(&quot;3+2&quot;)  //5</code></p><p>eval 只有一个参数，如果传入的不是字符串，将直接返回这个参数，如果参数是字符串，会进行编译，编译失败会抛出错误。</p><p>eval使用了调用它的变量作用域环境。</p><p><code>全局eval()</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;表达式和运算符&quot;&gt;&lt;a href=&quot;#表达式和运算符&quot; class=&quot;headerlink&quot; title=&quot;表达式和运算符&quot;&gt;&lt;/a&gt;表达式和运算符&lt;/h2&gt;&lt;h4 id=&quot;原始表达式&quot;&gt;&lt;a href=&quot;#原始表达式&quot; class=&quot;headerlink&quot; ti
      
    
    </summary>
    
    
      <category term="js" scheme="babylovelin.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>Es5Basis-1</title>
    <link href="babylovelin.github.io/2018/08/15/Es5Basis-1/"/>
    <id>babylovelin.github.io/2018/08/15/Es5Basis-1/</id>
    <published>2018-08-14T23:16:29.000Z</published>
    <updated>2018-08-16T23:58:28.825Z</updated>
    
    <content type="html"><![CDATA[<h2 id="词法结构"><a href="#词法结构" class="headerlink" title="词法结构"></a>词法结构</h2><p>1 js区分大小写，html不区分大小写</p><h2 id="类型，值，变量"><a href="#类型，值，变量" class="headerlink" title="类型，值，变量"></a>类型，值，变量</h2><p>1 js数据类型分为原始类型和对象类型。</p><p>  原始类型包括：数字，字符串，bool，null，undefined</p><p>  对象：是属性的集合。 <code>普通对象</code>是“命名值”的无序集合， <code>数组</code>是带编号的值的有序集合。  <code>函数</code>是具有与他相关联的可执行代码的对象。</p><p>  如果用函数来初始化一个新建的对象（new），称之为<code>构造函数（constructor）</code>。每个构造函数定义了一类<code>class</code>对象（由构造函数初始化的对象组成的集合）。</p><p>  除了数组类，函数类，还有日期类，正则类，错误类。</p><h2 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h2><p>1 非数字值，NaN，和任何值都不相等，包括自身。 <code>isNaN()</code>参数为NaN或者一个非数字值时返回true</p><p>2 <code>isFinite()</code> 参数不是NaN，Infinity或-Infinity时返回true</p><p>3 js可以精确表示1/2,1/8,1/1024,不能精确表示1/10类似0.1这种简单的数字。</p><p>  <code>.3-.2 != .2-.1</code>,所以一般计算金融，使用整数分，而不是小数元。</p><h2 id="文本"><a href="#文本" class="headerlink" title="文本"></a>文本</h2><p>1 字符串相关API<br>  var s = “hello,world”</p><p>  <code>s.charAt(0)</code> h 第一个字符</p><p>  <code>s.charAt(s.length-1)</code> d 最后一个字符</p><p>  <code>s.substring(1,4)</code> ell 第2-4 字符</p><p>  <code>s.slice(1,4)</code> ell 同上</p><p>  <code>s.slice(-3)</code> rld 最后三个字符</p><p>  <code>s.indexOf(&quot;l&quot;)</code> 2 l字母首次出现的位置</p><p>  <code>s.lastIndexof(&quot;l&quot;)</code> 10 l字母最后一次出现的位置</p><p>  <code>s.indexOf(&quot;1&quot;,3)</code> 在位置3 之后 l首次出现的位置</p><p>  <code>s.split(&quot;,&quot;)</code> 按照，分割成字串</p><p>  <code>s.replace(&quot;h&quot;,&quot;H&quot;)</code>, Hello，world 全文子替换符</p><p>  <code>s.toUpperCase()</code> 全部转换大写</p><h2 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h2><p>1 在两条斜线中间的文本构成了正则表达式的直接量，<code>直接量即为程序中直接使用的数据值</code></p><p>RegExp()构造函数，用来创建文本匹配模式的对象。<code>正则表达式</code></p><p>字符串也可以接受RegExp参数的方法</p><p>var text = “testing:1,2,3”</p><p>var pattern = /\d+/g  匹配包含一个或多个数字的实例</p><p><code>pattern.test(text)</code> true 匹配成功</p><p><code>text.search(pattern)</code> 9 首次匹配成功的位置</p><p><code>text.match(pattern)</code> [“1”,”2”,”3”] 所有匹配组成的数组</p><p><code>text.replace(pattern,&quot;#&quot;)</code> test:#,#,#</p><p><code>text.split(/\D+/)</code> 用非数字字符截取字符串</p><h2 id="null-and-undefined"><a href="#null-and-undefined" class="headerlink" title="null and undefined"></a>null and undefined</h2><p>1 null 执行typeof返回object，null被认为是一个特殊的对象值。</p><p>2 null == undefined  但是 null！=== undefined</p><p>3 传参数用null</p><h2 id="不可变的原始值和可变的引用对象"><a href="#不可变的原始值和可变的引用对象" class="headerlink" title="不可变的原始值和可变的引用对象"></a>不可变的原始值和可变的引用对象</h2><p>1 任何方法都不能改变一个原始值（undefined，null，布尔值，数字，字符串）</p><p>2 对象的比较不是值的比较，即便外表上完全一样的两个对象也是不相等的。<br>  各个索引元素完全相等的两个数组也不相等。</p><p>3 对象值都是引用，对象的比较是引用的比较，当且仅当它们引用同一个基对象时，才相等。</p><p>  <code>var a = [];var b = a; //这里仅仅是赋值的引用值，对象本身并没有复制b[0] = 1;a[0]; //1a === b</code></p><p>  如果想得到一个对象或者数组的副本，必须显式复制对象的每一个属性或者数组的每一个元素。</p><p><code>var a= [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;];var b =[];for(var i = 0;i &lt; a.length; i++){  b[i] = a[i]}</code>  </p><h2 id="转换和相等性"><a href="#转换和相等性" class="headerlink" title="转换和相等性"></a>转换和相等性</h2><p>1 <code>== 运算符</code>在判断两个值相等前，做了类型转换</p><p><code>=== 运算符</code>在判断前不做类型转换</p><p>2 类型转化的惯用方法</p><p><code>x + &quot;&quot;</code> String(x)</p><p><code>+ x</code> Number(x)</p><p><code>!!x</code> Bollen(x)</p><p>3 数字到字符串的转化</p><p><code>var n = 17;binary_string = n.toString(2); //10001octal_string = &#39;0&#39; + n.toString(8); //021hex_string = &#39;0x&#39; + n.toString(16) //0x11</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;词法结构&quot;&gt;&lt;a href=&quot;#词法结构&quot; class=&quot;headerlink&quot; title=&quot;词法结构&quot;&gt;&lt;/a&gt;词法结构&lt;/h2&gt;&lt;p&gt;1 js区分大小写，html不区分大小写&lt;/p&gt;
&lt;h2 id=&quot;类型，值，变量&quot;&gt;&lt;a href=&quot;#类型，值，变量&quot; c
      
    
    </summary>
    
    
      <category term="js" scheme="babylovelin.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>jsMechanism</title>
    <link href="babylovelin.github.io/2018/04/07/jsMechanism/"/>
    <id>babylovelin.github.io/2018/04/07/jsMechanism/</id>
    <published>2018-04-07T01:19:18.000Z</published>
    <updated>2018-04-07T05:02:46.661Z</updated>
    
    <content type="html"><![CDATA[<h2 id="区分进程和线程"><a href="#区分进程和线程" class="headerlink" title="区分进程和线程"></a>区分进程和线程</h2><p>1</p><ul><li><p>进程是一个工厂，工厂有它的独立资源</p></li><li><p>工厂之间相互独立</p></li><li><p>线程是工厂中的工人，多个工人协作完成任务</p></li><li><p>工厂内有一个或多个工人</p></li><li><p>工人之间共享空间</p></li></ul><p>2</p><ul><li><p>工厂的资源 -&gt; 系统分配的内存（独立的一块内存）</p></li><li><p>工厂之间的相互独立 -&gt; 进程之间相互独立</p></li><li><p>多个工人协作完成任务 -&gt; 多个线程在进程中协作完成任务</p></li><li><p>工厂内有一个或多个工人 -&gt; 一个进程由一个或多个线程组成</p></li><li><p>工人之间共享空间 -&gt; 同一进程下的各个线程之间共享程序的内存空间（包括代码段、数据集、堆等）</p></li></ul><p>3</p><p>进程是cpu资源分配的最小单位（是能拥有资源和独立运行的最小单位）</p><p>线程是cpu调度的最小单位（线程是建立在进程的基础上的一次程序运行单位，一个进程中可以有多个线程）</p><p>不同进程之间也可以通信，不过代价较大</p><p>现在，一般通用的叫法：单线程与多线程，都是指在一个进程内的单和多。（所以核心还是得属于一个进程才行</p><h2 id="浏览器是多进程的"><a href="#浏览器是多进程的" class="headerlink" title="浏览器是多进程的"></a>浏览器是多进程的</h2><p>浏览器是多进程的</p><p>浏览器之所以能够运行，是因为系统给它的进程分配了资源（cpu、内存）</p><p>简单点理解，每打开一个Tab页，就相当于创建了一个独立的浏览器进程。</p><h4 id="浏览器都包含哪些进程？"><a href="#浏览器都包含哪些进程？" class="headerlink" title="浏览器都包含哪些进程？"></a>浏览器都包含哪些进程？</h4><p>1.Browser进程：浏览器的主进程（负责协调、主控），只有一个。作用有</p><p>负责浏览器界面显示，与用户交互。如前进，后退等</p><p>负责各个页面的管理，创建和销毁其他进程</p><p>将Renderer进程得到的内存中的Bitmap，绘制到用户界面上</p><p>网络资源的管理，下载等</p><p>2.第三方插件进程：每种类型的插件对应一个进程，仅当使用该插件时才创建</p><p>3.GPU进程：最多一个，用于3D绘制等</p><p>4.浏览器渲染进程（浏览器内核）（Renderer进程，内部是多线程的）：默认每个Tab页面一个进程，互不影响。主要作用为</p><p>强化记忆：在浏览器中打开一个网页相当于新起了一个进程（进程内有自己的多线程）</p><p>当然，浏览器有时会将多个进程合并（譬如打开多个空白标签页后，会发现多个空白标签页被合并成了一个进程）</p><h4 id="浏览器多进程的优势"><a href="#浏览器多进程的优势" class="headerlink" title="浏览器多进程的优势"></a>浏览器多进程的优势</h4><p>相比于单进程浏览器，多进程有如下优点：</p><p>避免单个page crash影响整个浏览器</p><p>避免第三方插件crash影响整个浏览器</p><p>多进程充分利用多核优势</p><p>方便使用沙盒模型隔离插件等进程，提高浏览器稳定性</p><p>简单理解：如果浏览器是单进程，那么某个Tab页崩溃了，就影响了整个浏览器，体验有多差；</p><p>同理如果是单进程，插件崩溃了也会影响整个浏览器；而且多进程还有其它的诸多优势</p><h4 id="重点是浏览器内核（渲染进程）"><a href="#重点是浏览器内核（渲染进程）" class="headerlink" title="重点是浏览器内核（渲染进程）"></a>重点是浏览器内核（渲染进程）</h4><p>浏览器的渲染进程是多线程的（这点如果不理解，请回头看进程和线程的区分）</p><p>1.GUI渲染线程</p><p>负责渲染浏览器界面，解析HTML，CSS，构建DOM树和RenderObject树，布局和绘制等。</p><p>当界面需要重绘（Repaint）或由于某种操作引发回流(reflow)时，该线程就会执行</p><p>注意，GUI渲染线程与JS引擎线程是互斥的，当JS引擎执行时GUI线程会被挂起（相当于被冻结了），GUI更新会被保存在一个队列中等到JS引擎空闲时立即被执行。</p><p>2.JS引擎线程</p><p>也称为JS内核，负责处理Javascript脚本程序。（例如V8引擎）</p><p>JS引擎线程负责解析Javascript脚本，运行代码。</p><p>JS引擎一直等待着任务队列中任务的到来，然后加以处理，浏览器无论什么时候都只有一个JS线程在运行JS程序</p><p>同样注意，GUI渲染线程与JS引擎线程是互斥的，所以如果JS执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞。</p><p>3.事件触发线程</p><p>归属于浏览器而不是JS引擎，用来控制事件循环（可以理解，JS引擎自己都忙不过来，需要浏览器另开线程协助）</p><p>当JS引擎执行代码块如setTimeOut时（也可来自浏览器内核的其他线程,如鼠标点击、AJAX异步请求等），会将对应任务添加到事件线程中</p><p>当对应的事件符合触发条件被触发时，该线程会把事件添加到待处理队列的队尾，等待JS引擎的处理</p><p>注意，由于JS的单线程关系，所以这些待处理队列中的事件都得排队等待JS引擎处理（当JS引擎空闲时才会去执行）</p><p>4.定时触发器线程</p><p>传说中的 setInternal与 setTimeout所在线程</p><p>浏览器定时计数器并不是由JavaScript引擎计数的,（因为JavaScript引擎是单线程的, 如果处于阻塞线程状态就会影响记计时的准确）</p><p>因此通过单独线程来计时并触发定时（计时完毕后，添加到事件队列中，等待JS引擎空闲后执行）</p><p>注意，W3C在HTML标准中规定，规定要求setTimeout中低于4ms的时间间隔算为4ms。</p><p>5.异步http请求线程</p><p>在XMLHttpRequest在连接后是通过浏览器新开一个线程请求</p><p>将检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将这个回调再放入事件队列中。再由JavaScript引擎执行。</p><h4 id="Browser进程和浏览器内核（Renderer进程）的通信过程"><a href="#Browser进程和浏览器内核（Renderer进程）的通信过程" class="headerlink" title="Browser进程和浏览器内核（Renderer进程）的通信过程"></a>Browser进程和浏览器内核（Renderer进程）的通信过程</h4><p>如果自己打开任务管理器，然后打开一个浏览器，就可以看到：任务管理器中出现了两个进程（一个是主控进程，一个则是打开Tab页的渲染进程）</p><p>1、Browser进程收到用户请求，首先需要获取页面内容（譬如通过网络下载资源），随后将该任务通过RendererHost接口传递给Render进程</p><p>2、Renderer进程的Renderer接口收到消息，简单解释后，交给渲染线程，然后开始渲染</p><ul><li><p>渲染线程接收请求，加载网页并渲染网页，这其中可能需要Browser进程获取资源和需要GPU进程来帮助渲染</p></li><li><p>当然可能会有JS线程操作DOM（这样可能会造成回流并重绘）</p></li><li><p>最后Render进程将结果传递给Browser进程</p></li></ul><p>3、Browser进程接收到结果并将结果绘制出来</p><h2 id="梳理浏览器内核中线程之间的关系"><a href="#梳理浏览器内核中线程之间的关系" class="headerlink" title="梳理浏览器内核中线程之间的关系"></a>梳理浏览器内核中线程之间的关系</h2><h4 id="GUI渲染线程与JS引擎线程互斥"><a href="#GUI渲染线程与JS引擎线程互斥" class="headerlink" title="GUI渲染线程与JS引擎线程互斥"></a>GUI渲染线程与JS引擎线程互斥</h4><p>由于JavaScript是可操纵DOM的，如果在修改这些元素属性同时渲染界面（即JS线程和UI线程同时运行），那么渲染线程前后获得的元素数据就可能不一致了。</p><p>因此为了防止渲染出现不可预期的结果，浏览器设置GUI渲染线程与JS引擎为互斥的关系，当JS引擎执行时GUI线程会被挂起，</p><p>GUI更新则会被保存在一个队列中等到JS引擎线程空闲时立即被执行。</p><h4 id="JS阻塞页面加载"><a href="#JS阻塞页面加载" class="headerlink" title="JS阻塞页面加载"></a>JS阻塞页面加载</h4><p>从上述的互斥关系，可以推导出，JS如果执行时间过长就会阻塞页面。</p><p>譬如，假设JS引擎正在进行巨量的计算，此时就算GUI有更新，也会被保存到队列中，等待JS引擎空闲后执行。 然后，由于巨量计算，所以JS引擎很可能很久很久后才能空闲，自然会感觉到巨卡无比。</p><p>所以，要尽量避免JS执行时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞的感觉。</p><h4 id="WebWorker，JS的多线程？"><a href="#WebWorker，JS的多线程？" class="headerlink" title="WebWorker，JS的多线程？"></a>WebWorker，JS的多线程？</h4><p>前文中有提到JS引擎是单线程的，而且JS执行时间过长会阻塞页面，那么JS就真的对cpu密集型计算无能为力么？</p><p>所以，后来HTML5中支持了 Web Worker。</p><p>MDN的官方解释是：</p><p><code>Web Worker为Web内容在后台线程中运行脚本提供了一种简单的方法。线程可以执行任务而不干扰用户界面一个worker是使用一个构造函数创建的一个对象(e.g. Worker()) 运行一个命名的JavaScript文件这个文件包含将在工作线程中运行的代码; workers 运行在另一个全局上下文中,不同于当前的window因此，使用 window快捷方式获取当前全局的范围 (而不是self) 在一个 Worker 内将返回错误</code></p><ul><li><p>创建Worker时，JS引擎向浏览器申请开一个子线程（子线程是浏览器开的，完全受主线程控制，而且不能操作DOM）</p></li><li><p>JS引擎线程与worker线程间通过特定的方式通信（postMessage API，需要通过序列化对象来与线程交互特定的数据）</p></li></ul><p>如果有非常耗时的工作，请单独开一个Worker线程，这样里面不管如何翻天覆地都不会影响JS引擎主线程， 只待计算出结果后，将结果通信给主线程即可，perfect!</p><p>注意下，JS引擎是单线程的，这一点的本质仍然未改变，Worker可以理解是浏览器给JS引擎开的外挂，专门用来解决那些大量计算问题</p><h4 id="WebWorker与SharedWorker"><a href="#WebWorker与SharedWorker" class="headerlink" title="WebWorker与SharedWorker"></a>WebWorker与SharedWorker</h4><p>WebWorker只属于某个页面，不会和其他页面的Render进程（浏览器内核进程）共享</p><ul><li>所以Chrome在Render进程中（每一个Tab页就是一个render进程）创建一个新的线程来运行Worker中的JavaScript程序。</li></ul><p>SharedWorker是浏览器所有页面共享的，不能采用与Worker同样的方式实现，因为它不隶属于某个Render进程，可以为多个Render进程共享使用</p><ul><li>所以Chrome浏览器为SharedWorker单独创建一个进程来运行JavaScript程序，在浏览器中每个相同的JavaScript只存在一个SharedWorker进程，不管它被创建多少次</li></ul><p>本质上就是进程和线程的区别。<code>SharedWorker由独立的进程管理，WebWorker只是属于render进程下的一个线程</code></p><h2 id="简单梳理下浏览器渲染流程"><a href="#简单梳理下浏览器渲染流程" class="headerlink" title="简单梳理下浏览器渲染流程"></a>简单梳理下浏览器渲染流程</h2><p>前期工作：</p><ul><li><p>浏览器输入url，浏览器主进程接管，开一个下载线程，</p></li><li><p>然后进行 http请求（略去DNS查询，IP寻址等等操作），然后等待响应，获取内容，</p></li><li><p>随后将内容通过RendererHost接口转交给Renderer进程</p></li><li><p>浏览器渲染流程开始</p></li></ul><p>浏览器器内核拿到内容后，渲染大概可以划分成以下几个步骤</p><p>1解析html建立dom树</p><p>2解析css构建render树（将CSS代码解析成树形的数据结构，然后结合DOM合并成render树）</p><p>3布局render树（Layout/reflow），负责各元素尺寸、位置的计算</p><p>4绘制render树（paint），绘制页面像素信息</p><p>5浏览器会将各层的信息发送给GPU，GPU会将各层合成（composite），显示在屏幕上。</p><p>所有详细步骤都已经略去，渲染完毕后就是 load事件了，之后就是自己的JS逻辑处理了</p><h4 id="load事件与DOMContentLoaded事件的先后"><a href="#load事件与DOMContentLoaded事件的先后" class="headerlink" title="load事件与DOMContentLoaded事件的先后"></a>load事件与DOMContentLoaded事件的先后</h4><ul><li>当 DOMContentLoaded 事件触发时，仅当DOM加载完成，不包括样式表，图片。</li></ul><p>(譬如如果有async加载的脚本就不一定完成)</p><ul><li>当 onload 事件触发时，页面上所有的DOM，样式表，脚本，图片都已经加载完成了。</li></ul><p>（渲染完毕了）</p><p>所以，顺序是： DOMContentLoaded -&gt; load</p><h4 id="css加载是否会阻塞dom树渲染？"><a href="#css加载是否会阻塞dom树渲染？" class="headerlink" title="css加载是否会阻塞dom树渲染？"></a>css加载是否会阻塞dom树渲染？</h4><p>这里说的是头部引入css的情况</p><p>css是由单独的下载线程异步下载的。</p><ul><li><p>css加载不会阻塞DOM树解析（异步加载时DOM照常构建）</p></li><li><p>但会阻塞render树渲染（渲染时需等css加载完毕，因为render树需要css信息</p></li></ul><h4 id="普通图层和复合图层"><a href="#普通图层和复合图层" class="headerlink" title="普通图层和复合图层"></a>普通图层和复合图层</h4><p>首先，普通文档流内可以理解为一个复合图层（这里称为 默认复合层，里面不管添加多少元素，其实都是在同一个复合图层中）</p><p>其次，absolute布局（fixed也一样），虽然可以脱离普通文档流，但它仍然属于 默认复合层。</p><p>然后，可以通过 硬件加速的方式，声明一个 新的复合图层，它会单独分配资源 （当然也会脱离普通文档流，这样一来，不管这个复合图层中怎么变化，也不会影响 默认复合层里的回流重绘）</p><p>可以简单理解下：GPU中，各个复合图层是单独绘制的，所以互不影响，这也是为什么某些场景硬件加速效果一级棒</p><h4 id="如何变成复合图层（硬件加速）"><a href="#如何变成复合图层（硬件加速）" class="headerlink" title="如何变成复合图层（硬件加速）"></a>如何变成复合图层（硬件加速）</h4><p>最常用的方式： translate3d、 translateZ</p><p>opacity属性/过渡动画（需要动画执行的过程中才会创建合成层，动画没有开始或结束后元素还会回到之前的状态）</p><p>will-chang属性（这个比较偏僻），一般配合opacity与translate使用（而且经测试，除了上述可以引发硬件加速的属性外，其它属性并不会变成复合层）</p><h4 id="absolute和硬件加速的区别"><a href="#absolute和硬件加速的区别" class="headerlink" title="absolute和硬件加速的区别"></a>absolute和硬件加速的区别</h4><p>可以看到，absolute虽然可以脱离普通文档流，但是无法脱离默认复合层。 所以，就算absolute中信息改变时不会改变普通文档流中render树， 但是，浏览器最终绘制时，是整个复合层绘制的，所以absolute中信息的改变，仍然会影响整个复合层的绘制。 （浏览器会重绘它，如果复合层中内容多，absolute带来的绘制信息变化过大，资源消耗是非常严重的）</p><p>而硬件加速直接就是在另一个复合层了（另起炉灶），所以它的信息改变不会影响默认复合层 （当然了，内部肯定会影响属于自己的复合层），仅仅是引发最后的合成（输出视图）</p><h4 id="复合图层的作用？"><a href="#复合图层的作用？" class="headerlink" title="复合图层的作用？"></a>复合图层的作用？</h4><p>一般一个元素开启硬件加速后会变成复合图层，可以独立于普通文档流中，改动后可以避免整个页面重绘，提升性能</p><p>但是尽量不要大量使用复合图层，否则由于资源消耗过度，页面反而会变的更卡</p><h4 id="硬件加速时请使用index"><a href="#硬件加速时请使用index" class="headerlink" title="硬件加速时请使用index"></a>硬件加速时请使用index</h4><p>webkit CSS3中，如果这个元素添加了硬件加速，并且index层级比较低， 那么在这个元素的后面其它元素（层级比这个元素高的，或者相同的，并且releative或absolute属性相同的）， 会默认变为复合层渲染，如果处理不当会极大的影响性能</p><p>简单点理解，其实可以认为是一个隐式合成的概念：如果a是一个复合图层，而且b在a上面，那么b也会被隐式转为一个复合图层，这点需要特别注意</p><h2 id="从Event-Loop谈JS的运行机制"><a href="#从Event-Loop谈JS的运行机制" class="headerlink" title="从Event Loop谈JS的运行机制"></a>从Event Loop谈JS的运行机制</h2><p>JS分为同步任务和异步任务</p><p>同步任务都在主线程上执行，形成一个 执行栈</p><p>主线程之外，事件触发线程管理着一个 任务队列，只要异步任务有了运行结果，就在 任务队列之中放置一个事件。</p><p>一旦 执行栈中的所有同步任务执行完毕（此时JS引擎空闲），系统就会读取 任务队列，将可运行的异步任务添加到可执行栈中，开始执行。</p><p>为什么有时候setTimeout推入的事件不能准时执行？</p><p>因为可能在它推入到事件列表时，主线程还不空闲，正在执行其它代码， 所以自然有误差~~~~</p><p>栈中的代码调用某些api时，它们会在事件队列中添加各种事件（当满足触发条件后，如ajax请求完毕）</p><p>而栈中的代码执行完毕，就会读取事件队列中的事件，去执行那些回调</p><p>如此循环</p><p>注意，总是要等待栈中的代码执行完毕后才会去读取事件队列中的事件</p><h4 id="单独说说定时器"><a href="#单独说说定时器" class="headerlink" title="单独说说定时器"></a>单独说说定时器</h4><p>上述事件循环机制的核心是：JS引擎线程和事件触发线程</p><p>譬如调用 setTimeout后，是如何等待特定时间后才添加到事件队列中的？ 它是由定时器线程控制（因为JS引擎自己都忙不过来，根本无暇分身）</p><p>为什么要单独的定时器线程？因为JavaScript引擎是单线程的, 如果处于阻塞线程状态就会影响记计时的准确，因此很有必要单独开一个线程用来计时。</p><p>什么时候会用到定时器线程？当使用 setTimeout或 setInterval时，它需要定时器线程计时，计时完成后就会将特定的事件推入事件队列中。</p><p>例如：<br><code>setTimeout(function(){    console.log(&#39;hello!&#39;);}, 1000);</code></p><p>这段代码的作用是当 1000毫秒计时完毕后（由定时器线程计时），将回调函数推入事件队列中，等待主线程执行</p><p><code>setTimeout(function(){    console.log(&#39;hello!&#39;);}, 0);console.log(&#39;begin&#39;);</code></p><p>这段代码的效果是最快的时间内将回调函数推入事件队列中，等待主线程执行</p><p>W3C在HTML标准中规定，规定要求setTimeout中低于4ms的时间间隔算为4ms。所以先执行begin 后执行hello</p><h4 id="setTimeout而不是setInterval"><a href="#setTimeout而不是setInterval" class="headerlink" title="setTimeout而不是setInterval"></a>setTimeout而不是setInterval</h4><p>setTimeout 和 setInternal的区别</p><p>每次setTimeout计时到后就会去执行，然后执行一段时间后才会继续setTimeout，中间就多了误差 （误差多少与代码执行时间有关）</p><p>etInterval则是每次都精确的隔一段时间推入一个事件 （但是，事件的实际执行时间不一定就准确，还有可能是这个事件还没执行完毕，下一个事件就来了）</p><p>setInterval有一些比较致命的问题就是：</p><ul><li><p>累计效应（上面提到的），如果setInterval代码在（setInterval）再次添加到队列之前还没有完成执行</p></li><li><p>譬如像iOS的webview,或者Safari等浏览器中都有一个特点，在滚动的时候是不执行JS的，<br>如果使用了setInterval，会发现在滚动结束后会执行多次由于滚动不执行JS积攒回调， 如果回调执行时间过长,就会非常容器造成卡顿问题和一些不可知的错误</p></li><li><p>而且把浏览器最小化显示等操作时，setInterval并不是不执行程序，<br>它会把setInterval的回调函数放在队列中，等浏览器窗口再次打开时，一瞬间全部执行时</p></li></ul><h2 id="事件循环进阶：macrotask与microtask"><a href="#事件循环进阶：macrotask与microtask" class="headerlink" title="事件循环进阶：macrotask与microtask"></a>事件循环进阶：macrotask与microtask</h2><p><code>console.log(&#39;script start&#39;);setTimeout(function() {    console.log(&#39;setTimeout&#39;);}, 0);Promise.resolve().then(function() {    console.log(&#39;promise1&#39;);}).then(function() {    console.log(&#39;promise2&#39;);});console.log(&#39;script end&#39;);</code></p><p>执行顺序为<br>script start</p><p>script end</p><p>promise1</p><p>promise2</p><p>setTimeout</p><p>为什么呢？因为Promise里有了一个一个新的概念： microtask（宏任务）</p><p>JS中分为两种任务类型： macrotask和 microtask</p><ul><li>macrotask（又称之为宏任务），可以理解是每次执行栈执行的代码就是一个宏任务（包括每次从事件队列中获取一个事件回调并放到执行栈中执行）</li></ul><p>每一个task会从头到尾将这个任务执行完毕，不会执行其它</p><p>浏览器为了能够使得JS内部task与DOM任务能够有序的执行，会在一个task执行结束后，在下一个 task 执行开始前，对页面进行重新渲染（<code>task-&gt;渲染-&gt;task-&gt;...</code>）</p><ul><li>microtask（又称为微任务），可以理解是在当前 task 执行结束后立即执行的任务</li></ul><p>也就是说，在当前task任务后，下一个task之前，在渲染之前</p><p>所以它的响应速度相比setTimeout（setTimeout是task）会更快，因为无需等渲染</p><p>也就是说，在某一个macrotask执行完后，就会将在它执行期间产生的所有microtask都执行完毕（在渲染前）</p><p><code>总结下运行机制：</code></p><p>执行一个宏任务（栈中没有就从事件队列中获取）</p><p>执行过程中如果遇到微任务，就将它添加到微任务的任务队列中</p><p>宏任务执行完毕后，立即执行当前微任务队列中的所有微任务（依次执行）</p><p>当前宏任务执行完毕，开始检查渲染，然后GUI线程接管渲染</p><p>渲染完毕后，JS线程继续接管，开始下一个宏任务（从事件队列中获取）</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;区分进程和线程&quot;&gt;&lt;a href=&quot;#区分进程和线程&quot; class=&quot;headerlink&quot; title=&quot;区分进程和线程&quot;&gt;&lt;/a&gt;区分进程和线程&lt;/h2&gt;&lt;p&gt;1&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;进程是一个工厂，工厂有它的独立资源&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
      
    
    </summary>
    
    
      <category term="js" scheme="babylovelin.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>aliNginx</title>
    <link href="babylovelin.github.io/2018/04/07/aliNginx/"/>
    <id>babylovelin.github.io/2018/04/07/aliNginx/</id>
    <published>2018-04-07T00:58:37.000Z</published>
    <updated>2018-04-07T01:17:50.597Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="aliNginx" scheme="babylovelin.github.io/tags/aliNginx/"/>
    
  </entry>
  
  <entry>
    <title>Interview</title>
    <link href="babylovelin.github.io/2018/03/25/Interview/"/>
    <id>babylovelin.github.io/2018/03/25/Interview/</id>
    <published>2018-03-25T12:27:14.000Z</published>
    <updated>2018-03-27T03:10:03.246Z</updated>
    
    <content type="html"><![CDATA[<div class="note"><br>    <h5>HTML</h5><br>    <p>HTML知识点</p><br></div><h2 id="HTML5新特性，语义化"><a href="#HTML5新特性，语义化" class="headerlink" title="HTML5新特性，语义化"></a>HTML5新特性，语义化</h2><h2 id="浏览器标准模式和怪异模式"><a href="#浏览器标准模式和怪异模式" class="headerlink" title="浏览器标准模式和怪异模式"></a>浏览器标准模式和怪异模式</h2><p>  用margin:0 auto设置水平居中在IE下会失效</p><h2 id="xhtml与html的区别"><a href="#xhtml与html的区别" class="headerlink" title="xhtml与html的区别"></a>xhtml与html的区别</h2><p>  XHTML 元素必须被正确地嵌套。<br>  XHTML 元素必须被关闭。<br>  标签名必须用小写字母。<br>  XHTML 文档必须拥有根元素。</p><h2 id="使用data-的好处"><a href="#使用data-的好处" class="headerlink" title="使用data-的好处"></a>使用data-的好处</h2><p>  为前端开发者提供自定义的属性，这些属性集可以通过对象的dataset属性获取，不支持该属性的浏览器可以通过 getAttribute方法获取</p><h2 id="meta标签"><a href="#meta标签" class="headerlink" title="meta标签"></a>meta标签</h2><p>  <meta> 元素可提供有关页面的元信息（meta-information），比如针对搜索引擎和更新频度的描述和关键词。</p><p>  <meta> 标签位于文档的头部，不包含任何内容。<meta> 标签的属性定义了与文档相关联的名称/值对。</p><p>  name属性：某些搜索引擎在遇到这些关键字时，会用这些关键字对文档进行分类。</p><p>  类似这样的 meta 标签可能对于进入搜索引擎的索引有帮助：</p><p>  <code>&lt;meta name=&quot;keywords&quot; content=&quot;HTML,ASP,PHP,SQL&quot;&gt;</code></p><p>  http-equiv 属性</p><p>  http-equiv 属性为名称/值对提供了名称。并指示服务器在发送实际的文档之前先在要传送给浏览器的 MIME 文档头部包含名称/值对。</p><p>  content 属性</p><p>  content 属性提供了名称/值对中的值。该值可以是任何有效的字符串。</p><p>  content 属性始终要和 name 属性或 http-equiv 属性一起使用。</p><p>  页面重定向实例</p><p>  <code>&lt;meta http-equiv=&quot;Refresh&quot; content=&quot;5;url=http://www.w3school.com.cn&quot; /&gt;</code></p><h2 id="css-js-放置位置和原因"><a href="#css-js-放置位置和原因" class="headerlink" title="css js 放置位置和原因"></a>css js 放置位置和原因</h2><p>  js放在前面，css放在<head></head>之间</p><p>  浏览器构建DOM树和渲染树是同时进行的。遇到JS加载执行，会阻塞DOM树的构建。遇到css文件会阻塞渲染树的构建。</p><p>  浏览器一边构建DOM树，一边进行渲染是效率最高的。</p><h2 id="渐进式渲染"><a href="#渐进式渲染" class="headerlink" title="渐进式渲染"></a>渐进式渲染</h2><p>  渐进式渲染是一种渲染模式，程序逐渐更新整个图像的小部分，从低质量到最终结果，而不是一次集中在图像的一小部分。<br>  渐进式渲染的目标是始终能够看到整体渲染渲染图像的过程，就像画家通过在添加越来越多的细节之后查看整个画布看到他的作品从草图演变而来。</p><p>  图形的渐进式渲染（progressive rendering），渲染的时候会把创建好的图形分到数帧中渲染，每一帧渲染只渲染指定数量的图形。<br>  该配置项就是用于配置该系列每一帧渲染的图形数，默认是 400 个，可以根据图表图形复杂度的需要适当调整这个数字使得在不影响交互流畅性的前提下达到绘制速度的最大化。比如在 lines 图或者平行坐标中线宽大于 1 的 polyline 绘制会很慢，这个数字就可以设置小一点，而线宽小于等于 1 的 polyline 绘制非常快，该配置项就可以相对调得比较大。</p><h2 id="html模板语言"><a href="#html模板语言" class="headerlink" title="html模板语言"></a>html模板语言</h2><p>   html有打开效率高的先天优势，但也有一个先天缺陷-不支持动态语言，这也是html模板语言出现的原因，让网站即享受html高效，又享受内容的动态化</p><h2 id="服务器端渲染SSR和客户端渲染CSR有什么区别？"><a href="#服务器端渲染SSR和客户端渲染CSR有什么区别？" class="headerlink" title="服务器端渲染SSR和客户端渲染CSR有什么区别？"></a>服务器端渲染SSR和客户端渲染CSR有什么区别？</h2><p>  服务器端渲染（简称SSR）方式，选择原因：1、能够为客户提供更理想的性能 2、提供更为一致的SEO表现</p><p>  在使用SSR的情况下您的服务器对浏览器的响应结果属于已做好准备并可进行渲染的页面HTML，而CSR的浏览器响应结果则属于链接至您JavaScript的空文档。这意味着您的浏览器将立足服务器进行HTML渲染，而无需等待全部JavaSciprt代码的下载与执行。在这两种情况下，我们都需要下载React并利用同样的流程构建一个虚拟dom，而后附加各事件以实现页面交互——但在SSR方面，用户可在执行上述流程的同时查看到页面内容。而在CSR方面，大家则需要等待上述流程全部执行完成，而后方可进行查看。</p><h2 id="meta-viewport-原理"><a href="#meta-viewport-原理" class="headerlink" title="meta viewport 原理"></a>meta viewport 原理</h2><p>  通俗的讲，移动设备上的viewport就是设备的屏幕上能用来显示我们的网页的那一块区域</p><p>  浏览器默认的viewport叫做 layout viewport。这个layout viewport的宽度可以通过 <code>document.documentElement.clientWidth</code> 来获取。</p><p>  layout viewport 的宽度是大于浏览器可视区域的宽度的，所以我们还需要一个viewport来代表 浏览器可视区域的大小，ppk把这个viewport叫做 visual</p><p>  viewport。visual viewport的宽度可以通过<code>window.innerWidth</code> 来获取，但在Android 2, Oprea mini 和 UC 8中无法正确获取。</p><p>  第三个viewport——移动设备的理想viewport。</p><p>  <code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0&quot;&gt;</code></p><p>  把当前的viewport宽度设置为 ideal viewport 的宽度</p>  <div class="note"><br>      <h5>CSS</h5><br>      <p>CSS知识点</p><br>  </div><h2 id="盒模型，box-sizing"><a href="#盒模型，box-sizing" class="headerlink" title="盒模型，box-sizing"></a>盒模型，box-sizing</h2><p>  分为W3C标准模型和IE模型</p><p>  W3C标准模型：width为内容宽度，元素宽度为内容+padding+border</p><p>  IE：width 为元素宽度，内容宽度为width-border-padding</p><h4 id="box-sizing"><a href="#box-sizing" class="headerlink" title="box-sizing"></a>box-sizing</h4><p>  content-box</p><p>  其让元素维持W3C的标准盒模型</p><p>  border-box</p><p>  让元素维持IE传统的盒模型</p><p>  inherit</p><p>  使元素继承父元素的盒模型模式</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;div class=&quot;note&quot;&gt;&lt;br&gt;    &lt;h5&gt;HTML&lt;/h5&gt;&lt;br&gt;    &lt;p&gt;HTML知识点&lt;/p&gt;&lt;br&gt;&lt;/div&gt;

&lt;h2 id=&quot;HTML5新特性，语义化&quot;&gt;&lt;a href=&quot;#HTML5新特性，语义化&quot; class=&quot;headerlink&quot; ti
      
    
    </summary>
    
    
      <category term="interview" scheme="babylovelin.github.io/tags/interview/"/>
    
  </entry>
  
  <entry>
    <title>VueAPI</title>
    <link href="babylovelin.github.io/2018/03/20/vueapi/"/>
    <id>babylovelin.github.io/2018/03/20/vueapi/</id>
    <published>2018-03-20T07:50:45.000Z</published>
    <updated>2018-03-21T02:46:10.586Z</updated>
    
    <content type="html"><![CDATA[<div class="note"><br>    <h5>数据更新DOM不刷新</h5><br>    <p>以下几个api是针对DOM刷新问题</p><br></div><h2 id="Vue-nextTick"><a href="#Vue-nextTick" class="headerlink" title="Vue.nextTick"></a>Vue.nextTick</h2><p><code>// 修改数据vm.msg = &#39;Hello&#39;// DOM 还没有更新Vue.nextTick(function () {  // DOM 更新了})// 作为一个 Promise 使用 (2.1.0 起新增，详见接下来的提示)Vue.nextTick()  .then(function () {    // DOM 更新了  })</code></p><h2 id="Vue-set-target-key-value"><a href="#Vue-set-target-key-value" class="headerlink" title="Vue.set( target, key, value )"></a>Vue.set( target, key, value )</h2><p>设置对象的属性。如果对象是响应式的，确保属性被创建后也是响应式的，同时触发视图更新。这个方法主要用于避开 Vue 不能检测属性被添加的限制。</p><h2 id="Vue-delete-target-key"><a href="#Vue-delete-target-key" class="headerlink" title="Vue.delete( target, key )"></a>Vue.delete( target, key )</h2><p>删除对象的属性。如果对象是响应式的，确保删除能触发更新视图。</p><div class="note"><br>    <h5>选项/数据</h5><br>    <p>几种常用数据的注意点</p><br></div><h2 id="props"><a href="#props" class="headerlink" title="props"></a>props</h2><p><code>// 简单语法Vue.component(&#39;props-demo-simple&#39;, {  props: [&#39;size&#39;, &#39;myMessage&#39;]})// 对象语法，提供校验Vue.component(&#39;props-demo-advanced&#39;, {  props: {    // 检测类型    height: Number,    // 检测类型 + 其他验证    age: {      type: Number,      default: 0,      required: true,      validator: function (value) { //自定义校验函数        return value &gt;= 0      }    }  }})</code></p><div class="note"><br>    <h5>生命周期钩子</h5><br>    <p>重点</p><br></div><h2 id="beforeCreate"><a href="#beforeCreate" class="headerlink" title="beforeCreate"></a>beforeCreate</h2><p>在实例初始化之后，数据观测 (data observer) 和 event/watcher 事件配置之前被调用</p><h2 id="created"><a href="#created" class="headerlink" title="created"></a>created</h2><p>在实例创建完成后被立即调用。在这一步，实例已完成以下的配置：数据观测 (data observer)，</p><p>属性和方法的运算，watch/event 事件回调。然而，挂载阶段还没开始，$el 属性目前不可见。</p><h2 id="beforeMount"><a href="#beforeMount" class="headerlink" title="beforeMount"></a>beforeMount</h2><p>在挂载开始之前被调用：相关的 render 函数首次被调用</p><h2 id="mounted"><a href="#mounted" class="headerlink" title="mounted"></a>mounted</h2><p>el 被新创建的 vm.$el 替换，并挂载到实例上去之后调用该钩子。如果 root 实例挂载了一个文档内元素，当 mounted 被调用时 vm.$el 也在文档内。</p><p>注意 mounted 不会承诺所有的子组件也都一起被挂载。如果你希望等到整个视图都渲染完毕，可以用 vm.$nextTick 替换掉 mounted：</p><p><code>mounted: function () {  this.$nextTick(function () {    // Code that will run only after the    // entire view has been rendered  })}</code></p><h2 id="beforeUpdate"><a href="#beforeUpdate" class="headerlink" title="beforeUpdate"></a>beforeUpdate</h2><p>数据更新时调用，发生在虚拟 DOM 打补丁之前。</p><p>这里适合在更新之前访问现有的 DOM，比如手动移除已添加的事件监听器。</p><h2 id="updated"><a href="#updated" class="headerlink" title="updated"></a>updated</h2><p>当这个钩子被调用时，组件 DOM 已经更新，所以你现在可以执行依赖于 DOM 的操作。</p><p>然而在大多数情况下，你应该避免在此期间更改状态。</p><p>如果要相应状态改变，通常最好使用计算属性或 watcher 取而代之。</p><p>updated 不会承诺所有的子组件也都一起被重绘。如果你希望等到整个视图都重绘完毕，可以用 vm.$nextTick 替换掉 updated</p><p><code>updated: function () {  this.$nextTick(function () {    // Code that will run only after the    // entire view has been re-rendered  })}</code></p><h2 id="beforeDestroy"><a href="#beforeDestroy" class="headerlink" title="beforeDestroy"></a>beforeDestroy</h2><p>实例销毁之前调用。在这一步，实例仍然完全可用</p><h2 id="destroyed"><a href="#destroyed" class="headerlink" title="destroyed"></a>destroyed</h2><p>Vue 实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;div class=&quot;note&quot;&gt;&lt;br&gt;    &lt;h5&gt;数据更新DOM不刷新&lt;/h5&gt;&lt;br&gt;    &lt;p&gt;以下几个api是针对DOM刷新问题&lt;/p&gt;&lt;br&gt;&lt;/div&gt;

&lt;h2 id=&quot;Vue-nextTick&quot;&gt;&lt;a href=&quot;#Vue-nextTick&quot; class
      
    
    </summary>
    
    
      <category term="vue" scheme="babylovelin.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript 图表库</title>
    <link href="babylovelin.github.io/2018/03/18/javascriptChartingLib/"/>
    <id>babylovelin.github.io/2018/03/18/javascriptChartingLib/</id>
    <published>2018-03-18T03:39:16.000Z</published>
    <updated>2018-03-19T06:00:27.108Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Chatr-js"><a href="#Chatr-js" class="headerlink" title="Chatr.js"></a>Chatr.js</h2><h2 id="Chartist"><a href="#Chartist" class="headerlink" title="Chartist"></a>Chartist</h2><h2 id="FlexChart"><a href="#FlexChart" class="headerlink" title="FlexChart"></a>FlexChart</h2><h2 id="Echarts"><a href="#Echarts" class="headerlink" title="Echarts"></a>Echarts</h2><h2 id="NVD3"><a href="#NVD3" class="headerlink" title="NVD3"></a>NVD3</h2><h2 id="C3-JS"><a href="#C3-JS" class="headerlink" title="C3.JS"></a>C3.JS</h2><h2 id="TauCharts"><a href="#TauCharts" class="headerlink" title="TauCharts"></a>TauCharts</h2><h2 id="ReCharts"><a href="#ReCharts" class="headerlink" title="ReCharts"></a>ReCharts</h2><h2 id="Flot"><a href="#Flot" class="headerlink" title="Flot"></a>Flot</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Chatr-js&quot;&gt;&lt;a href=&quot;#Chatr-js&quot; class=&quot;headerlink&quot; title=&quot;Chatr.js&quot;&gt;&lt;/a&gt;Chatr.js&lt;/h2&gt;&lt;h2 id=&quot;Chartist&quot;&gt;&lt;a href=&quot;#Chartist&quot; class=&quot;head
      
    
    </summary>
    
    
      <category term="拓展" scheme="babylovelin.github.io/tags/%E6%8B%93%E5%B1%95/"/>
    
  </entry>
  
  <entry>
    <title>vue 教程 computed watcher class style v-for v-if 事件 表单 组件 指令</title>
    <link href="babylovelin.github.io/2018/03/15/vue/"/>
    <id>babylovelin.github.io/2018/03/15/vue/</id>
    <published>2018-03-15T06:42:18.000Z</published>
    <updated>2018-03-20T07:50:03.037Z</updated>
    
    <content type="html"><![CDATA[<h2 id="computed-watcher-class-style-v-for-v-if-事件-表单"><a href="#computed-watcher-class-style-v-for-v-if-事件-表单" class="headerlink" title="computed watcher class style v-for v-if 事件 表单"></a>computed watcher class style v-for v-if 事件 表单</h2><h2 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h2><p>  在这个属性中对绑定的属性进行操作，这样会让模板简洁</p><p>  会对数据进行缓存。当绑定的数据没有发生变化时，会立刻返回数据。</p><p>  数据量巨大时，缓存会取得巨大的收益</p><p>  methods 会每次进行计算。不需要缓存的话，就用methods。</p><p>  在这里，computed中只会默认设置getter，需要时，我们还可以设置setter</p><p>  <code>computed: {  fullName: {    // getter 函数    get: function () {      return this.firstName + &#39; &#39; + this.lastName    },    // setter 函数    set: function (newValue) {      var names = newValue.split(&#39; &#39;)      this.firstName = names[0]      this.lastName = names[names.length - 1]    }  }  }</code></p><h2 id="watcher"><a href="#watcher" class="headerlink" title="watcher"></a>watcher</h2><pre><code>当你需要在数据变化响应时，执行异步操作，或高性能消耗的操作，自定义 watcher 的方式就会很有帮助。当监听一个数据时，需要去调用另外一个函数，并且，函数会执行一个异步操作我们执行一个限制执行频率的（访问一个 API 的）异步操作，并且不断地设置中间状态，直到我们获取到最终的answer 数据之后，才真正执行异步操作  （可以使用 \_.debounce 来限制频率。）</code></pre><h2 id="class-和-style"><a href="#class-和-style" class="headerlink" title="class 和 style"></a>class 和 style</h2><p>  表达式结果的类型除了字符串之外，还可以是对象或数组。</p><h4 id="class"><a href="#class" class="headerlink" title="class"></a>class</h4><p>  切换两种class ,数组语法和对象语法共同使用</p><p>  <code>v-bind:class=&quot;[{ active: isActive }, {errorClass: isErr}]&quot;</code></p><p>  也可以不内联在里面，如</p><p>  <code>&lt;div v-bind:class=&quot;classObject&quot;&gt;&lt;/div&gt;data: {  classObject: {    active: true,    &#39;text-danger&#39;: false  }}</code></p><p>  在这里依然可以用cumputed，来返回一个计算属性</p><p>  <code>&lt;div v-bind:style=&quot;styleObject&quot;&gt;&lt;/div&gt;  data: {    styleObject: {      color: &#39;red&#39;,      fontSize: &#39;13px&#39;    }  }</code></p><p>  <code>&lt;div v-bind:class=&quot;classObject&quot;&gt;&lt;/div&gt;data: {  isActive: true,  error: null},computed: {  classObject: function () {    return {      active: this.isActive &amp;&amp; !this.error,      &#39;text-danger&#39;: this.error &amp;&amp; this.error.type === &#39;fatal&#39;    }  }}</code></p><p>  数组语法和数组+对象的混合语法，支持三元表达式</p><p>  <code>&lt;div v-bind:class=&quot;[{ active: isActive }, errorClass]&quot;&gt;&lt;/div&gt;</code></p><h4 id="style"><a href="#style" class="headerlink" title="style"></a>style</h4><p>  内联style 一个比较好的做法是，直接与 data 中的 style 对象绑定，这样模板看起来更清晰</p><p>  这样还能更好的应用计算属性</p><h2 id="条件渲染-v-if-v-show"><a href="#条件渲染-v-if-v-show" class="headerlink" title="条件渲染 v-if v-show"></a>条件渲染 v-if v-show</h2><h4 id="用-key-管理可复用的元素"><a href="#用-key-管理可复用的元素" class="headerlink" title="用 key 管理可复用的元素"></a>用 key 管理可复用的元素</h4><p>  如果两个模板使用了相同的元素，那么他们不是完全独立的， Vue提供了一种方式来表达“这两个元素是完全独立的，不要复用它们”。<br>  只需添加一个具有唯一值的 key 属性即可：</p><p>  <code>&lt;template v-if=&quot;loginType === &#39;username&#39;&quot;&gt;    &lt;label&gt;Username&lt;/label&gt;    &lt;input placeholder=&quot;Enter your username&quot; key=&quot;username-input&quot;&gt;  &lt;/template&gt;  &lt;template v-else&gt;    &lt;label&gt;Email&lt;/label&gt;    &lt;input placeholder=&quot;Enter your email address&quot; key=&quot;email-input&quot;&gt;  &lt;/template&gt;</code></p><p>  v-if 有更高的切换开销，而 v-show 有更高的初始渲染开销。</p><p>  因此，如果需要非常频繁地切换，则使用 v-show 较好；</p><p>  如果在运行时条件很少改变，则使用 v-if 较好。</p><h4 id="数组更新检测"><a href="#数组更新检测" class="headerlink" title="数组更新检测"></a>数组更新检测</h4><p>  由于 JavaScript 的限制，Vue 不能检测以下变动的数组：</p><p>  当你利用索引直接设置一个项时，例如：<code>vm.items[indexOfItem] = newValue</code></p><p>  当你修改数组的长度时，例如：<code>vm.items.length = newLength</code></p><p>  <code>var vm = new Vue({  data: {    items: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]  }})vm.items[1] = &#39;x&#39; // 不是响应性的vm.items.length = 2 // 不是响应性的</code></p><p>  解决办法：</p><p><code>// Vue.setVue.set(vm.items, indexOfItem, newValue)// Array.prototype.splicevm.items.splice(indexOfItem, 1, newValue)</code></p><p><code>你也可以使用 vm.$set 实例方法，该方法是全局方法 Vue.set 的一个别名：vm.$set(vm.items, indexOfItem, newValue)为了解决第二类问题，你可以使用 splice：vm.items.spl你应该这样做：ice(newLength)</code></p><h4 id="对象更改检测注意事项"><a href="#对象更改检测注意事项" class="headerlink" title="对象更改检测注意事项"></a>对象更改检测注意事项</h4><p>  有时你可能需要为已有对象赋予多个新属性，比如使用 Object.assign()</p><p>  在这种情况下，你应该用两个对象的属性创建一个新的对象。</p><p>  所以，如果你想添加新的响应式属性，不要像这样：</p><p>  <code>Object.assign(vm.userProfile, {  age: 27,  favoriteColor: &#39;Vue Green&#39;})</code></p><p>  你应该这样做：</p><p>  <code>vm.userProfile = Object.assign({}, vm.userProfile, {  age: 27,  favoriteColor: &#39;Vue Green&#39;})</code></p><h4 id="显示过滤-排序结果"><a href="#显示过滤-排序结果" class="headerlink" title="显示过滤/排序结果"></a>显示过滤/排序结果</h4><h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>  在computed或者methods中，用来过滤数据</p><p>  <code>data: {  numbers: [ 1, 2, 3, 4, 5 ]},computed: {  evenNumbers: function () {    return this.numbers.filter(function (number) {      return number % 2 === 0    })  }}</code></p><h2 id="事件处理"><a href="#事件处理" class="headerlink" title="事件处理"></a>事件处理</h2><h4 id="访问原生事件对象"><a href="#访问原生事件对象" class="headerlink" title="访问原生事件对象"></a>访问原生事件对象</h4><p>  从内联中把$event传进去</p><p>  <code>v-on:click=&quot;warn(&#39;Form cannot be submitted yet.&#39;, $event)&quot;</code></p><p>  <code>if (event) event.preventDefault()</code></p><h4 id="事件修饰符"><a href="#事件修饰符" class="headerlink" title="事件修饰符"></a>事件修饰符</h4><p><code>&lt;!-- 阻止单击事件继续传播 --&gt;&lt;a v-on:click.stop=&quot;doThis&quot;&gt;&lt;/a&gt;</code></p><p><code>&lt;!-- 提交事件不再重载页面 --&gt;  &lt;form v-on:submit.prevent=&quot;onSubmit&quot;&gt;&lt;/form&gt;</code></p><p><code>&lt;!-- 修饰符可以串联 --&gt;  &lt;a v-on:click.stop.prevent=&quot;doThat&quot;&gt;&lt;/a&gt;</code></p><p><code>&lt;!-- 只有修饰符 --&gt;  &lt;form v-on:submit.prevent&gt;&lt;/form&gt;</code></p><p><code>&lt;!-- 添加事件监听器时使用事件捕获模式 --&gt;&lt;!-- 即元素自身触发的事件先在此处处理，然后才交由内部元素进行处理 --&gt;  &lt;div v-on:click.capture=&quot;doThis&quot;&gt;...&lt;/div&gt;</code></p><p><code>&lt;!-- 只当在 event.target 是当前元素自身时触发处理函数 --&gt;&lt;!-- 即事件不是从内部元素触发的 --&gt;  &lt;div v-on:click.self=&quot;doThat&quot;&gt;...&lt;/div&gt;</code></p><p><code>&lt;a v-on:click.once=&quot;doThis&quot;&gt;&lt;/a&gt; 点击事件只会触发一次</code></p><h4 id="passive-修饰符尤其能够提升移动端的性能。"><a href="#passive-修饰符尤其能够提升移动端的性能。" class="headerlink" title=".passive   修饰符尤其能够提升移动端的性能。"></a>.passive   修饰符尤其能够提升移动端的性能。</h4><p>  .passive 会告诉浏览器你不想阻止事件的默认行为。 所以不要用.prevent</p><p><code>&lt;!-- 滚动事件的默认行为 (即滚动行为) 将会立即触发 --&gt;&lt;!-- 而不会等待 &quot;onScroll&quot; 完成  --&gt;&lt;!-- 这其中包含 &quot;event.preventDefault()&quot; 的情况 --&gt;  &lt;div v-on:scroll.passive=&quot;onScroll&quot;&gt;...&lt;/div&gt;</code></p><h4 id="注意修饰符的顺序"><a href="#注意修饰符的顺序" class="headerlink" title="注意修饰符的顺序"></a>注意修饰符的顺序</h4><p>  <code>使用修饰符时，顺序很重要；相应的代码会以同样的顺序产生。  因此，用 v-on:click.prevent.self 会阻止所有的点击，  而 v-on:click.self.prevent 只会阻止对元素自身的点击。</code></p><h2 id="表单输入"><a href="#表单输入" class="headerlink" title="表单输入"></a>表单输入</h2><h4 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h4><p>  .lazy</p><p>  <code>&lt;!-- 在“change”时而非“input”时更新 --&gt;  &lt;input v-model.lazy=&quot;msg&quot; &gt;</code></p><p>  .number   自动将用户的输入值转为数值类型</p><p>  <code>&lt;input v-model.number=&quot;age&quot; type=&quot;number&quot;&gt;</code></p><p>  .trim 自动过滤用户输入的首尾空白字符</p><p>  <code>&lt;input v-model.trim=&quot;msg&quot;&gt;</code></p><h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><h4 id="非父子组件的通信"><a href="#非父子组件的通信" class="headerlink" title="非父子组件的通信"></a>非父子组件的通信</h4><p>  在简单的场景下，可以使用一个空的 Vue 实例作为事件总线：</p><p>  <code>var bus = new Vue()// 触发组件 A 中的事件bus.$emit(&#39;id-selected&#39;, 1)// 在组件 B 创建的钩子中监听事件bus.$on(&#39;id-selected&#39;, function (id) {  // ...})</code></p><h4 id="单个插槽-slot"><a href="#单个插槽-slot" class="headerlink" title="单个插槽 slot"></a>单个插槽 slot</h4><p>   <slot> 标签中的任何内容都被视为备用内容</slot></p><p>   备用内容在子组件的作用域内编译，并且只有在宿主元素为空，且没有要插入的内容时才显示备用内容</p><h4 id="具名插槽"><a href="#具名插槽" class="headerlink" title="具名插槽"></a>具名插槽</h4><h2 id="过渡-amp-动画"><a href="#过渡-amp-动画" class="headerlink" title="过渡&amp;动画"></a>过渡&amp;动画</h2><p>  Vue 提供了 transition 的封装组件，在下列情形中，可以给任何元素和组件添加 entering/leaving 过渡</p><p>  <code>&lt;div id=&quot;demo&quot;&gt;  &lt;button v-on:click=&quot;show = !show&quot;&gt;    Toggle  &lt;/button&gt;  &lt;transition name=&quot;fade&quot;&gt;    &lt;p v-if=&quot;show&quot;&gt;hello&lt;/p&gt;  &lt;/transition&gt;&lt;/div&gt;</code></p><p><code>.fade-enter-active, .fade-leave-active {  transition: opacity .5s;}.fade-enter, .fade-leave-to /* .fade-leave-active below version 2.1.8 */ {  opacity: 0;}</code></p><h4 id="在进入-离开的过渡中，会有-6-个-class-切换。"><a href="#在进入-离开的过渡中，会有-6-个-class-切换。" class="headerlink" title="在进入/离开的过渡中，会有 6 个 class 切换。"></a>在进入/离开的过渡中，会有 6 个 class 切换。</h4><p>  v-enter：定义进入过渡的开始状态</p><p>  v-enter-active：定义过渡的状态</p><p>  v-enter-to：2.1.8版及以上 定义进入过渡的结束状态</p><p>  v-leave: 定义离开过渡的开始状态</p><p>  v-leave-active：定义过渡的状态</p><p>  v-leave-to: 2.1.8版及以上 定义离开过渡的结束状态</p><h4 id="css-过渡"><a href="#css-过渡" class="headerlink" title="css 过渡"></a>css 过渡</h4><p><code>/* 可以设置不同的进入和离开动画 *//* 设置持续时间和动画函数 */.slide-fade-enter-active {  transition: all .3s ease;}.slide-fade-leave-active {  transition: all .8s cubic-bezier(1.0, 0.5, 0.8, 1.0);}.slide-fade-enter, .slide-fade-leave-to/* .slide-fade-leave-active for below version 2.1.8 */ {  transform: translateX(10px);  opacity: 0;}</code></p><h4 id="css-动画"><a href="#css-动画" class="headerlink" title="css 动画"></a>css 动画</h4><p><code>.bounce-enter-active {  animation: bounce-in .5s;}.bounce-leave-active {  animation: bounce-in .5s reverse;}@keyframes bounce-in {  0% {    transform: scale(0);  }  50% {    transform: scale(1.5);  }  100% {    transform: scale(1);  }}</code></p><h4 id="自定义过渡类名"><a href="#自定义过渡类名" class="headerlink" title="自定义过渡类名"></a>自定义过渡类名</h4><p>  在结合animate动画库时相当给力，在这里，他们的类名优先级高于普通的类名</p><p>  enter-class</p><p>  enter-active-class</p><p>  enter-to-class (2.1.8+)</p><p>  leave-class</p><p>  leave-active-class</p><p>  leave-to-class (2.1.8+)</p><p><code>&lt;transition    name=&quot;custom-classes-transition&quot;    enter-active-class=&quot;animated tada&quot;    leave-active-class=&quot;animated bounceOutRight&quot;&gt;    &lt;p v-if=&quot;show&quot;&gt;hello&lt;/p&gt;  &lt;/transition&gt;</code></p><p>定义显性的过渡时间</p><p><code>&lt;transition :duration=&quot;{ enter: 500, leave: 800 }&quot;&gt;...&lt;/transition&gt;</code></p><h4 id="过渡模式"><a href="#过渡模式" class="headerlink" title="过渡模式"></a>过渡模式</h4><p>in-out：新元素先进行过渡，完成之后当前元素过渡离开。</p><p>out-in：当前元素先进行过渡，完成之后新元素过渡进入。</p><h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><p>全局指令和局部指令</p><p><code>// 注册一个全局自定义指令 &#39;v-focus&#39;Vue.directive(&#39;focus&#39;, {  // 当被绑定的元素插入到 DOM 中时……  inserted: function (el) {    // 聚焦元素    el.focus()  }})</code></p><p><code>directives: {  focus: {    // 指令的定义    inserted: function (el) {      el.focus()    }  }}</code></p><p>然后你可以在模板中任何元素上使用新的 v-focus 属性</p><p><code>&lt;input v-focus&gt;</code></p><h4 id="钩子函数"><a href="#钩子函数" class="headerlink" title="钩子函数"></a>钩子函数</h4><p>bind：只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置。</p><p>inserted：被绑定元素插入父节点时调用 (仅保证父节点存在，但不一定已被插入文档中)。</p><p>update：所在组件的 VNode 更新时调用，但是可能发生在其子 VNode 更新之前。<br>指令的值可能发生了改变，也可能没有。但是你可以通过比较更新前后的值来忽略不必要的模板更新</p><p>componentUpdated：指令所在组件的 VNode 及其子 VNode 全部更新后调用</p><p>unbind：只调用一次，指令与元素解绑时调用</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;computed-watcher-class-style-v-for-v-if-事件-表单&quot;&gt;&lt;a href=&quot;#computed-watcher-class-style-v-for-v-if-事件-表单&quot; class=&quot;headerlink&quot; title=&quot;co
      
    
    </summary>
    
    
      <category term="vue" scheme="babylovelin.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>js/cssLib</title>
    <link href="babylovelin.github.io/2018/03/15/js-cssLib/"/>
    <id>babylovelin.github.io/2018/03/15/js-cssLib/</id>
    <published>2018-03-15T02:36:21.000Z</published>
    <updated>2018-03-19T06:00:33.747Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Direction-Reveal"><a href="#Direction-Reveal" class="headerlink" title="Direction Reveal"></a>Direction Reveal</h2><p>  方向展示，在一个盒子上有相应描述，不同的展示描述形式</p><h2 id="Axios"><a href="#Axios" class="headerlink" title="Axios"></a>Axios</h2><p>  基于promise的API，在浏览器和nodejs环境下都可以运行</p><h2 id="JARVIS"><a href="#JARVIS" class="headerlink" title="JARVIS"></a>JARVIS</h2><p>  基于webpack仪表盘的智能浏览器，展示资源在12种不同的连接类型的表现。<br>  项目中所有包的大小，漂亮的错误输出。</p><h2 id="micron-js"><a href="#micron-js" class="headerlink" title="micron.js"></a>micron.js</h2><p>  Micron是一个允许你为DOM元素添加不同的CSS增强动画的库。</p><p>  摇晃，褪色，反弹，摇摆等</p><h2 id="lit-非常小的响应式CSS框架。"><a href="#lit-非常小的响应式CSS框架。" class="headerlink" title="lit 非常小的响应式CSS框架。"></a>lit 非常小的响应式CSS框架。</h2><p>  包含12列响应式网格，不同排印风格，自定义输入，三种按钮类型，CSS框架应该有的所有功能。</p><h2 id="Minimal-Mistakes"><a href="#Minimal-Mistakes" class="headerlink" title="Minimal Mistakes"></a>Minimal Mistakes</h2><p>  双列jekyll主题。100%响应式和针对搜索引擎的优化。</p><h2 id="tachyons"><a href="#tachyons" class="headerlink" title="tachyons"></a>tachyons</h2><p>  制作漂亮且响应快速的界面，几乎不需要CSS。移动优先。非常轻量。</p><h2 id="wiki-js"><a href="#wiki-js" class="headerlink" title="wiki.js"></a>wiki.js</h2><h2 id="phaser"><a href="#phaser" class="headerlink" title="phaser"></a>phaser</h2><p>  快速开元框架，开发运行在桌面浏览器或手机浏览器的H5游戏。</p><h2 id="sweetAlert"><a href="#sweetAlert" class="headerlink" title="sweetAlert"></a>sweetAlert</h2><p>  创建漂亮的可响应弹出框的库。</p><h2 id="Nerd字体"><a href="#Nerd字体" class="headerlink" title="Nerd字体"></a>Nerd字体</h2><pre><code>流行字体和图标集合。</code></pre><h2 id="kutt-免费缩短URL"><a href="#kutt-免费缩短URL" class="headerlink" title="kutt 免费缩短URL"></a>kutt 免费缩短URL</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Direction-Reveal&quot;&gt;&lt;a href=&quot;#Direction-Reveal&quot; class=&quot;headerlink&quot; title=&quot;Direction Reveal&quot;&gt;&lt;/a&gt;Direction Reveal&lt;/h2&gt;&lt;p&gt;  方向展示，在一个盒子上有
      
    
    </summary>
    
    
      <category term="拓展" scheme="babylovelin.github.io/tags/%E6%8B%93%E5%B1%95/"/>
    
  </entry>
  
  <entry>
    <title>Git 常用命令</title>
    <link href="babylovelin.github.io/2018/03/14/git/"/>
    <id>babylovelin.github.io/2018/03/14/git/</id>
    <published>2018-03-14T09:36:53.000Z</published>
    <updated>2018-03-19T06:01:05.964Z</updated>
    
    <content type="html"><![CDATA[<h2 id="在Linux上安装Git"><a href="#在Linux上安装Git" class="headerlink" title="在Linux上安装Git"></a>在Linux上安装Git</h2><p><code>sudo apt-get install git</code></p><p><code>$ git config --global user.name &quot;Your Name&quot;$ git config --global user.email &quot;email@example.com&quot;</code></p><h2 id="创建版本库"><a href="#创建版本库" class="headerlink" title="创建版本库"></a>创建版本库</h2><p>  通过git init命令把这个目录变成Git可以管理的仓库</p><p>  <code>$ git init</code></p><p>  第一步，用命令git add告诉Git，把文件添加到仓库</p><p>  <code>$ git add filename</code></p><p>  <code>$ git add .</code> 将全部文件添加到仓库</p><p>  第二步，用命令git commit告诉Git，把文件提交到仓库</p><p>  <code>$ git commit -m &quot;提交的信息&quot;</code></p><h2 id="版本退回"><a href="#版本退回" class="headerlink" title="版本退回"></a>版本退回</h2><p>  版本控制系统肯定有某个命令可以告诉我们历史记录，在Git中，我们用git log命令查看：</p><p>  <code>$ git log</code>  显示从最近到最远的提交日志</p><p>  <code>$ git reset --hard</code>  回退到上一个版本</p><p>  命令git reflog用来记录你的每一次命令</p><p>  <code>$ git reflog</code></p><h2 id="工作区和暂存区"><a href="#工作区和暂存区" class="headerlink" title="工作区和暂存区"></a>工作区和暂存区</h2><p>  Git和其他版本控制系统如SVN的一个不同之处就是有暂存区的概念。</p><p>  工作去就是你在电脑里能看到的目录</p><p>  需要提交的文件修改通通放到暂存区，然后，一次性提交暂存区的所有修改</p><p>  git status查看一下状态：</p><p>  <code>$ git status</code></p><h2 id="管理修改"><a href="#管理修改" class="headerlink" title="管理修改"></a>管理修改</h2><p>  Git管理的是修改，当你用git add命令后，在工作区的第一次修改被放入暂存区，准备提交，</p><p>  但是，在工作区的第二次修改并没有放入暂存区，所以，git commit只负责把暂存区的修改提交了，也就是第一次的修改被提交了，第二次的修改不会被提交。</p><p>  <code>git diff HEAD -- readme.txt</code>  查看工作区和版本库里面最新版本的区别：</p><h2 id="撤销修改"><a href="#撤销修改" class="headerlink" title="撤销修改"></a>撤销修改</h2><p>  命令git checkout – readme.txt意思就是，把readme.txt文件在工作区的修改全部撤销</p><p>  <code>git checkout -- readme.txt</code> 总之，就是让这个文件回到最近一次git commit或git add时的状态</p><p>  git checkout – file可以丢弃工作区的修改：</p><p>  用命令git reset HEAD file可以把暂存区的修改撤销掉（unstage），重新放回工作区</p><p>  <code>git reset HEAD file</code></p><h2 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h2><p>  一般情况下，你通常直接在文件管理器中把没用的文件删了，或者用rm命令删了</p><p>  Git知道你删除了文件，因此，工作区和版本库就不一致了，git status命令会立刻告诉你哪些文件被删除了</p><p>  现在你有两个选择，一是确实要从版本库中删除该文件，那就用命令git rm删掉，并且git commit</p><p>  <code>$ git rm test.txt</code></p><p>  <code>$ git commit -m &quot;remove test.txt&quot;</code></p><p>  另一种情况是删错了，因为版本库里还有呢，所以可以很轻松地把误删的文件恢复到最新版本：</p><p>  <code>$ git checkout -- test.txt</code></p><h2 id="添加远程库"><a href="#添加远程库" class="headerlink" title="添加远程库"></a>添加远程库</h2><p>  已经在本地创建了一个Git仓库后，又想在GitHub创建一个Git仓库，并且让这两个仓库进行远程同步，这样，GitHub上的仓库既可以作为备份，又可以让其他人通过该仓库来协作</p><p>  GitHub告诉我们，可以从这个仓库克隆出新的仓库，也可以把一个已有的本地仓库与之关联</p><p>  <code>$ git remote add origin git@github.com:michaelliao/learngit.git</code></p><p>  远程库的名字就是origin，这是Git默认的叫法，也可以改成别的，但是origin这个名字一看就知道是远程库。</p><p>  把本地库的所有内容推送到远程库上</p><p>  <code>$ git push -u origin master</code>  用git push命令，实际上是把当前分支master推送到远程。</p><p>  加上了-u参数，Git不但会把本地的master分支内容推送的远程新的master分支，还会把本地的master分支和远程的master分支关联起来，在以后的推送或者拉取时就可以简化命令</p><p>  从现在起，只要本地作了提交，就可以通过命令：</p><p>  <code>$ git push origin master</code></p><h2 id="从远程库克隆"><a href="#从远程库克隆" class="headerlink" title="从远程库克隆"></a>从远程库克隆</h2><p>  <code>$ git clone git@github.com:michaelliao/gitskills.git</code></p><h2 id="创建与合并分支"><a href="#创建与合并分支" class="headerlink" title="创建与合并分支"></a>创建与合并分支</h2><p>  我们创建dev分支，然后切换到dev分支</p><p>  <code>$ git checkout -b dev</code>  命令加上-b参数表示创建并切换</p><p>  然后，用git branch命令查看当前分支</p><p>  <code>$ git branch</code></p><p>  然后提交：</p><p>  <code>$ git add readme.txt  $ git commit -m &quot;branch test&quot;</code></p><p>  dev分支的工作完成，我们就可以切换回master分支</p><p>  <code>$ git checkout master</code></p><p>  切换回master分支后，再查看一个readme.txt文件，刚才添加的内容不见了！因为那个提交是在dev分支上，而master分支此刻的提交点并没有变</p><p>  我们把dev分支的工作成果合并到master分支上：</p><p>  <code>$ git merge dev</code></p><p>  合并完成后，就可以放心地删除dev分支了</p><p>  <code>$ git branch -d dev</code></p><p>  小结</p><p>  <code>Git鼓励大量使用分支：  查看分支：git branch  创建分支：git branch &lt;name&gt;  切换分支：git checkout &lt;name&gt;  创建+切换分支：git checkout -b &lt;name&gt;  合并某分支到当前分支：git merge &lt;name&gt;  删除分支：git branch -d &lt;name&gt;</code></p><h2 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h2><p>  合并分支时，如果可能，Git会用Fast forward模式，但这种模式下，删除分支后，会丢掉分支信息</p><p>  准备合并dev分支，请注意–no-ff参数，表示禁用Fast forward：</p><p>  如果要强制禁用Fast forward模式，Git就会在merge时生成一个新的commit，这样，从分支历史上就可以看出分支信息</p><p>  <code>$ git merge --no-ff -m &quot;merge with no-ff&quot; dev</code></p><h2 id="BUG-分支"><a href="#BUG-分支" class="headerlink" title="BUG 分支"></a>BUG 分支</h2><p>  Git还提供了一个stash功能，可以把当前工作现场“储藏”起来，等以后恢复现场后继续工作</p><p>  <code>$ git stash</code></p><p>  用<code>git status</code>查看工作区，就是干净的（除非有没有被Git管理的文件），因此可以放心地创建分支来修复bug</p><p>  首先确定要在哪个分支上修复bug，假定需要在master分支上修复，就从master创建临时分支</p><p>  <code>$ git checkout master$ git checkout -b issue-101$ git add readme.txt$ git commit -m &quot;fix bug 101&quot;</code><br>  修复完成后，切换到master分支，并完成合并，最后删除issue-101分支</p><p>  <code>$ git checkout master$ git merge --no-ff -m &quot;merged bug fix 101&quot; issue-101$ git branch -d issue-101</code></p><p>  现在，是时候接着回到dev分支干活了</p><p>  <code>$ git checkout dev$ git status</code></p><p>  工作区是干净的，刚才的工作现场存到哪去了？用git stash list命令看看</p><p>  <code>$ git stash list</code></p><p>  工作现场还在，Git把stash内容存在某个地方了，但是需要恢复一下</p><p>  <code>一是用git stash apply恢复，但是恢复后，stash内容并不删除，你需要用git stash drop来删除；另一种方式是用git stash pop，恢复的同时把stash内容也删了：</code></p><p>  <code>$ git stash pop</code></p><p>  你可以多次stash，恢复的时候，先用git stash list查看，然后恢复指定的stash，用命令</p><p>  <code>$ git stash apply stash@{0}</code></p><h2 id="Feature分支"><a href="#Feature分支" class="headerlink" title="Feature分支"></a>Feature分支</h2><p>  添加一个新功能时，你肯定不希望因为一些实验性质的代码，把主分支搞乱了，所以，每添加一个新功能，最好新建一个feature分支，在上面开发，完成后，合并，最后，删除该feature分支</p><p>  <code>$ git checkout -b feature-vulcan</code></p><p>  <code>$ git add vulcan.py$ git status$ git commit -m &quot;add feature vulcan&quot;</code></p><p>  切换回dev</p><p>  <code>$ git checkout dev</code></p><p>  一切顺利的话，feature分支和bug分支是类似的，合并，然后删除</p><p>  就在此时，接到上级命令，因经费不足，新功能必须取消！</p><p>  虽然白干了，但是这个分支还是必须就地销毁：</p><p>  <code>$ git branch -d feature-vulcan</code></p><p>  Git友情提醒，feature-vulcan分支还没有被合并，如果删除，将丢失掉修改，如果要强行删除，需要使用命令git branch -D feature-vulcan。</p><p>  <code>$ git branch -D feature-vulcan</code></p><h2 id="多人协作"><a href="#多人协作" class="headerlink" title="多人协作"></a>多人协作</h2><p>  要查看远程库的信息，用git remote</p><p>  <code>$ git remote</code></p><p>  用git remote -v显示更详细的信息</p><p>  <code>$ git remote -v</code></p><p>  推送分支，就是把该分支上的所有本地提交推送到远程库。推送时，要指定本地分支，这样，Git就会把该分支推送到远程库对应的远程分支上</p><p>  <code>$ git push origin master</code></p><p>  如果要推送其他分支，比如dev，就改成：</p><p>  <code>$ git push origin dev</code></p><p>  抓取分支</p><p>  <code>$ git clone git@github.com:michaelliao/learngit.git</code></p><p>  当你的小伙伴从远程库clone时，默认情况下，你的小伙伴只能看到本地的master分支</p><p>  <code>$ git branch</code></p><p>  你的小伙伴要在dev分支上开发，就必须创建远程origin的dev分支到本地，于是他用这个命令创建本地dev分支</p><p>  <code>$ git checkout -b dev origin/dev</code></p><p>  他就可以在dev上继续修改，然后，时不时地把dev分支push到远程</p><p>  <code>$ git commit -m &quot;add /usr/bin/env&quot;</code></p><p>  <code>$ git push origin dev</code></p><p>  你的小伙伴已经向origin/dev分支推送了他的提交，而碰巧你也对同样的文件作了修改</p><p>  推送失败，因为你的小伙伴的最新提交和你试图推送的提交有冲突，解决办法也很简单，Git已经提示我们，先用git pull把最新的提交从origin/dev抓下来，然后，在本地合并，解决冲突，再推送：</p><p>  <code>$ git pull</code></p><p>  git pull也失败了，原因是没有指定本地dev分支与远程origin/dev分支的链接，根据提示，设置dev和origin/dev的链接</p><p>  <code>$ git branch</code></p><p>  再pull：</p><p>  <code>$ git pull</code></p><p>  这回git pull成功，但是合并有冲突，需要手动解决，解决的方法和分支管理中的解决冲突完全一样</p><h4 id="多人协作的工作模式通常是这样"><a href="#多人协作的工作模式通常是这样" class="headerlink" title="多人协作的工作模式通常是这样"></a>多人协作的工作模式通常是这样</h4><p>  首先，可以试图用git push origin branch-name推送自己的修改；</p><p>  如果推送失败，则因为远程分支比你的本地更新，需要先用git pull试图合并；</p><p>  如果合并有冲突，则解决冲突，并在本地提交；</p><p>  没有冲突或者解决掉冲突后，再用git push origin branch-name推送就能成功！</p><p>  如果git pull提示“no tracking information”，则说明本地分支和远程分支的链接关系没有创建，用命令git branch –set-upstream branch-name origin/branch-name。</p><p>  这就是多人协作的工作模式，一旦熟悉了，就非常简单。</p><p>  总结：</p><p>  查看远程库信息，使用git remote -v；</p><p>  本地新建的分支如果不推送到远程，对其他人就是不可见的；</p><p>  从本地推送分支，使用git push origin branch-name，如果推送失败，先用git pull抓取远程的新提交；</p><p>  在本地创建和远程分支对应的分支，使用git checkout -b branch-name origin/branch-name，本地和远程分支的名称最好一致；</p><p>  建立本地分支和远程分支的关联，使用git branch –set-upstream branch-name origin/branch-name；</p><p>  从远程抓取分支，使用git pull，如果有冲突，要先处理冲突。</p><h2 id="创建标签"><a href="#创建标签" class="headerlink" title="创建标签"></a>创建标签</h2><p>  在Git中打标签非常简单，首先，切换到需要打标签的分支上</p><p>  <code>$ git branch</code><br>  <code>$ git checkout master</code></p><p>  然后，敲命令git tag <name>就可以打一个新标签：</name></p><p>  <code>$ git tag v1.0</code></p><p>  可以用命令git tag查看所有标签：</p><p>  <code>$ git tag</code></p><p>  补充标签</p><p>  方法是找到历史提交的commit id，然后打上就可以了</p><p>  <code>$ git log --pretty=oneline --abbrev-commit</code></p><p>  比方说要对add merge这次提交打标签，它对应的commit id是6224937，敲入命令：</p><p>  <code>$ git tag v0.9 6224937</code></p><p>  再用命令git tag查看标签：</p><p>  <code>$ git tag</code></p><p>  可以用git show <tagname>查看标签信息</tagname></p><p>  <code>$ git show v0.9</code></p><p>  创建带有说明的标签，用-a指定标签名，-m指定说明文字</p><p>  <code>$ git tag -a v0.1 -m &quot;version 0.1 released&quot; 3628164</code></p><p>  用命令git show <tagname>可以看到说明文字：</tagname></p><p>  <code>$ git show v0.1</code></p><p>  还可以通过-s用私钥签名一个标签：</p><p>  <code>$ git tag -s v0.2 -m &quot;signed version 0.2 released&quot; fec145a</code></p><p>  签名采用PGP签名，因此，必须首先安装gpg（GnuPG），如果没有找到gpg，或者没有gpg密钥对，就会报错</p><p>  用命令git show <tagname>可以看到PGP签名信息</tagname></p><p>  <code>$ git show v0.2</code></p><h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>  命令git tag <name>用于新建一个标签，默认为HEAD，也可以指定一个commit id；</name></p><p>  git tag -a <tagname> -m “blablabla…”可以指定标签信息；</tagname></p><p>  git tag -s <tagname> -m “blablabla…”可以用PGP签名标签；</tagname></p><p>  命令git tag可以查看所有标签。</p><h2 id="操作标签"><a href="#操作标签" class="headerlink" title="操作标签"></a>操作标签</h2><p>  如果标签打错了，也可以删除：  </p><p>  $ git tag -d v0.1</p><p>  因为创建的标签都只存储在本地，不会自动推送到远程。所以，打错的标签可以在本地安全删除</p><p>  如果要推送某个标签到远程，使用命令git push origin <tagname></tagname></p><p>  <code>$ git push origin v1.0</code></p><p>  一次性推送全部尚未推送到远程的本地标签</p><p>  <code>$ git push origin --tags</code></p><p>  如果标签已经推送到远程，要删除远程标签就麻烦一点，先从本地删除</p><p>  <code>$ git tag -d v0.9</code></p><p>  然后，从远程删除。删除命令也是push，但是格式如下：</p><p>  <code>$ git push origin :refs/tags/v0.9</code></p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>  命令git push origin <tagname>可以推送一个本地标签；</tagname></p><p>  命令git push origin –tags可以推送全部未推送过的本地标签；</p><p>  命令git tag -d <tagname>可以删除一个本地标签；</tagname></p><p>  命令git push origin :refs/tags/<tagname>可以删除一个远程标签。</tagname></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;在Linux上安装Git&quot;&gt;&lt;a href=&quot;#在Linux上安装Git&quot; class=&quot;headerlink&quot; title=&quot;在Linux上安装Git&quot;&gt;&lt;/a&gt;在Linux上安装Git&lt;/h2&gt;&lt;p&gt;&lt;code&gt;sudo apt-get install git
      
    
    </summary>
    
    
      <category term="拓展" scheme="babylovelin.github.io/tags/%E6%8B%93%E5%B1%95/"/>
    
  </entry>
  
  <entry>
    <title>cssTip</title>
    <link href="babylovelin.github.io/2018/03/13/Tip/"/>
    <id>babylovelin.github.io/2018/03/13/Tip/</id>
    <published>2018-03-13T10:58:36.000Z</published>
    <updated>2018-03-14T08:54:27.087Z</updated>
    
    <content type="html"><![CDATA[<h4 id="01、css-复位"><a href="#01、css-复位" class="headerlink" title="01、css 复位"></a>01、css 复位</h4><p>  解决如果这个元素有任何的 border 或 padding ，绘制到屏幕上时的盒子宽度和高度会加上设置的边框和内边距值。</p><p>  <code>* {      box-sizing: border-box;      margin: 0; padding: 0;  }</code></p><h4 id="02、继承-box-sizing"><a href="#02、继承-box-sizing" class="headerlink" title="02、继承 box-sizing"></a>02、继承 box-sizing</h4><p>  从html继承box-sizing</p><p>  <code>html {    box-sizing: border-box;    }  *,*:before,*:after {    box-sizing: inhert;  }</code></p><h4 id="03、使用-not-伪类，决定表单是否显示边框"><a href="#03、使用-not-伪类，决定表单是否显示边框" class="headerlink" title="03、使用 :not()伪类，决定表单是否显示边框"></a>03、使用 :not()伪类，决定表单是否显示边框</h4><p>  先为元素添加边框</p><p>  <code>{    .nav li {      border-right: 1px solid #666;    }    }</code></p><p>  为最后一个取出边框</p><p>  <code>.nav li:last-child {      border-right: none;  }</code></p><p>  使用:not()</p><p>  <code>.nav li:not(:last-child){    border-right: 1px solid #666;    }</code></p><h4 id="04、为body元素添加行高"><a href="#04、为body元素添加行高" class="headerlink" title="04、为body元素添加行高"></a>04、为body元素添加行高</h4><p>  不必为每一个 </p><p>，&lt;h*&gt; 元素注意添加line-height 直接添加到 body中</p><p>  <code>body {    line-height: 1.5;    }</code></p><h4 id="05、垂直居中任何元素"><a href="#05、垂直居中任何元素" class="headerlink" title="05、垂直居中任何元素"></a>05、垂直居中任何元素</h4><p>  <code>html, body{    height: 100%; margin: 0;  }  body {    -web-align-items: center;    -ms-flex-align: center;    align-items: center;    display: -webkit-flex;    display: flex;  }</code></p><h4 id="06、-逗号分隔列表"><a href="#06、-逗号分隔列表" class="headerlink" title="06、 逗号分隔列表"></a>06、 逗号分隔列表</h4><p>  <code>ul &gt; li:not(:last-child)::after {    content: &quot;,&quot;    }</code></p><h4 id="07、-使用负的-nth-child-来选选择元素"><a href="#07、-使用负的-nth-child-来选选择元素" class="headerlink" title="07、 使用负的 nth-child 来选选择元素"></a>07、 使用负的 nth-child 来选选择元素</h4><p>  使用负的 nth-child 可以选择 1-n 个元素</p><p>  `li {<br>    display: none;<br>    }<br>    /<em> 选择第 1 至 3 元素并显示 </em>/<br>    li:nth-child(-n+3) {<br>      display: block;<br>    }</p><pre><code>li:not(:nth-child(-n+3)) {  display: none;}`</code></pre><h4 id="08、-使用-SVG"><a href="#08、-使用-SVG" class="headerlink" title="08、 使用 SVG"></a>08、 使用 SVG</h4><p>  <code>.logo {      bachground: url (&#39;logo.svg&#39;)    }</code></p><pre><code>如果SVG没有加载成功的话，以下对无障碍有所帮助`.no-svg .icon-only:after {  content: attr(aris-lable);  }`</code></pre><h4 id="09、-使用形似猫头鹰的选择器"><a href="#09、-使用形似猫头鹰的选择器" class="headerlink" title="09、 使用形似猫头鹰的选择器"></a>09、 使用形似猫头鹰的选择器</h4><p>  文档中所有相邻兄弟元素</p><p>  <code>*+* {    margin-top: 1.5em;    }</code></p><h4 id="10、使用max-height-建立纯css滑块"><a href="#10、使用max-height-建立纯css滑块" class="headerlink" title="10、使用max-height 建立纯css滑块"></a>10、使用max-height 建立纯css滑块</h4><p>  `max-height 和 overflow hidden 一起建立纯css滑块<br>  .slider {<br>    max-height: 200px;<br>    overflow-y: hidden;<br>    width: 300px;<br>  }</p><p>  .slider:hover {<br>    max-height: 600px;<br>    overflow-y:scroll;<br>  }<br>  `</p><h4 id="11、创造格子等宽表格"><a href="#11、创造格子等宽表格" class="headerlink" title="11、创造格子等宽表格"></a>11、创造格子等宽表格</h4><p>  无痛的table布局</p><p>  <code>.calendar {    table-layout: fixed;    }</code></p><h4 id="12、利用flex去除多余的外边距"><a href="#12、利用flex去除多余的外边距" class="headerlink" title="12、利用flex去除多余的外边距"></a>12、利用flex去除多余的外边距</h4><p>  <code>.list {    display: flex;    justify-content: space-between;    }    .list .person{      flex-basis: 23%;      }</code></p><h4 id="13、给默认链接添加样式"><a href="#13、给默认链接添加样式" class="headerlink" title="13、给默认链接添加样式"></a>13、给默认链接添加样式</h4><p>  <code>a[href]:not([class]) {    color:#808080;    text-decoration: underline;    }</code></p><h4 id="14、一致垂直节奏"><a href="#14、一致垂直节奏" class="headerlink" title="14、一致垂直节奏"></a>14、一致垂直节奏</h4><p>  <code>.intro &gt; *{    margin-bottom: 1.2em;    }</code></p><h4 id="15、固定比例盒子"><a href="#15、固定比例盒子" class="headerlink" title="15、固定比例盒子"></a>15、固定比例盒子</h4><p>  使用%20的padding-bottom使得div的高度等于宽度的20%，与视口无关</p><p>  <code>.container {    height: 0;    padding-bottom: 20%;    position: relative;    }    .container div {      border: 2px dashed #ddd;      height: 100%;      left: 0;      position: absolute;      top: 0;      width: 100%;    }</code></p><h4 id="16、为破碎图像定义样式"><a href="#16、为破碎图像定义样式" class="headerlink" title="16、为破碎图像定义样式"></a>16、为破碎图像定义样式</h4><p>  <code>img{    display: block;    font-family: Arial , sans-serif;    font-weight: 300;    height: auto;    line-height: 2;    position: relative;    text-align: center;    width: 100%;    }    img:after {      content:&quot;url:&quot; attr(src) &quot;)&quot;;      display: block;      font-size: 12px;    }</code></p><h4 id="17、rem-调整全局大小，em调整局部大小"><a href="#17、rem-调整全局大小，em调整局部大小" class="headerlink" title="17、rem 调整全局大小，em调整局部大小"></a>17、rem 调整全局大小，em调整局部大小</h4><h4 id="18、隐藏没有静音、自动播放的影片"><a href="#18、隐藏没有静音、自动播放的影片" class="headerlink" title="18、隐藏没有静音、自动播放的影片"></a>18、隐藏没有静音、自动播放的影片</h4><p>  <code>.video[autoplay]:not([muted]){    display:none;    }</code></p><h4 id="19、使用-root控制自体弹性"><a href="#19、使用-root控制自体弹性" class="headerlink" title="19、使用:root控制自体弹性"></a>19、使用:root控制自体弹性</h4><p>  <code>:root {    font-size: calc(1vw + 1wh +.5vmin)    }    body {      font: 1rem/1.6 sans-serif;    }</code></p><h4 id="20、为了更好的移动端体验，为表单元素设置自体大小"><a href="#20、为了更好的移动端体验，为表单元素设置自体大小" class="headerlink" title="20、为了更好的移动端体验，为表单元素设置自体大小"></a>20、为了更好的移动端体验，为表单元素设置自体大小</h4><p>  <code>.htmlinput[type=&#39;text&#39;],  input[type=&#39;number&#39;],  select,textarea {    font-size: 16px;  }</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;01、css-复位&quot;&gt;&lt;a href=&quot;#01、css-复位&quot; class=&quot;headerlink&quot; title=&quot;01、css 复位&quot;&gt;&lt;/a&gt;01、css 复位&lt;/h4&gt;&lt;p&gt;  解决如果这个元素有任何的 border 或 padding ，绘制到屏幕上时的盒
      
    
    </summary>
    
    
      <category term="css" scheme="babylovelin.github.io/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>casperJS</title>
    <link href="babylovelin.github.io/2018/02/07/casperJS/"/>
    <id>babylovelin.github.io/2018/02/07/casperJS/</id>
    <published>2018-02-07T02:40:35.000Z</published>
    <updated>2018-03-19T06:03:15.194Z</updated>
    
    <content type="html"><![CDATA[<h2 id="linux安装"><a href="#linux安装" class="headerlink" title="linux安装"></a>linux安装</h2><p>1安装 phantomjs 环境</p><p><code>$ npm install -g phantomjs</code></p><p>2 接下来，我们安装 CasperJS：</p><p><code>$ npm install -g casperjs</code></p><p>3 安装 CasperJS 必须确保在 Python 环境下，Python下载之后直接安装即可。</p><p>确认环境是否安装成功：</p><p><code>$ phantomjs --version$ python --version$ casperjs --version</code></p><h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2><p>新建一个<code>sample.js</code>,这里访问的两个网页，可能速度比较慢，没有vpn的话</p><p>！！！！这里是页面测试！！！！</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> casper = <span class="built_in">require</span>(<span class="string">'casper'</span>).create(); <span class="comment">//新建一个页面</span></span><br><span class="line"></span><br><span class="line">casper.start(<span class="string">'http://casperjs.org/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.echo(<span class="keyword">this</span>.getTitle());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">casper.thenOpen(<span class="string">'http://phantomjs.org'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.echo(<span class="keyword">this</span>.getTitle());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">casper.run();</span><br></pre></td></tr></table></figure><p>用python跑这段代码</p><p><code>$ casperjs sample.js</code>  你会看到结果～</p><p>！！！！这里是脚本测试！！！！</p><p>我们新建一个<code>test-hello.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">casper.test.begin(<span class="string">"Hello, Test!"</span>, <span class="number">1</span>, <span class="function"><span class="keyword">function</span>(<span class="params">test</span>) </span>&#123;</span><br><span class="line">  test.assert(<span class="literal">true</span>);</span><br><span class="line">  test.done();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// hello Test 是描述信息</span></span><br><span class="line"><span class="comment">// 1 代表有几个断言</span></span><br></pre></td></tr></table></figure><p>跑这段代码</p><p><code>casperjs test hello-test.js</code></p><h2 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h2><p>假如有如下代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>My page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"page-title"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>one<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>two<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>three<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>©2012 myself<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>要检查示例页面中是否存在<code>&lt;h1 class =“page-title”\&gt;</code>元素，可以使用：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> casper = <span class="built_in">require</span>(<span class="string">'casper'</span>).create(); <span class="comment">//新建一个页面,一个无界面浏览器</span></span><br><span class="line"><span class="comment">//访问你的文件地址  本地：http://localhost/demo.html</span></span><br><span class="line">casper.start(<span class="string">'http://domain.tld/page.html'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">//这里没有用测试框架，时自己判断有什么，输出什么</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.exists(<span class="string">'h1.page-title'</span>)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.echo(<span class="string">'the heading exists'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">casper.run();</span><br></pre></td></tr></table></figure><p>用测试框架<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">casper.test.begin(<span class="string">'The heading exists'</span>, <span class="number">1</span>, <span class="function"><span class="keyword">function</span> <span class="title">suite</span>(<span class="params">test</span>) </span>&#123;</span><br><span class="line">    casper.start(<span class="string">'http://domain.tld/page.html'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        test.assertExists(<span class="string">'h1.page-title'</span>);</span><br><span class="line">    &#125;).run(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        test.done();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">casper.test.begin(<span class="string">'Page content tests'</span>, <span class="number">3</span>, <span class="function"><span class="keyword">function</span> <span class="title">suite</span>(<span class="params">test</span>) </span>&#123;</span><br><span class="line">    casper.start(<span class="string">'http://domain.tld/page.html'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        test.assertExists(<span class="string">'h1.page-title'</span>);</span><br><span class="line">        test.assertSelectorHasText(<span class="string">'h1.page-title'</span>, <span class="string">'Hello'</span>);</span><br><span class="line">        test.assertVisible(<span class="string">'footer'</span>);</span><br><span class="line">    &#125;).run(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        test.done();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>单元测试</p><p>新建文件 <code>cow-test.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.mowed = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">this</span>.moo = <span class="function"><span class="keyword">function</span> <span class="title">moo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.mowed = <span class="literal">true</span>; <span class="comment">// mootable state: don't do that at home</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'moo!'</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这里用了它的测试框架</span></span><br><span class="line">casper.test.begin(<span class="string">'Cow can moo'</span>, <span class="number">2</span>, <span class="function"><span class="keyword">function</span> <span class="title">suite</span>(<span class="params">test</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> cow = <span class="keyword">new</span> Cow();</span><br><span class="line">    test.assertEquals(cow.moo(), <span class="string">'moo!'</span>); <span class="comment">//这里就是判断执行函数的结果是否和后边的一致</span></span><br><span class="line">    test.assert(cow.mowed);</span><br><span class="line">    test.done();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>运行 <code>$ casperjs test cow-test.js</code> 进行测试</p><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><div class="note"><br><h5>casper module</h5><br><p>casper 模块</p><br></div><h3 id="casper-class"><a href="#casper-class" class="headerlink" title="casper class"></a>casper class</h3><p>最简单获得一个capser实例</p><p><code>var casper = require(&#39;casper&#39;).create();</code></p><h3 id="casper-options"><a href="#casper-options" class="headerlink" title="casper options"></a>casper options</h3><p>一些选项可以传递给构造函数</p><p>有两种方式</p><p>第一种：实例化时传入</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> casper = <span class="built_in">require</span>(<span class="string">'casper'</span>).create(&#123;</span><br><span class="line">    clientScripts:  [</span><br><span class="line">        <span class="string">'includes/jquery.js'</span>,      <span class="comment">// These two scripts will be injected in remote</span></span><br><span class="line">        <span class="string">'includes/underscore.js'</span>   <span class="comment">// DOM on every request</span></span><br><span class="line">    ],</span><br><span class="line">    pageSettings: &#123;</span><br><span class="line">        loadImages:  <span class="literal">false</span>,        <span class="comment">// The WebPage instance used by Casper will</span></span><br><span class="line">        loadPlugins: <span class="literal">false</span>         <span class="comment">// use these settings</span></span><br><span class="line">    &#125;,</span><br><span class="line">    logLevel: <span class="string">"info"</span>,              <span class="comment">// Only "info" level messages will be logged</span></span><br><span class="line">    verbose: <span class="literal">true</span>                  <span class="comment">// log messages will be printed out to the console</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>第二种：运行时加入</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> casper = <span class="built_in">require</span>(<span class="string">'casper'</span>).create();</span><br><span class="line">casper.options.waitTimeout = <span class="number">1000</span>;</span><br></pre></td></tr></table></figure><p>下边介绍所有的选项</p><p>clientScripts：数组类型，默认为[],里面包含在每个加载的页面中的脚本文件路径的集合。</p><p>exitOnError： 布尔类型 默认true ，设置CasperJS在脚本抛出未捕获错误时必须退出。</p><p>httpStatusHandlers： 对象类型 默认{} 当请求资源为给定状态码时，调用对象内的函数</p><p>logLevel：字符串类型 默认“error”</p><p>onAlert：函数类型 默认为null 当alert()被调起时，执行的函数</p><p>onDie：函数类型 默认为null  当发生错误时，调起的函数</p><p>onLoadError：函数类型 默认为null  无法加载请求的资源时调用的函数</p><p>onPageInitialized：函数类型 默认为null     WebPage实例初始化后调用的函数</p><p>onResourceReceived：函数类型 默认为 null   PhantomJS的WebPage＃onResourceReceived（）回调的代理方法，但当前的Casper实例作为第一个参数传递。</p><p>onResourceRequested：函数类型  默认为null  PhantomJS的WebPage＃onResourceRequested（）回调的代理方法，但当前的Casper实例作为第一个参数传递。</p><p>onStepComplete：函数类型  默认为null  步功能执行结束时执行的功能。</p><p>onStepTimeout：函数类型 默认为function   当step功能执行时间超过stepTimeout选项的值（如果有的话）被设置时执行的功能。<br>默认情况下，在超时时，脚本将会退出，显示一个错误，除了在测试环境中，它只会向套件结果添加一个失败。</p><p>onTimeout： 函数类型  默认为function    当脚本执行时间超过超时选项的值（如果已设置）时要执行的功能。<br>默认情况下，在超时时，脚本将会退出，显示一个错误，除了在测试环境中，它只会向套件结果添加一个失败。</p><p>onWaitTimeout：函数类型 默认为function    当waitFor * 函数执行时间超过waitTimeout选项的值（如果已设置）时执行的函数。<br>默认情况下，在超时时，脚本将会退出，显示一个错误，除了在测试环境中，它只会向套件结果添加一个失败。</p><p>page： webpage类型 默认为null  </p><p>pageSettings： 对象类型 默认为{}</p><p>remoteScripts：数组类型 默认[]， 包含在每个加载的页面中的远程脚本URL的集合</p><p>stepTimeout： number类型 默认为null    以毫秒为单位的最大步长超时; 当设置时，每个定义的步进函数都必须在达到该超时值之前执行。 您可以定义onStepTimeout（）回调来捕获这种情况。 默认情况下，脚本将死（）与一个错误消息。</p><p>timeout：number类型  默认值为null   以毫秒为单位的最大超时时间</p><p>verbose： 布尔类型  默认false  实时输出日志消息</p><p>viewportSize： 对象类型 默认为null  Viewport size, eg. {width: 800, height: 600}</p><p>retryTimeout：number类型 默认100   两次尝试之间的默认延迟，用于等待 功能。</p><p>waitTimeout：Number类型 默认5000 默认等待时间</p><h2 id="Casper-peototype"><a href="#Casper-peototype" class="headerlink" title="Casper peototype"></a>Casper peototype</h2><p>back() 在浏览器历史中后退</p><p>base64encode()  使用客户端XMLHttpRequest同步使用base64算法对资源进行编码。您也可以执行HTTP POST请求来检索要编码的内容</p><p>bypass() 绕过给定数量的定义的导航步骤</p><p>click()  单击与提供表达式相匹配的与元素。可以使用javascript鼠标事件，如果不可以，那么使用本机事件</p><p>clickLabel() 点击第一个包含该文本的元素</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;a href="..."&gt;My link is beautiful&lt;/a&gt;</span></span><br><span class="line">casper.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.clickLabel(<span class="string">'My link is beautiful'</span>, <span class="string">'a'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>capture()   网页截图</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> casper = <span class="built_in">require</span>(<span class="string">'casper'</span>).create();</span><br><span class="line"><span class="comment">//如果不给出&#123;&#125;里的参数，默认截取整个网页，这个可以解决不能截取整个超级大网页的问题～～～</span></span><br><span class="line">casper.start(<span class="string">'http://localhost'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.capture(<span class="string">'1.png'</span>,&#123;<span class="comment">//注意截取.png   jpg 会截取不到透明部分</span></span><br><span class="line">    top: <span class="number">100</span>,  <span class="comment">//截取位置</span></span><br><span class="line">    left: <span class="number">100</span>,</span><br><span class="line">    width: <span class="number">500</span>,<span class="comment">//截取大小</span></span><br><span class="line">    height: <span class="number">400</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">casper.run();</span><br></pre></td></tr></table></figure><p>captureBase64() 将捕获的图片转换成base64</p><p>captureSelector()   捕获某个选择器里面的图片</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">casper.start(<span class="string">'http://www.weather.com/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.captureSelector(<span class="string">'weather.png'</span>, <span class="string">'#LookingAhead'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">casper.run();</span><br></pre></td></tr></table></figure><p>clear() 清空当前执行环境上下文。避免以前加载的DOM仍然有效</p><p>clearCache()  用newPage（）替换当前页面，用clearMemoryCache（）清除内存缓存。</p><p>clearMemoryCache()  使用引擎page.clearMemoryCache（）清除内存缓存。</p><p>debugHTML()</p><p>die()  用记录的错误消息和可选的退出状态码</p><p>download()   将远程资源保存到文件系统中。</p><p>each()  遍历提供的数组项并执行回调</p><p>eachThen() 迭代所提供的数组项，并添加一个步骤到当前数据附加到堆栈</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> casper = <span class="built_in">require</span>(<span class="string">'casper'</span>).create();</span><br><span class="line"><span class="keyword">var</span> urls = [<span class="string">'http://google.com/'</span>, <span class="string">'http://yahoo.com/'</span>];</span><br><span class="line"></span><br><span class="line">casper.start().eachThen(urls, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.thenOpen(response.data, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Opened'</span>, response.url);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">casper.run();</span><br></pre></td></tr></table></figure><p>echo()  将某些东西打印到标准输出，可选择一些奇特的颜色（有关更多信息，请参阅颜色模块）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">casper.start(<span class="string">'http://www.google.fr/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.echo(<span class="string">'Page title is: '</span> + <span class="keyword">this</span>.evaluate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">document</span>.title;</span><br><span class="line">    &#125;), <span class="string">'INFO'</span>); <span class="comment">// Will be printed in green on the console</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">casper.run();</span><br></pre></td></tr></table></figure><p>evaluate()  评估当前DOM表达式。evaluate()是在casperjs环境和你所打开的网页的桥梁，也就是你使用evaluate()是在操作你当前打开的DOM文档，是casperjs环境和DOM文档的一个交互，这就像你是在用浏览器的控制台控制html内容是一样一样的。</p><p>evaluateOrDie()  返回true时，计算表达式，否则，die</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;linux安装&quot;&gt;&lt;a href=&quot;#linux安装&quot; class=&quot;headerlink&quot; title=&quot;linux安装&quot;&gt;&lt;/a&gt;linux安装&lt;/h2&gt;&lt;p&gt;1安装 phantomjs 环境&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$ npm install -g pha
      
    
    </summary>
    
    
      <category term="js" scheme="babylovelin.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>canvas基础（五）基本动画</title>
    <link href="babylovelin.github.io/2018/02/06/canvas5/"/>
    <id>babylovelin.github.io/2018/02/06/canvas5/</id>
    <published>2018-02-06T08:14:10.000Z</published>
    <updated>2018-03-18T03:54:11.286Z</updated>
    
    <content type="html"><![CDATA[<h2 id="画动画的基本步骤"><a href="#画动画的基本步骤" class="headerlink" title="画动画的基本步骤"></a>画动画的基本步骤</h2><p>如何画出一帧</p><p>1清空 canvas<br>除非接下来要画的内容会完全充满 canvas （例如背景图），否则你需要清空所有。最简单的做法就是用 clearRect 方法。</p><p>2保存 canvas 状态<br>如果你要改变一些会改变 canvas 状态的设置（样式，变形之类的），又要在每画一帧之时都是原始状态的话，你需要先保存一下。</p><p>3绘制动画图形（animated shapes）<br>这一步才是重绘动画帧。</p><p>4恢复 canvas 状态<br>如果已经保存了 canvas 的状态，可以先恢复它，然后重绘下一帧。</p><h2 id="操控动画"><a href="#操控动画" class="headerlink" title="操控动画"></a>操控动画</h2><p>为了实现动画，我们需要一些可以定时执行重绘的方法。有两种方法可以实现这样的动画操控。首先可以通过 setInterval 和 setTimeout 方法来控制在设定的时间点上执行重绘。</p><p>有安排的更新画布 Scheduled updates</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sun = <span class="keyword">new</span> Image();</span><br><span class="line">  <span class="keyword">var</span> moon = <span class="keyword">new</span> Image();</span><br><span class="line">  <span class="keyword">var</span> earth = <span class="keyword">new</span> Image();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    sun.src = <span class="string">'https://mdn.mozillademos.org/files/1456/Canvas_sun.png'</span>;</span><br><span class="line">    moon.src = <span class="string">'https://mdn.mozillademos.org/files/1443/Canvas_moon.png'</span>;</span><br><span class="line">    earth.src = <span class="string">'https://mdn.mozillademos.org/files/1429/Canvas_earth.png'</span>;</span><br><span class="line">    <span class="built_in">window</span>.requestAnimationFrame(draw); <span class="comment">//告诉浏览器你希望执行一个动画，并在重绘之前，请求浏览器执行一个特定的函数来更新动画。</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">    ctx.globalCompositeOperation = <span class="string">'destination-over'</span>; <span class="comment">//属性设置或返回如何将一个源（新的）图像绘制到目标（已有）的图像上</span></span><br><span class="line">    <span class="comment">//destination-over：在源图像上方显示目标图像。</span></span><br><span class="line">    ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>); <span class="comment">// clear canvas</span></span><br><span class="line"></span><br><span class="line">    ctx.fillStyle = <span class="string">'rgba(0,0,0,0.4)'</span>; <span class="comment">//填充色</span></span><br><span class="line">    ctx.strokeStyle = <span class="string">'rgba(0,153,255,0.4)'</span>; <span class="comment">//边框色</span></span><br><span class="line">    ctx.save(); <span class="comment">//保存当前状态</span></span><br><span class="line">    ctx.translate(<span class="number">150</span>, <span class="number">150</span>); <span class="comment">//右偏移150 下偏移150，让ctx的中心位于canvas的中心</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Earth</span></span><br><span class="line">    <span class="keyword">var</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="comment">//一分钟转一圈</span></span><br><span class="line">    <span class="comment">//当前秒转的弧度+当前毫秒转得弧度，也就是当前应该转多少弧度</span></span><br><span class="line">    ctx.rotate(((<span class="number">2</span> * <span class="built_in">Math</span>.PI) / <span class="number">60</span>) * time.getSeconds() + ((<span class="number">2</span> * <span class="built_in">Math</span>.PI) / <span class="number">60000</span>) * time.getMilliseconds()); <span class="comment">//可返回时间的毫秒</span></span><br><span class="line">    ctx.translate(<span class="number">105</span>, <span class="number">0</span>); <span class="comment">//右移105</span></span><br><span class="line">    ctx.fillRect(<span class="number">0</span>, <span class="number">-12</span>, <span class="number">50</span>, <span class="number">24</span>); <span class="comment">// Shadow</span></span><br><span class="line">    ctx.drawImage(earth, <span class="number">-12</span>, <span class="number">-12</span>); <span class="comment">//在目标canvas里面的坐标（-12,-12），起始点，地球24×24,正好圆心在canvas（0,0）处</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Moon</span></span><br><span class="line">    ctx.save();</span><br><span class="line">    ctx.rotate(((<span class="number">2</span> * <span class="built_in">Math</span>.PI) / <span class="number">7.2</span>) * time.getSeconds() + ((<span class="number">2</span> * <span class="built_in">Math</span>.PI) / <span class="number">7200</span>) * time.getMilliseconds());</span><br><span class="line">    ctx.translate(<span class="number">0</span>, <span class="number">28.5</span>); <span class="comment">//下移 28.5</span></span><br><span class="line">    ctx.drawImage(moon, <span class="number">-3.5</span>, <span class="number">-3.5</span>);</span><br><span class="line">    ctx.restore();</span><br><span class="line"></span><br><span class="line">    ctx.restore();</span><br><span class="line"></span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.arc(<span class="number">150</span>, <span class="number">150</span>, <span class="number">105</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>, <span class="literal">false</span>); <span class="comment">// Earth orbit</span></span><br><span class="line">    ctx.stroke();</span><br><span class="line"></span><br><span class="line">    ctx.drawImage(sun, <span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.requestAnimationFrame(draw);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  init();</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;画动画的基本步骤&quot;&gt;&lt;a href=&quot;#画动画的基本步骤&quot; class=&quot;headerlink&quot; title=&quot;画动画的基本步骤&quot;&gt;&lt;/a&gt;画动画的基本步骤&lt;/h2&gt;&lt;p&gt;如何画出一帧&lt;/p&gt;
&lt;p&gt;1清空 canvas&lt;br&gt;除非接下来要画的内容会完全充满 ca
      
    
    </summary>
    
    
      <category term="H5" scheme="babylovelin.github.io/tags/H5/"/>
    
  </entry>
  
  <entry>
    <title>canvas基础（四）状态</title>
    <link href="babylovelin.github.io/2018/02/06/canvas4/"/>
    <id>babylovelin.github.io/2018/02/06/canvas4/</id>
    <published>2018-02-06T06:48:31.000Z</published>
    <updated>2018-03-18T03:54:07.162Z</updated>
    
    <content type="html"><![CDATA[<h2 id="状态的保存和恢复-Saving-and-restoring-state"><a href="#状态的保存和恢复-Saving-and-restoring-state" class="headerlink" title="状态的保存和恢复 Saving and restoring state"></a>状态的保存和恢复 Saving and restoring state</h2><p>什么是save和restore？</p><p>他们是用来保存和恢复canvas状态的。没有参数</p><p>canvas状态存储在栈中，save()调用后，当前状态就会贝推入到栈中保存。</p><p>状态包括：</p><p>当前应用的变形（即移动，旋转和缩放，见下）<br>strokeStyle, fillStyle, globalAlpha, lineWidth, lineCap, lineJoin, miterLimit, shadowOffsetX, shadowOffsetY, shadowBlur, shadowColor, globalCompositeOperation 的值<br>当前的裁切路径（clipping path），会在下一节介绍</p><p>可以无限调用save，每一次restore都会将上一个保存的状态弹出来。</p><p>例如下边例子：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">      ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">150</span>); <span class="comment">// 使用默认设置绘制一个矩形</span></span><br><span class="line">      ctx.save(); <span class="comment">// 保存默认状态</span></span><br><span class="line"></span><br><span class="line">      ctx.fillStyle = <span class="string">'#09F'</span> <span class="comment">// 在原有配置基础上对颜色做改变</span></span><br><span class="line">      ctx.fillRect(<span class="number">15</span>, <span class="number">15</span>, <span class="number">120</span>, <span class="number">120</span>); <span class="comment">// 使用新的设置绘制一个矩形</span></span><br><span class="line"></span><br><span class="line">      ctx.save(); <span class="comment">// 保存当前状态</span></span><br><span class="line">      ctx.fillStyle = <span class="string">'#FFF'</span> <span class="comment">// 再次改变颜色配置</span></span><br><span class="line">      ctx.globalAlpha = <span class="number">0.5</span>;</span><br><span class="line">      ctx.fillRect(<span class="number">30</span>, <span class="number">30</span>, <span class="number">90</span>, <span class="number">90</span>); <span class="comment">// 使用新的配置绘制一个矩形</span></span><br><span class="line"></span><br><span class="line">      ctx.restore(); <span class="comment">// 重新加载之前的颜色状态</span></span><br><span class="line">      ctx.fillRect(<span class="number">45</span>, <span class="number">45</span>, <span class="number">60</span>, <span class="number">60</span>); <span class="comment">// 使用上一次的配置绘制一个矩形</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      ctx.restore(); <span class="comment">// 加载默认颜色配置</span></span><br><span class="line">      ctx.fillRect(<span class="number">60</span>, <span class="number">60</span>, <span class="number">30</span>, <span class="number">30</span>); <span class="comment">// 使用加载的配置绘制一个矩形</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="移动-Translating"><a href="#移动-Translating" class="headerlink" title="移动 Translating"></a>移动 Translating</h2><p>translate(x, y)<br>translate 方法接受两个参数。x 是左右偏移量，y 是上下偏移量</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line">      ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">      <span class="comment">//三行三列</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">          ctx.save(); <span class="comment">//保存初始的状态</span></span><br><span class="line">          ctx.strokeStyle = <span class="string">"#9CFF00"</span>;</span><br><span class="line">          ctx.translate(<span class="number">50</span> + j * <span class="number">100</span>, <span class="number">50</span> + i * <span class="number">100</span>); <span class="comment">//偏移，尝试去掉这一行，那么九张图会叠在一块儿，并且只能看见四分之一</span></span><br><span class="line">          drawSpirograph(ctx, <span class="number">20</span> * (j + <span class="number">2</span>) / (j + <span class="number">1</span>), <span class="number">-8</span> * (i + <span class="number">3</span>) / (i + <span class="number">1</span>), <span class="number">10</span>); <span class="comment">//画图</span></span><br><span class="line">          ctx.restore(); <span class="comment">//还原上一个保存状态，也就是初始状态</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">drawSpirograph</span>(<span class="params">ctx, R, r, O</span>) </span>&#123; <span class="comment">//螺旋（spirograph）图案</span></span><br><span class="line">      <span class="keyword">var</span> x1 = R - O;</span><br><span class="line">      <span class="keyword">var</span> y1 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">var</span> i = <span class="number">1</span>;</span><br><span class="line">      ctx.beginPath();</span><br><span class="line">      ctx.moveTo(x1, y1);</span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">20000</span>) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">var</span> x2 = (R + r) * <span class="built_in">Math</span>.cos(i * <span class="built_in">Math</span>.PI / <span class="number">72</span>) - (r + O) * <span class="built_in">Math</span>.cos(((R + r) / r) * (i * <span class="built_in">Math</span>.PI / <span class="number">72</span>))</span><br><span class="line">        <span class="keyword">var</span> y2 = (R + r) * <span class="built_in">Math</span>.sin(i * <span class="built_in">Math</span>.PI / <span class="number">72</span>) - (r + O) * <span class="built_in">Math</span>.sin(((R + r) / r) * (i * <span class="built_in">Math</span>.PI / <span class="number">72</span>))</span><br><span class="line">        ctx.lineTo(x2, y2);</span><br><span class="line">        x1 = x2;</span><br><span class="line">        y1 = y2;</span><br><span class="line">        i++;</span><br><span class="line">      &#125; <span class="keyword">while</span> (x2 != R - O &amp;&amp; y2 != <span class="number">0</span>);</span><br><span class="line">      ctx.stroke();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="旋转-Rotating"><a href="#旋转-Rotating" class="headerlink" title="旋转 Rotating"></a>旋转 Rotating</h2><p>rotate(angle)<br>这个方法只接受一个参数：旋转的角度(angle)，它是顺时针方向的，以弧度为单位的值。</p><p>下方例子和上边差不多</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line">      ctx.translate(<span class="number">75</span>, <span class="number">75</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; <span class="number">6</span>; i++) &#123; <span class="comment">// Loop through rings (from inside to out)</span></span><br><span class="line">        ctx.save();</span><br><span class="line">        ctx.fillStyle = <span class="string">'rgb('</span> + (<span class="number">51</span> * i) + <span class="string">','</span> + (<span class="number">255</span> - <span class="number">51</span> * i) + <span class="string">',255)'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; i * <span class="number">6</span>; j++) &#123; <span class="comment">// draw individual dots</span></span><br><span class="line">          ctx.rotate(<span class="built_in">Math</span>.PI * <span class="number">2</span> / (i * <span class="number">6</span>));</span><br><span class="line">          ctx.beginPath();</span><br><span class="line">          ctx.arc(<span class="number">0</span>, i * <span class="number">12.5</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">          ctx.fill();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ctx.restore();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="缩放-Scaling"><a href="#缩放-Scaling" class="headerlink" title="缩放 Scaling"></a>缩放 Scaling</h2><p>scale(x, y)<br>scale 方法接受两个参数。x,y 分别是横轴和纵轴的缩放因子，它们都必须是正值。值比 1.0 小表示缩小，比 1.0 大则表示放大，值为 1.0 时什么效果都没有。</p><p><code>默认情况下，canvas 的 1 单位就是 1 个像素。举例说，如果我们设置缩放因子是 0.5，1 个单位就变成对应 0.5 个像素，这样绘制出来的形状就会是原先的一半。同理，设置为 2.0 时，1 个单位就对应变成了 2 像素，绘制的结果就是图形放大了 2 倍</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line">  ctx.strokeStyle = <span class="string">"#fc0"</span>;</span><br><span class="line">  ctx.lineWidth = <span class="number">1.5</span>;</span><br><span class="line">  ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Uniform scaling</span></span><br><span class="line">  ctx.save()</span><br><span class="line">  ctx.translate(<span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line">  drawSpirograph(ctx, <span class="number">22</span>, <span class="number">6</span>, <span class="number">5</span>); <span class="comment">// no scaling</span></span><br><span class="line"></span><br><span class="line">  ctx.translate(<span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">  ctx.scale(<span class="number">0.75</span>, <span class="number">0.75</span>);</span><br><span class="line">  drawSpirograph(ctx, <span class="number">22</span>, <span class="number">6</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">  ctx.translate(<span class="number">133.333</span>, <span class="number">0</span>);</span><br><span class="line">  ctx.scale(<span class="number">0.75</span>, <span class="number">0.75</span>);</span><br><span class="line">  drawSpirograph(ctx, <span class="number">22</span>, <span class="number">6</span>, <span class="number">5</span>);</span><br><span class="line">  ctx.restore();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Non-uniform scaling (y direction)</span></span><br><span class="line">  ctx.strokeStyle = <span class="string">"#0cf"</span>;</span><br><span class="line">  ctx.save()</span><br><span class="line">  ctx.translate(<span class="number">50</span>, <span class="number">150</span>);</span><br><span class="line">  ctx.scale(<span class="number">1</span>, <span class="number">0.75</span>);</span><br><span class="line">  drawSpirograph(ctx, <span class="number">22</span>, <span class="number">6</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">  ctx.translate(<span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">  ctx.scale(<span class="number">1</span>, <span class="number">0.75</span>);</span><br><span class="line">  drawSpirograph(ctx, <span class="number">22</span>, <span class="number">6</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">  ctx.translate(<span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">  ctx.scale(<span class="number">1</span>, <span class="number">0.75</span>);</span><br><span class="line">  drawSpirograph(ctx, <span class="number">22</span>, <span class="number">6</span>, <span class="number">5</span>);</span><br><span class="line">  ctx.restore();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Non-uniform scaling (x direction)</span></span><br><span class="line">  ctx.strokeStyle = <span class="string">"#cf0"</span>;</span><br><span class="line">  ctx.save()</span><br><span class="line">  ctx.translate(<span class="number">50</span>, <span class="number">250</span>);</span><br><span class="line">  ctx.scale(<span class="number">0.75</span>, <span class="number">1</span>);</span><br><span class="line">  drawSpirograph(ctx, <span class="number">22</span>, <span class="number">6</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">  ctx.translate(<span class="number">133.333</span>, <span class="number">0</span>);</span><br><span class="line">  ctx.scale(<span class="number">0.75</span>, <span class="number">1</span>);</span><br><span class="line">  drawSpirograph(ctx, <span class="number">22</span>, <span class="number">6</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">  ctx.translate(<span class="number">177.777</span>, <span class="number">0</span>);</span><br><span class="line">  ctx.scale(<span class="number">0.75</span>, <span class="number">1</span>);</span><br><span class="line">  drawSpirograph(ctx, <span class="number">22</span>, <span class="number">6</span>, <span class="number">5</span>);</span><br><span class="line">  ctx.restore();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawSpirograph</span>(<span class="params">ctx, R, r, O</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x1 = R - O;</span><br><span class="line">  <span class="keyword">var</span> y1 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">1</span>;</span><br><span class="line">  ctx.beginPath();</span><br><span class="line">  ctx.moveTo(x1, y1);</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">20000</span>) <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">var</span> x2 = (R + r) * <span class="built_in">Math</span>.cos(i * <span class="built_in">Math</span>.PI / <span class="number">72</span>) - (r + O) * <span class="built_in">Math</span>.cos(((R + r) / r) * (i * <span class="built_in">Math</span>.PI / <span class="number">72</span>))</span><br><span class="line">    <span class="keyword">var</span> y2 = (R + r) * <span class="built_in">Math</span>.sin(i * <span class="built_in">Math</span>.PI / <span class="number">72</span>) - (r + O) * <span class="built_in">Math</span>.sin(((R + r) / r) * (i * <span class="built_in">Math</span>.PI / <span class="number">72</span>))</span><br><span class="line">    ctx.lineTo(x2, y2);</span><br><span class="line">    x1 = x2;</span><br><span class="line">    y1 = y2;</span><br><span class="line">    i++;</span><br><span class="line">  &#125; <span class="keyword">while</span> (x2 != R - O &amp;&amp; y2 != <span class="number">0</span>);</span><br><span class="line">  ctx.stroke();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="变形-Transforms"><a href="#变形-Transforms" class="headerlink" title="变形 Transforms"></a>变形 Transforms</h2><p>transform(m11, m12, m21, m22, dx, dy)</p><p>这个方法是将当前的变形矩阵乘上一个基于自身参数的矩阵，在这里我们用下面的矩阵：</p><p>m11 m21 dx<br>m12 m22 dy<br>0     0     1</p><p>m11：水平方向的缩放</p><p>m12：水平方向的偏移</p><p>m21：竖直方向的偏移</p><p>m22：竖直方向的缩放</p><p>dx：水平方向的移动</p><p>dy：竖直方向的移动</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sin = <span class="built_in">Math</span>.sin(<span class="built_in">Math</span>.PI / <span class="number">6</span>);</span><br><span class="line">    <span class="keyword">var</span> cos = <span class="built_in">Math</span>.cos(<span class="built_in">Math</span>.PI / <span class="number">6</span>);</span><br><span class="line">    ctx.translate(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">var</span> c = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= <span class="number">12</span>; i++) &#123;</span><br><span class="line">      c = <span class="built_in">Math</span>.floor(<span class="number">255</span> / <span class="number">12</span> * i);</span><br><span class="line">      ctx.fillStyle = <span class="string">"rgb("</span> + c + <span class="string">","</span> + c + <span class="string">","</span> + c + <span class="string">")"</span>;</span><br><span class="line">      ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>);</span><br><span class="line">      ctx.transform(cos, sin, -sin, cos, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ctx.setTransform(<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    ctx.fillStyle = <span class="string">"rgba(255, 128, 255, 0.5)"</span>;</span><br><span class="line">    ctx.fillRect(<span class="number">0</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;状态的保存和恢复-Saving-and-restoring-state&quot;&gt;&lt;a href=&quot;#状态的保存和恢复-Saving-and-restoring-state&quot; class=&quot;headerlink&quot; title=&quot;状态的保存和恢复 Saving and re
      
    
    </summary>
    
    
      <category term="H5" scheme="babylovelin.github.io/tags/H5/"/>
    
  </entry>
  
  <entry>
    <title>canvas基础（三） 使用图片</title>
    <link href="babylovelin.github.io/2018/02/06/canvas3/"/>
    <id>babylovelin.github.io/2018/02/06/canvas3/</id>
    <published>2018-02-06T02:59:10.000Z</published>
    <updated>2018-03-18T03:54:02.309Z</updated>
    
    <content type="html"><![CDATA[  <div class="note info"><br>  <h5>有趣的事</h5><br>  <p>canvas更有意思的一项特性就是图像操作能力。可以用于动态的图像合成或者作为图形的背景，以及游戏界面（Sprites）等等。浏览器支持的任意格式的外部图片都可以使用，比如PNG、GIF或者JPEG。 你甚至可以将同一个页面中其他canvas元素生成的图片作为图片源。</p><br>  </div><h2 id="需要绘制的图片"><a href="#需要绘制的图片" class="headerlink" title="需要绘制的图片"></a>需要绘制的图片</h2><p>  canvas的API可以使用下面这些类型中的一种作为图片的源：</p><p>  HTMLImageElement</p><pre><code>这些图片由Image()函数构造出来，或者任何的&lt;img&gt;元素</code></pre><p>  HTMLVideoElement</p><pre><code>用HTML的&lt;video&gt;元素作为图片源，可以从视频中抓取当前帧，作为一个图像</code></pre><p>  HTMLCanvasElement</p><pre><code>可以使用另外一个&lt;canvas&gt;元素作为你的图片源</code></pre><p>  ImageBitmap</p><pre><code>这是一个高性能的位图，可以低延迟的绘制。可以从上述几种源中生成还有其它几种源中生成。</code></pre><h2 id="创建图像"><a href="#创建图像" class="headerlink" title="创建图像"></a>创建图像</h2><p>   用很方便的Image()构造函数<br>    <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image();   <span class="comment">// 创建img元素</span></span><br><span class="line">img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">// 执行drawImage语句</span></span><br><span class="line">&#125;</span><br><span class="line">img.src = <span class="string">'myImage.png'</span>; <span class="comment">// 设置图片源地址</span></span><br></pre></td></tr></table></figure></p><p>  通过 data: url 方式嵌入图像,允许使用Base64编码的字符串来定义图片</p>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img.src = <span class="string">'data:image/gif;base64,R0lGODlhCwALAIAAAAAA3pn/ZiH5BAEAAAEALAAAAAALAAsAAAIUhA+hkcuO4lmNVindo7qyrIXiGBYAOw=='</span>;</span><br></pre></td></tr></table></figure><h2 id="使用视频帧"><a href="#使用视频帧" class="headerlink" title="使用视频帧"></a>使用视频帧</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMyVideo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>);</span><br><span class="line">  <span class="keyword">if</span> (canvas.getContext) &#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(<span class="string">'myvideo'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="绘制图片"><a href="#绘制图片" class="headerlink" title="绘制图片"></a>绘制图片</h2><p>用一个外部图像作为一个线性图的背景。   这样我们就省去了绘制背景的麻烦了。只用到一个image对象。</p><p>那么我们在它的onload时间相应函数中触发绘制动作。drawImage方法将被经放置在canvas的左上角(0,0)处</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line">    <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">    img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      ctx.drawImage(img,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">      ctx.beginPath();</span><br><span class="line">      ctx.moveTo(<span class="number">30</span>,<span class="number">96</span>);</span><br><span class="line">      ctx.lineTo(<span class="number">70</span>,<span class="number">66</span>);</span><br><span class="line">      ctx.lineTo(<span class="number">103</span>,<span class="number">76</span>);</span><br><span class="line">      ctx.lineTo(<span class="number">170</span>,<span class="number">15</span>);</span><br><span class="line">      ctx.stroke();</span><br><span class="line">    &#125;</span><br><span class="line">    img.src = <span class="string">'images/backdrop.png'</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="缩放-Scaling"><a href="#缩放-Scaling" class="headerlink" title="缩放  Scaling"></a>缩放  Scaling</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">  img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;<span class="number">3</span>;j++)&#123;</span><br><span class="line">        <span class="comment">// image x y width hright</span></span><br><span class="line">        <span class="comment">// x 和 y 是其在目标 canvas 里的起始坐标</span></span><br><span class="line">        <span class="comment">// 这个方法多了2个参数：width 和 height，这两个参数用来控制 当向canvas画入时应该缩放的大小</span></span><br><span class="line">        ctx.drawImage(img,j*<span class="number">50</span>,i*<span class="number">38</span>,<span class="number">50</span>,<span class="number">38</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  img.src = <span class="string">'https://mdn.mozillademos.org/files/5397/rhino.jpg'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="切片-Slicing"><a href="#切片-Slicing" class="headerlink" title="切片 Slicing"></a>切片 Slicing</h2><p>第一个参数和其它的是相同的，都是一个图像或者另一个 canvas 的引用。</p><p>其它8个参数前4个是定义图像源的切片位置和大小，后4个则是定义切片的目标显示位置和大小。</p><p><code>drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>);</span><br><span class="line">  <span class="keyword">var</span> ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Draw slice</span></span><br><span class="line">  ctx.drawImage(<span class="built_in">document</span>.getElementById(<span class="string">'source'</span>),</span><br><span class="line">                <span class="number">33</span>,<span class="number">71</span>,<span class="number">104</span>,<span class="number">124</span>,<span class="number">21</span>,<span class="number">20</span>,<span class="number">87</span>,<span class="number">104</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Draw frame</span></span><br><span class="line">  ctx.drawImage(<span class="built_in">document</span>.getElementById(<span class="string">'frame'</span>),<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
          &lt;div class=&quot;note info&quot;&gt;&lt;br&gt;  &lt;h5&gt;有趣的事&lt;/h5&gt;&lt;br&gt;  &lt;p&gt;canvas更有意思的一项特性就是图像操作能力。可以用于动态的图像合成或者作为图形的背景，以及游戏界面（Sprites）等等。浏览器支持的任意格式的外部图片都可以使用，比如P
      
    
    </summary>
    
    
      <category term="H5" scheme="babylovelin.github.io/tags/H5/"/>
    
  </entry>
  
  <entry>
    <title>canvas基础（二）绘制图形</title>
    <link href="babylovelin.github.io/2018/02/05/canvas2/"/>
    <id>babylovelin.github.io/2018/02/05/canvas2/</id>
    <published>2018-02-05T07:15:02.000Z</published>
    <updated>2018-03-18T03:53:57.609Z</updated>
    
    <content type="html"><![CDATA[<h2 id="色彩-colors"><a href="#色彩-colors" class="headerlink" title="色彩 colors"></a>色彩 colors</h2><p>给图形添加颜色</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fillStyle = color</span><br><span class="line">设置图形的填充颜色。</span><br><span class="line"></span><br><span class="line">strokeStyle = color</span><br><span class="line">设置图形轮廓的颜色。</span><br><span class="line"></span><br><span class="line">example:</span><br><span class="line"></span><br><span class="line">ctx.fillStyle = "orange";</span><br></pre></td></tr></table></figure><div class="note info"><br>  <h5>注意</h5><br>  <p>一旦您设置了 strokeStyle 或者 fillStyle 的值，那么这个新值就会成为新绘制的图形的默认值。<br>  如果你要给每个图形上不同的颜色，你需要重新设置 fillStyle 或 strokeStyle 的值。</p><br></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fillStyle</span></span><br><span class="line"><span class="comment">//这是画一个颜色渐变的矩形，每种颜色为25×25,总共6×6个，150×150px</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'tutorial'</span>);</span><br><span class="line">      <span class="keyword">if</span> (canvas.getContext) &#123;</span><br><span class="line">        <span class="keyword">var</span> ctx = canvas.getContext(<span class="string">'2d'</span>); <span class="comment">//用来获得渲染上下文和它的绘画功能</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">6</span>; j++) &#123;</span><br><span class="line">            ctx.fillStyle = <span class="string">'rgb('</span> + <span class="built_in">Math</span>.floor(<span class="number">255</span> - <span class="number">42.5</span> * i) + <span class="string">','</span> +</span><br><span class="line">              <span class="built_in">Math</span>.floor(<span class="number">255</span> - <span class="number">42.5</span> * j) + <span class="string">',0)'</span>;</span><br><span class="line">            ctx.fillRect(j * <span class="number">25</span>, i * <span class="number">25</span>, <span class="number">25</span>, <span class="number">25</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//strokeStyle</span></span><br><span class="line"><span class="comment">//圆心为12.5,25 的整数倍，半径为10,从0画到2派，顺时针</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;<span class="number">6</span>;j++)&#123;</span><br><span class="line">        ctx.strokeStyle = <span class="string">'rgb(0,'</span> + <span class="built_in">Math</span>.floor(<span class="number">255</span><span class="number">-42.5</span>*i) + <span class="string">','</span> +</span><br><span class="line">                         <span class="built_in">Math</span>.floor(<span class="number">255</span><span class="number">-42.5</span>*j) + <span class="string">')'</span>;</span><br><span class="line">        ctx.beginPath();</span><br><span class="line">        ctx.arc(<span class="number">12.5</span>+j*<span class="number">25</span>,<span class="number">12.5</span>+i*<span class="number">25</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="built_in">Math</span>.PI*<span class="number">2</span>,<span class="literal">true</span>);</span><br><span class="line">        ctx.stroke();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="透明度"><a href="#透明度" class="headerlink" title="透明度"></a>透明度</h2><p>除了可以绘制实色图形，我们还可以用 canvas 来绘制半透明的图形</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 指定透明颜色，用于描边和填充样式</span><br><span class="line">ctx.strokeStyle = "rgba(255,0,0,0.5)";</span><br><span class="line">ctx.fillStyle = "rgba(255,0,0,0.5)";</span><br><span class="line"><span class="selector-tag">rgba</span>() 方法与 <span class="selector-tag">rgb</span>() 方法类似，就多了一个用于设置色彩透明度的参数。它的有效范围是从 0<span class="selector-class">.0</span>（完全透明）到 1<span class="selector-class">.0</span>（完全不透明）</span><br></pre></td></tr></table></figure><p>globalAlpha 示例</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line">  <span class="comment">// 画背景，每想更换一次填充色都要重新写一次fillStyle</span></span><br><span class="line">  ctx.fillStyle = <span class="string">'#FD0'</span>;</span><br><span class="line">  ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">75</span>,<span class="number">75</span>);</span><br><span class="line">  ctx.fillStyle = <span class="string">'#6C0'</span>;</span><br><span class="line">  ctx.fillRect(<span class="number">75</span>,<span class="number">0</span>,<span class="number">75</span>,<span class="number">75</span>);</span><br><span class="line">  ctx.fillStyle = <span class="string">'#09F'</span>;</span><br><span class="line">  ctx.fillRect(<span class="number">0</span>,<span class="number">75</span>,<span class="number">75</span>,<span class="number">75</span>);</span><br><span class="line">  ctx.fillStyle = <span class="string">'#F30'</span>;</span><br><span class="line">  ctx.fillRect(<span class="number">75</span>,<span class="number">75</span>,<span class="number">75</span>,<span class="number">75</span>);</span><br><span class="line">  ctx.fillStyle = <span class="string">'#FFF'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置透明度值</span></span><br><span class="line">  ctx.globalAlpha = <span class="number">0.2</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 画半透明圆</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">7</span>;i++)&#123;</span><br><span class="line">      ctx.beginPath();</span><br><span class="line">      ctx.arc(<span class="number">75</span>,<span class="number">75</span>,<span class="number">10</span>+<span class="number">10</span>*i,<span class="number">0</span>,<span class="built_in">Math</span>.PI*<span class="number">2</span>,<span class="literal">true</span>);</span><br><span class="line">      ctx.fill();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>rgba() 示例</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 画背景</span></span><br><span class="line">  ctx.fillStyle = <span class="string">'rgb(255,221,0)'</span>;</span><br><span class="line">  ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">37.5</span>);</span><br><span class="line">  ctx.fillStyle = <span class="string">'rgb(102,204,0)'</span>;</span><br><span class="line">  ctx.fillRect(<span class="number">0</span>,<span class="number">37.5</span>,<span class="number">150</span>,<span class="number">37.5</span>);</span><br><span class="line">  ctx.fillStyle = <span class="string">'rgb(0,153,255)'</span>;</span><br><span class="line">  ctx.fillRect(<span class="number">0</span>,<span class="number">75</span>,<span class="number">150</span>,<span class="number">37.5</span>);</span><br><span class="line">  ctx.fillStyle = <span class="string">'rgb(255,51,0)'</span>;</span><br><span class="line">  ctx.fillRect(<span class="number">0</span>,<span class="number">112.5</span>,<span class="number">150</span>,<span class="number">37.5</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 画半透明矩形</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">    ctx.fillStyle = <span class="string">'rgba(255,255,255,'</span>+(i+<span class="number">1</span>)/<span class="number">10</span>+<span class="string">')'</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)&#123;</span><br><span class="line">      ctx.fillRect(<span class="number">5</span>+i*<span class="number">14</span>,<span class="number">5</span>+j*<span class="number">37.5</span>,<span class="number">14</span>,<span class="number">27.5</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="线型-Line-styles"><a href="#线型-Line-styles" class="headerlink" title="线型 Line styles"></a>线型 Line styles</h2><p>lineWidth = value<br>设置线条宽度。</p><p>lineCap = type<br>设置线条末端样式。</p><p>lineJoin = type<br>设定线条与线条间接合处的样式。</p><p>miterLimit = value<br>限制当两条线相交时交接处最大长度；所谓交接处长度（斜接长度）是指线条交接处内角顶点到外角顶点的长度。</p><p>getLineDash()<br>返回一个包含当前虚线样式，长度为非负偶数的数组。</p><p>setLineDash(segments)<br>设置当前虚线样式。</p><p>lineDashOffset = value<br>设置虚线样式的起始偏移量。</p><p>lineWidth 例子</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">    ctx.lineWidth = <span class="number">1</span>+i;</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.moveTo(<span class="number">5</span>+i*<span class="number">14</span>,<span class="number">5</span>);</span><br><span class="line">    ctx.lineTo(<span class="number">5</span>+i*<span class="number">14</span>,<span class="number">140</span>);</span><br><span class="line">    ctx.stroke();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note info"><br>  <h5>得到精确线条</h5><br>  <p>如果填充（2,1）到（5,5），那么整个区域边界刚好落在像素边界上，那么会有清晰的边缘。  如果绘制一条从（3,1）到（3,5）的宽度为1的线条，那么实际填充区域仅仅延伸至路径两边各一半像素。这就意味着，线两边的像素只是部分着色，另外半个像素又会以近方式进行渲染。实际就是以实际笔触颜色一般色调的颜色来填充整个区域。</p><br></div><p>解决办法：</p><p><code>制从 (3.5,1) 到 (3.5,5) 的线条</code></p><h2 id="lineCap-属性的例子"><a href="#lineCap-属性的例子" class="headerlink" title="lineCap 属性的例子"></a>lineCap 属性的例子</h2><p>属性 lineCap 的值决定了线段端点显示的样子。它可以为下面的三种的其中之一：butt，round 和 square。默认是 butt。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line">  <span class="keyword">var</span> lineCap = [<span class="string">'butt'</span>,<span class="string">'round'</span>,<span class="string">'square'</span>]; <span class="comment">//设置线帽</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建路径</span></span><br><span class="line">  ctx.strokeStyle = <span class="string">'#09f'</span>;</span><br><span class="line">  ctx.beginPath();</span><br><span class="line">  ctx.moveTo(<span class="number">10</span>,<span class="number">10</span>);</span><br><span class="line">  ctx.lineTo(<span class="number">140</span>,<span class="number">10</span>);</span><br><span class="line">  ctx.moveTo(<span class="number">10</span>,<span class="number">140</span>);</span><br><span class="line">  ctx.lineTo(<span class="number">140</span>,<span class="number">140</span>);</span><br><span class="line">  ctx.stroke();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 画线条</span></span><br><span class="line">  ctx.strokeStyle = <span class="string">'black'</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;lineCap.length;i++)&#123;</span><br><span class="line">    ctx.lineWidth = <span class="number">15</span>;</span><br><span class="line">    ctx.lineCap = lineCap[i];</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.moveTo(<span class="number">25</span>+i*<span class="number">50</span>,<span class="number">10</span>);</span><br><span class="line">    ctx.lineTo(<span class="number">25</span>+i*<span class="number">50</span>,<span class="number">140</span>);</span><br><span class="line">    ctx.stroke();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="lineJoin-属性的例子"><a href="#lineJoin-属性的例子" class="headerlink" title="lineJoin 属性的例子"></a>lineJoin 属性的例子</h2><p>lineJoin 的属性值决定了图形中两线段连接处所显示的样子。它可以是这三种之一：round, bevel 和 miter。默认是 miter。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line">  <span class="keyword">var</span> lineJoin = [<span class="string">'round'</span>,<span class="string">'bevel'</span>,<span class="string">'miter'</span>];  <span class="comment">//圆的，平的 和 尖的</span></span><br><span class="line">  ctx.lineWidth = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;lineJoin.length;i++)&#123;</span><br><span class="line">    ctx.lineJoin = lineJoin[i];</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.moveTo(<span class="number">-5</span>,<span class="number">5</span>+i*<span class="number">40</span>);</span><br><span class="line">    ctx.lineTo(<span class="number">35</span>,<span class="number">45</span>+i*<span class="number">40</span>);</span><br><span class="line">    ctx.lineTo(<span class="number">75</span>,<span class="number">5</span>+i*<span class="number">40</span>);</span><br><span class="line">    ctx.lineTo(<span class="number">115</span>,<span class="number">45</span>+i*<span class="number">40</span>);</span><br><span class="line">    ctx.lineTo(<span class="number">155</span>,<span class="number">5</span>+i*<span class="number">40</span>);</span><br><span class="line">    ctx.stroke();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用虚线"><a href="#使用虚线" class="headerlink" title="使用虚线"></a>使用虚线</h2><p>用 setLineDash 方法和 lineDashOffset 属性来制定虚线样式. setLineDash 方法接受一个数组，来指定线段与间隙的交替；lineDashOffset 属性设置起始偏移量.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line"><span class="keyword">var</span> offset = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.clearRect(<span class="number">0</span>,<span class="number">0</span>, canvas.width, canvas.height); <span class="comment">//每次执行函数都要将画布擦干净</span></span><br><span class="line">  ctx.setLineDash([<span class="number">4</span>, <span class="number">2</span>]); <span class="comment">//第一个参数是虚线宽，第二个是虚线间距</span></span><br><span class="line">  ctx.lineDashOffset = -offset; <span class="comment">//lineDashOffset 属性设置起始偏移量.</span></span><br><span class="line">  ctx.strokeRect(<span class="number">10</span>,<span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">march</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  offset++;</span><br><span class="line">  <span class="keyword">if</span> (offset &gt; <span class="number">16</span>) &#123;</span><br><span class="line">    offset = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  draw();</span><br><span class="line">  setTimeout(march, <span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">march();</span><br></pre></td></tr></table></figure><h2 id="渐变-Gradients"><a href="#渐变-Gradients" class="headerlink" title="渐变 Gradients"></a>渐变 Gradients</h2><p>新建一个 canvasGradient 对象，并且赋给图形的 fillStyle 或 strokeStyle 属性。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create gradients 制作渐变颜色</span></span><br><span class="line">  <span class="comment">// createLinearGradient 方法接受 4 个参数，表示渐变的起点 (x1,y1) 与终点 (x2,y2)。</span></span><br><span class="line">  <span class="keyword">var</span> lingrad = ctx.createLinearGradient(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>);</span><br><span class="line">  <span class="comment">//addColorStop 方法接受 2 个参数，position 参数必须是一个 0.0 与 1.0 之间的数值，表示渐变中颜色所在的相对位置。</span></span><br><span class="line">  <span class="comment">//例如，0.5 表示颜色会出现在正中间。color 参数必须是一个有效的 CSS 颜色值（如 #FFF， rgba(0,0,0,1)，等等）。</span></span><br><span class="line">  lingrad.addColorStop(<span class="number">0</span>, <span class="string">'#00ABEB'</span>);</span><br><span class="line">  lingrad.addColorStop(<span class="number">0.5</span>, <span class="string">'#fff'</span>);</span><br><span class="line">  lingrad.addColorStop(<span class="number">0.5</span>, <span class="string">'#26C000'</span>);</span><br><span class="line">  lingrad.addColorStop(<span class="number">1</span>, <span class="string">'#fff'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> lingrad2 = ctx.createLinearGradient(<span class="number">0</span>,<span class="number">50</span>,<span class="number">0</span>,<span class="number">95</span>);</span><br><span class="line">  lingrad2.addColorStop(<span class="number">0.5</span>, <span class="string">'#000'</span>);</span><br><span class="line">  lingrad2.addColorStop(<span class="number">1</span>, <span class="string">'rgba(0,0,0,0)'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//对角线黑白过渡  没用在里面</span></span><br><span class="line">  <span class="keyword">var</span> lineargradient = ctx.createLinearGradient(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">150</span>);</span><br><span class="line">  lineargradient.addColorStop(<span class="number">0</span>, <span class="string">'white'</span>);</span><br><span class="line">  lineargradient.addColorStop(<span class="number">1</span>, <span class="string">'black'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// assign gradients to fill and stroke styles</span></span><br><span class="line">  ctx.fillStyle = lingrad;</span><br><span class="line">  ctx.strokeStyle = lingrad2;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// draw shapes</span></span><br><span class="line">  ctx.fillRect(<span class="number">10</span>,<span class="number">10</span>,<span class="number">130</span>,<span class="number">130</span>);</span><br><span class="line">  ctx.strokeRect(<span class="number">50</span>,<span class="number">50</span>,<span class="number">50</span>,<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="createRadialGradient-的例子"><a href="#createRadialGradient-的例子" class="headerlink" title="createRadialGradient 的例子"></a>createRadialGradient 的例子</h2><p>经典的径向渐变更为复杂的效果</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建渐变</span></span><br><span class="line">  <span class="keyword">var</span> radgrad = ctx.createRadialGradient(<span class="number">45</span>,<span class="number">45</span>,<span class="number">10</span>,<span class="number">52</span>,<span class="number">50</span>,<span class="number">30</span>); <span class="comment">// 开始圆心坐标（45，45）开始圆半径10</span></span><br><span class="line">                                                              <span class="comment">//结束圆心坐标（52,50） 结束圆半径30</span></span><br><span class="line">                                                              <span class="comment">//开始圆和结束圆圆心偏离，就有球的效果</span></span><br><span class="line">  radgrad.addColorStop(<span class="number">0</span>, <span class="string">'#A7D30C'</span>);</span><br><span class="line">  radgrad.addColorStop(<span class="number">0.9</span>, <span class="string">'#019F62'</span>);</span><br><span class="line">  radgrad.addColorStop(<span class="number">1</span>, <span class="string">'rgba(1,159,98,0)'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> radgrad2 = ctx.createRadialGradient(<span class="number">105</span>,<span class="number">105</span>,<span class="number">20</span>,<span class="number">112</span>,<span class="number">120</span>,<span class="number">50</span>);</span><br><span class="line">  radgrad2.addColorStop(<span class="number">0</span>, <span class="string">'#FF5F98'</span>);</span><br><span class="line">  radgrad2.addColorStop(<span class="number">0.75</span>, <span class="string">'#FF0188'</span>);</span><br><span class="line">  radgrad2.addColorStop(<span class="number">1</span>, <span class="string">'rgba(255,1,136,0)'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> radgrad3 = ctx.createRadialGradient(<span class="number">95</span>,<span class="number">15</span>,<span class="number">15</span>,<span class="number">102</span>,<span class="number">20</span>,<span class="number">40</span>);</span><br><span class="line">  radgrad3.addColorStop(<span class="number">0</span>, <span class="string">'#00C9FF'</span>);</span><br><span class="line">  radgrad3.addColorStop(<span class="number">0.8</span>, <span class="string">'#00B5E2'</span>);</span><br><span class="line">  radgrad3.addColorStop(<span class="number">1</span>, <span class="string">'rgba(0,201,255,0)'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> radgrad4 = ctx.createRadialGradient(<span class="number">0</span>,<span class="number">150</span>,<span class="number">50</span>,<span class="number">0</span>,<span class="number">140</span>,<span class="number">90</span>);</span><br><span class="line">  radgrad4.addColorStop(<span class="number">0</span>, <span class="string">'#F4F201'</span>);</span><br><span class="line">  radgrad4.addColorStop(<span class="number">0.8</span>, <span class="string">'#E4C700'</span>);</span><br><span class="line">  radgrad4.addColorStop(<span class="number">1</span>, <span class="string">'rgba(228,199,0,0)'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 画图形</span></span><br><span class="line">  ctx.fillStyle = radgrad4;</span><br><span class="line">  ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">150</span>);</span><br><span class="line">  ctx.fillStyle = radgrad3;</span><br><span class="line">  ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">150</span>);</span><br><span class="line">  ctx.fillStyle = radgrad2;</span><br><span class="line">  ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">150</span>);</span><br><span class="line">  ctx.fillStyle = radgrad;</span><br><span class="line">  ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">150</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="图案样式-Patterns"><a href="#图案样式-Patterns" class="headerlink" title="图案样式 Patterns"></a>图案样式 Patterns</h2><p>createPattern(image, type)</p><p>该方法接受两个参数。Image 可以是一个 Image 对象的引用，或者另一个 canvas 对象。<br>Type 必须是下面的字符串值之一：repeat，repeat-x，repeat-y 和 no-repeat。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建新 image 对象，用作图案</span></span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">  img.src = <span class="string">'images/wallpaper.png'</span>;</span><br><span class="line">  img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建图案</span></span><br><span class="line">    <span class="keyword">var</span> ptrn = ctx.createPattern(img,<span class="string">'repeat'</span>);</span><br><span class="line">    ctx.fillStyle = ptrn;</span><br><span class="line">    ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">150</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="阴影-Shadows"><a href="#阴影-Shadows" class="headerlink" title="阴影 Shadows"></a>阴影 Shadows</h2><p>shadowOffsetX = float<br>shadowOffsetX 和 shadowOffsetY 用来设定阴影在 X 和 Y 轴的延伸距离，它们是不受变换矩阵所影响的。负值表示阴影会往上或左延伸，正值则表示会往下或右延伸，它们默认都为 0。</p><p>shadowOffsetY = float<br>shadowOffsetX 和 shadowOffsetY 用来设定阴影在 X 和 Y 轴的延伸距离，它们是不受变换矩阵所影响的。负值表示阴影会往上或左延伸，正值则表示会往下或右延伸，它们默认都为 0。</p><p>shadowBlur = float<br>shadowBlur 用于设定阴影的模糊程度，其数值并不跟像素数量挂钩，也不受变换矩阵的影响，默认为 0。</p><p>shadowColor = color<br>shadowColor 是标准的 CSS 颜色值，用于设定阴影颜色效果，默认是全透明的黑色。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">  ctx.shadowOffsetX = <span class="number">2</span>;</span><br><span class="line">  ctx.shadowOffsetY = <span class="number">2</span>;</span><br><span class="line">  ctx.shadowBlur = <span class="number">2</span>;</span><br><span class="line">  ctx.shadowColor = <span class="string">"rgba(0, 0, 0, 0.5)"</span>;</span><br><span class="line"></span><br><span class="line">  ctx.font = <span class="string">"20px Times New Roman"</span>;</span><br><span class="line">  ctx.fillStyle = <span class="string">"Black"</span>;</span><br><span class="line">  ctx.fillText(<span class="string">"Sample String"</span>, <span class="number">5</span>, <span class="number">30</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Canvas-填充规则"><a href="#Canvas-填充规则" class="headerlink" title="Canvas 填充规则"></a>Canvas 填充规则</h2><p>当我们用到 fill（或者 clip和isPointinPath ）你可以选择一个填充规则，该填充规则根据某处在路径的外面或者里面来决定该处是否被填充，这对于自己与自己路径相交或者路径被嵌套的时候是有用的。</p><p>两个可能的值：</p><p> “nonzero”: non-zero winding rule, 默认值.<br> “evenodd”:  even-odd winding rule.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;色彩-colors&quot;&gt;&lt;a href=&quot;#色彩-colors&quot; class=&quot;headerlink&quot; title=&quot;色彩 colors&quot;&gt;&lt;/a&gt;色彩 colors&lt;/h2&gt;&lt;p&gt;给图形添加颜色&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;
      
    
    </summary>
    
    
      <category term="H5" scheme="babylovelin.github.io/tags/H5/"/>
    
  </entry>
  
  <entry>
    <title>canvas基础（一）基本用法</title>
    <link href="babylovelin.github.io/2018/02/05/canvas1/"/>
    <id>babylovelin.github.io/2018/02/05/canvas1/</id>
    <published>2018-02-05T03:07:50.000Z</published>
    <updated>2018-03-19T06:04:50.980Z</updated>
    
    <content type="html"><![CDATA[<h2 id="基本用法案例"><a href="#基本用法案例" class="headerlink" title="基本用法案例"></a>基本用法案例</h2><p>在这里，我们要先判断我们的浏览器是否支持canvas<br>canvas默认画板是300×150,我们可以在标签内部指定它的长宽<br>canvas支持边距的设置</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>canvas<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    function draw() &#123;</span></span><br><span class="line"><span class="undefined">      var canvas = document.getElementById('tutorial');</span></span><br><span class="line"><span class="undefined">      if (canvas.getContext) &#123;</span></span><br><span class="line"><span class="undefined">        var ctx = canvas.getContext('2d'); //用来获得渲染上下文和它的绘画功能</span></span><br><span class="line"><span class="undefined">        ctx.fillStyle = "rgb(200,0,0)";</span></span><br><span class="line"><span class="undefined">        ctx.fillRect(10, 10, 55, 50);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"draw();"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"tutorial"</span> <span class="attr">width</span>=<span class="string">"150"</span> <span class="attr">height</span>=<span class="string">"150"</span>&gt;</span></span><br><span class="line">    123</span><br><span class="line">  <span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    canvas &#123;</span></span><br><span class="line"><span class="undefined">      border: 1px solid black;</span></span><br><span class="line"><span class="undefined">      margin-left: 50px;</span></span><br><span class="line"><span class="undefined">      margin-top: 50px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="绘制形状"><a href="#绘制形状" class="headerlink" title="绘制形状"></a>绘制形状</h2><p>绘制矩形</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fillRect(x, y, width, height)</span><br><span class="line">绘制一个填充的矩形</span><br><span class="line"></span><br><span class="line">strokeRect(x, y, width, height)</span><br><span class="line">绘制一个矩形的边框</span><br><span class="line"></span><br><span class="line">clearRect(x, y, width, height)</span><br><span class="line">清除指定矩形区域，让清除部分完全透明。</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function draw() &#123;</span><br><span class="line"> var canvas = document.getElementById('canvas');</span><br><span class="line"> if (canvas.getContext) &#123;</span><br><span class="line"> var ctx = canvas.getContext('2d');</span><br><span class="line"></span><br><span class="line"> ctx.fillRect(25,25,100,100);</span><br><span class="line"> ctx.clearRect(45,45,60,60);</span><br><span class="line"> ctx.strokeRect(50,50,50,50);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">fillRect()函数绘制了一个边长为100px的黑色正方形。</span><br><span class="line">clearRect()函数从正方形的中心开始擦除了一个60*60px的正方形，</span><br><span class="line">接着strokeRect()在清除区域内生成一个50*50的正方形边框。</span><br></pre></td></tr></table></figure><h2 id="绘制路径"><a href="#绘制路径" class="headerlink" title="绘制路径"></a>绘制路径</h2><p>一个路径，甚至一个子路径，都是闭合的</p><p>首先，你需要创建路径起始点。<br>然后你使用画图命令去画出路径。<br>之后你把路径封闭。<br>一旦路径生成，你就能通过描边或填充路径区域来渲染图形。</p><p><code>beginPath()新建一条路径，生成之后，图形绘制命令被指向到路径上生成路径。closePath()闭合路径之后图形绘制命令又重新指向到上下文中。stroke()通过线条来绘制图形轮廓。fill()通过填充路径的内容区域生成实心的图形。</code></p><p>生成路径</p><p>第一步：beiginPath(). 路径由许多子路经构成，这些子路经存在一个列表中，子路经构成图形</p><p><code>注意！每次调用这个方法后，列表将会清空，然后我们可以绘制新的图形</code></p><p>第二步，调用函数指定路径</p><p>第三步，闭合路径clothPath().这不是必需的。注意：在调用fill时，没有闭合的形状都会自动闭合。但是stroke()不会</p><p>下面我们绘制一个三角形<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function draw() &#123;</span><br><span class="line"> var canvas = document.getElementById('canvas');</span><br><span class="line"> if (canvas.getContext)&#123;</span><br><span class="line"> var ctx = canvas.getContext('2d');</span><br><span class="line"></span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.moveTo(75,50); //移动笔触，也就是起始点</span><br><span class="line">    ctx.lineTo(100,75);//将线画到哪</span><br><span class="line">    ctx.lineTo(100,25);</span><br><span class="line">    ctx.fill();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>下面我们来画一个小笑脸</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function draw() &#123;</span><br><span class="line"> var canvas = document.getElementById('canvas');</span><br><span class="line"> if (canvas.getContext)&#123;</span><br><span class="line"> var ctx = canvas.getContext('2d');</span><br><span class="line"></span><br><span class="line"> ctx.beginPath();</span><br><span class="line">   ctx.arc(75, 75, 50, 0, Math.PI * 2, true); // 绘制</span><br><span class="line">   ctx.moveTo(110, 75);//移动笔触，也就是起始点</span><br><span class="line">   ctx.arc(75, 75, 35, 0, Math.PI, false); // 口(顺时针)</span><br><span class="line">   ctx.moveTo(65, 65);</span><br><span class="line">   ctx.arc(60, 65, 5, 0, Math.PI * 2, true); // 左眼</span><br><span class="line">   ctx.moveTo(95, 65);</span><br><span class="line">   ctx.arc(90, 65, 5, 0, Math.PI * 2, true); // 右眼</span><br><span class="line">   ctx.stroke();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">试试移除moveTo(),后边会介绍arc</span><br></pre></td></tr></table></figure><h2 id="线"><a href="#线" class="headerlink" title="线"></a>线</h2><p>绘制直线，需要用到的方法lineTo()。</p><h2 id="圆弧"><a href="#圆弧" class="headerlink" title="圆弧"></a>圆弧</h2><p>arc(x, y, radius, startAngle, endAngle, anticlockwise)</p><p>画一个以（x,y）为圆心的以radius为半径的圆弧（圆），从startAngle开始到endAngle结束，按照anticlockwise给定的方向（默认为顺时针）来生成。</p><p><code>startAngle以及endAngle参数用弧度定义了开始以及结束的弧度。这些都是以x轴为基准。参数anticlockwise为一个布尔值。为true时，是逆时针方向，否则顺时针方向</code></p><p><div class="note"><br>注意：arc()函数中的角度单位是弧度 radians=(Math.PI/180)* degress</div></p><div><h2 id="二次贝塞尔曲线及三次贝塞尔曲线"><a href="#二次贝塞尔曲线及三次贝塞尔曲线" class="headerlink" title="二次贝塞尔曲线及三次贝塞尔曲线"></a>二次贝塞尔曲线及三次贝塞尔曲线</h2><p>这个用来绘制复杂有规律的图形</p><p>quadraticCurveTo(cp1x, cp1y, x, y)<br>绘制二次贝塞尔曲线，cp1x,cp1y为一个控制点，x,y为结束点。</p><p>bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y)<br>绘制三次贝塞尔曲线，cp1x,cp1y为控制点一，cp2x,cp2y为控制点二，x,y为结束点。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//二次贝塞尔曲线，画消息框</span><br><span class="line">function draw() &#123;</span><br><span class="line"> var canvas = document.getElementById('canvas');</span><br><span class="line"> if (canvas.getContext) &#123;</span><br><span class="line"> var ctx = canvas.getContext('2d');</span><br><span class="line"> // 二次贝塞尔曲线</span><br><span class="line"> ctx.beginPath();</span><br><span class="line"> ctx.moveTo(75,25); //起始点75，25</span><br><span class="line"> ctx.quadraticCurveTo(25,25,25,62.5); //结束点为25，62.5</span><br><span class="line"> ctx.quadraticCurveTo(25,100,50,100); //接下来起点为 25,62.5 结束点为50,100</span><br><span class="line"> ctx.quadraticCurveTo(50,120,30,125); // 以此类推</span><br><span class="line"> ctx.quadraticCurveTo(60,120,65,100);</span><br><span class="line"> ctx.quadraticCurveTo(125,100,125,62.5);</span><br><span class="line"> ctx.quadraticCurveTo(125,25,75,25);</span><br><span class="line"> ctx.stroke();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//三次贝塞尔曲线画心形状</span><br><span class="line">function draw() &#123;</span><br><span class="line"> var canvas = document.getElementById('canvas');</span><br><span class="line"> if (canvas.getContext)&#123;</span><br><span class="line"> var ctx = canvas.getContext('2d');</span><br><span class="line"></span><br><span class="line"> //三次贝塞尔曲线</span><br><span class="line"> ctx.beginPath();</span><br><span class="line"> ctx.moveTo(75,40);</span><br><span class="line"> ctx.bezierCurveTo(75,37,70,25,50,25);</span><br><span class="line"> ctx.bezierCurveTo(20,25,20,62.5,20,62.5);</span><br><span class="line"> ctx.bezierCurveTo(20,80,40,102,75,120);</span><br><span class="line"> ctx.bezierCurveTo(110,102,130,80,130,62.5);</span><br><span class="line"> ctx.bezierCurveTo(130,62.5,130,25,100,25);</span><br><span class="line"> ctx.bezierCurveTo(85,25,75,37,75,40);</span><br><span class="line"> ctx.fill();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="矩形"><a href="#矩形" class="headerlink" title="矩形"></a>矩形</h2><p>rect(x, y, width, height)</p><p>绘制一个左上角坐标为（x,y），宽高为width以及height的矩形</p><p><code>当该方法执行的时候，moveTo()方法自动设置坐标参数（0,0）。也就是说，当前笔触自动重置回默认坐标。</code></p><h2 id="组合使用"><a href="#组合使用" class="headerlink" title="组合使用"></a>组合使用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>);</span><br><span class="line"> <span class="keyword">if</span> (canvas.getContext)&#123;</span><br><span class="line"> <span class="keyword">var</span> ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line"> roundedRect(ctx,<span class="number">12</span>,<span class="number">12</span>,<span class="number">150</span>,<span class="number">150</span>,<span class="number">15</span>);</span><br><span class="line"> roundedRect(ctx,<span class="number">19</span>,<span class="number">19</span>,<span class="number">150</span>,<span class="number">150</span>,<span class="number">9</span>);</span><br><span class="line"> roundedRect(ctx,<span class="number">53</span>,<span class="number">53</span>,<span class="number">49</span>,<span class="number">33</span>,<span class="number">10</span>);</span><br><span class="line"> roundedRect(ctx,<span class="number">53</span>,<span class="number">119</span>,<span class="number">49</span>,<span class="number">16</span>,<span class="number">6</span>);</span><br><span class="line"> roundedRect(ctx,<span class="number">135</span>,<span class="number">53</span>,<span class="number">49</span>,<span class="number">33</span>,<span class="number">10</span>);</span><br><span class="line"> roundedRect(ctx,<span class="number">135</span>,<span class="number">119</span>,<span class="number">25</span>,<span class="number">49</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"> ctx.beginPath();</span><br><span class="line"> ctx.arc(<span class="number">37</span>,<span class="number">37</span>,<span class="number">13</span>,<span class="built_in">Math</span>.PI/<span class="number">7</span>,-<span class="built_in">Math</span>.PI/<span class="number">7</span>,<span class="literal">false</span>);</span><br><span class="line"> ctx.lineTo(<span class="number">31</span>,<span class="number">37</span>);</span><br><span class="line"> ctx.fill();</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)&#123;</span><br><span class="line"> ctx.fillRect(<span class="number">51</span>+i*<span class="number">16</span>,<span class="number">35</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line"> ctx.fillRect(<span class="number">115</span>,<span class="number">51</span>+i*<span class="number">16</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)&#123;</span><br><span class="line"> ctx.fillRect(<span class="number">51</span>+i*<span class="number">16</span>,<span class="number">99</span>,<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> ctx.beginPath();</span><br><span class="line"> ctx.moveTo(<span class="number">83</span>,<span class="number">116</span>);</span><br><span class="line"> ctx.lineTo(<span class="number">83</span>,<span class="number">102</span>);</span><br><span class="line"> ctx.bezierCurveTo(<span class="number">83</span>,<span class="number">94</span>,<span class="number">89</span>,<span class="number">88</span>,<span class="number">97</span>,<span class="number">88</span>);</span><br><span class="line"> ctx.bezierCurveTo(<span class="number">105</span>,<span class="number">88</span>,<span class="number">111</span>,<span class="number">94</span>,<span class="number">111</span>,<span class="number">102</span>);</span><br><span class="line"> ctx.lineTo(<span class="number">111</span>,<span class="number">116</span>);</span><br><span class="line"> ctx.lineTo(<span class="number">106.333</span>,<span class="number">111.333</span>);</span><br><span class="line"> ctx.lineTo(<span class="number">101.666</span>,<span class="number">116</span>);</span><br><span class="line"> ctx.lineTo(<span class="number">97</span>,<span class="number">111.333</span>);</span><br><span class="line"> ctx.lineTo(<span class="number">92.333</span>,<span class="number">116</span>);</span><br><span class="line"> ctx.lineTo(<span class="number">87.666</span>,<span class="number">111.333</span>);</span><br><span class="line"> ctx.lineTo(<span class="number">83</span>,<span class="number">116</span>);</span><br><span class="line"> ctx.fill();</span><br><span class="line"></span><br><span class="line"> ctx.fillStyle = <span class="string">"white"</span>; <span class="comment">//改变填充颜色</span></span><br><span class="line"> ctx.beginPath();</span><br><span class="line"> ctx.moveTo(<span class="number">91</span>,<span class="number">96</span>);</span><br><span class="line"> ctx.bezierCurveTo(<span class="number">88</span>,<span class="number">96</span>,<span class="number">87</span>,<span class="number">99</span>,<span class="number">87</span>,<span class="number">101</span>);</span><br><span class="line"> ctx.bezierCurveTo(<span class="number">87</span>,<span class="number">103</span>,<span class="number">88</span>,<span class="number">106</span>,<span class="number">91</span>,<span class="number">106</span>);</span><br><span class="line"> ctx.bezierCurveTo(<span class="number">94</span>,<span class="number">106</span>,<span class="number">95</span>,<span class="number">103</span>,<span class="number">95</span>,<span class="number">101</span>);</span><br><span class="line"> ctx.bezierCurveTo(<span class="number">95</span>,<span class="number">99</span>,<span class="number">94</span>,<span class="number">96</span>,<span class="number">91</span>,<span class="number">96</span>);</span><br><span class="line"> ctx.moveTo(<span class="number">103</span>,<span class="number">96</span>);</span><br><span class="line"> ctx.bezierCurveTo(<span class="number">100</span>,<span class="number">96</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">101</span>);</span><br><span class="line"> ctx.bezierCurveTo(<span class="number">99</span>,<span class="number">103</span>,<span class="number">100</span>,<span class="number">106</span>,<span class="number">103</span>,<span class="number">106</span>);</span><br><span class="line"> ctx.bezierCurveTo(<span class="number">106</span>,<span class="number">106</span>,<span class="number">107</span>,<span class="number">103</span>,<span class="number">107</span>,<span class="number">101</span>);</span><br><span class="line"> ctx.bezierCurveTo(<span class="number">107</span>,<span class="number">99</span>,<span class="number">106</span>,<span class="number">96</span>,<span class="number">103</span>,<span class="number">96</span>);</span><br><span class="line"> ctx.fill();</span><br><span class="line"></span><br><span class="line"> ctx.fillStyle = <span class="string">"black"</span>;</span><br><span class="line"> ctx.beginPath();</span><br><span class="line"> ctx.arc(<span class="number">101</span>,<span class="number">102</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="built_in">Math</span>.PI*<span class="number">2</span>,<span class="literal">true</span>);</span><br><span class="line"> ctx.fill();</span><br><span class="line"></span><br><span class="line"> ctx.beginPath();</span><br><span class="line"> ctx.arc(<span class="number">89</span>,<span class="number">102</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="built_in">Math</span>.PI*<span class="number">2</span>,<span class="literal">true</span>);</span><br><span class="line"> ctx.fill();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装的一个用于绘制圆角矩形的函数.</span></span><br><span class="line"><span class="comment">//这个函数建议在纸上动手画一下，就知道时什么意思了</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">roundedRect</span>(<span class="params">ctx,x,y,width,height,radius</span>)</span>&#123;</span><br><span class="line">  ctx.beginPath();</span><br><span class="line">  ctx.moveTo(x,y+radius);</span><br><span class="line">  ctx.lineTo(x,y+height-radius);</span><br><span class="line">  ctx.quadraticCurveTo(x,y+height,x+radius,y+height);</span><br><span class="line">  ctx.lineTo(x+width-radius,y+height);</span><br><span class="line">  ctx.quadraticCurveTo(x+width,y+height,x+width,y+height-radius);</span><br><span class="line">  ctx.lineTo(x+width,y+radius);</span><br><span class="line">  ctx.quadraticCurveTo(x+width,y,x+width-radius,y);</span><br><span class="line">  ctx.lineTo(x+radius,y);</span><br><span class="line">  ctx.quadraticCurveTo(x,y,x,y+radius);</span><br><span class="line">  ctx.stroke();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="path2D示例"><a href="#path2D示例" class="headerlink" title="path2D示例"></a>path2D示例</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>);</span><br><span class="line">  <span class="keyword">if</span> (canvas.getContext)&#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> rectangle = <span class="keyword">new</span> Path2D(); <span class="comment">//创建一个实例</span></span><br><span class="line">    rectangle.rect(<span class="number">10</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> circle = <span class="keyword">new</span> Path2D(); <span class="comment">//创建一个实例</span></span><br><span class="line">    circle.moveTo(<span class="number">125</span>, <span class="number">35</span>);</span><br><span class="line">    circle.arc(<span class="number">100</span>, <span class="number">35</span>, <span class="number">25</span>, <span class="number">0</span>, <span class="number">2</span> * <span class="built_in">Math</span>.PI);</span><br><span class="line"></span><br><span class="line">    ctx.stroke(rectangle);</span><br><span class="line">    ctx.fill(circle);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;基本用法案例&quot;&gt;&lt;a href=&quot;#基本用法案例&quot; class=&quot;headerlink&quot; title=&quot;基本用法案例&quot;&gt;&lt;/a&gt;基本用法案例&lt;/h2&gt;&lt;p&gt;在这里，我们要先判断我们的浏览器是否支持canvas&lt;br&gt;canvas默认画板是300×150,我们可以在
      
    
    </summary>
    
    
      <category term="H5" scheme="babylovelin.github.io/tags/H5/"/>
    
  </entry>
  
  <entry>
    <title>less</title>
    <link href="babylovelin.github.io/2018/02/02/less/"/>
    <id>babylovelin.github.io/2018/02/02/less/</id>
    <published>2018-02-02T08:31:15.000Z</published>
    <updated>2018-03-19T06:00:40.031Z</updated>
    
    <content type="html"><![CDATA[<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><p>  变量：只能定义一次</p>  <figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@nice-blue:</span> <span class="number">#5B83AD</span>;</span><br><span class="line"><span class="variable">@light-blue:</span> <span class="variable">@nice-blue</span> + <span class="number">#111</span>;</span><br></pre></td></tr></table></figure><p>  混合（Mixin）</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.bordered</span> &#123;</span><br><span class="line">  <span class="attribute">border-top</span>: dotted <span class="number">1px</span> black;</span><br><span class="line">  <span class="attribute">border-bottom</span>: solid <span class="number">2px</span> black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="嵌套规则"><a href="#嵌套规则" class="headerlink" title="嵌套规则"></a>嵌套规则</h2><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#header</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: black;</span><br><span class="line">  <span class="selector-class">.navigation</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.logo</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">zoom</span>: <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-pseudo">:after</span> &#123; <span class="comment">//&amp;表示当前选择起父项</span></span><br><span class="line">    <span class="attribute">content</span>: <span class="string">" "</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">    <span class="attribute">visibility</span>: hidden;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h2><p>任何数字、颜色或者变量都可以参与运算</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@base:</span> <span class="number">5%</span>;</span><br><span class="line"><span class="variable">@filler:</span> <span class="variable">@base</span> * <span class="number">2</span>;</span><br><span class="line"><span class="variable">@other:</span> <span class="variable">@base</span> + <span class="variable">@filler</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">color</span>: <span class="number">#888</span> / <span class="number">4</span>;</span><br><span class="line"><span class="attribute">background-color</span>: <span class="variable">@base-color</span> + <span class="number">#111</span>;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">100%</span> / <span class="number">2</span> + <span class="variable">@filler</span>;</span><br></pre></td></tr></table></figure><p><code>@var: 1px + 5;Less 将会使用出现的单位，在这个例子中，最终输出是 6px。</code></p><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>如何将 0.5 转换为 50%，将颜色饱和度增加 5%，以及颜色亮度降低 25% 并且色相值增加 8 等用法：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@base:</span> <span class="number">#f04615</span>;</span><br><span class="line"><span class="variable">@width:</span> <span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.class</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: percentage(<span class="variable">@width</span>); <span class="comment">// returns `50%`</span></span><br><span class="line">  <span class="attribute">color</span>: saturate(<span class="variable">@base</span>, <span class="number">5%</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: spin(lighten(<span class="variable">@base</span>, <span class="number">25%</span>), <span class="number">8</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>作用域 不用提前声明，在最近的作用域就起作用</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@var:</span> red;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#page</span> &#123;</span><br><span class="line">  <span class="variable">@var:</span> white;</span><br><span class="line">  <span class="selector-id">#header</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="variable">@var</span>; <span class="comment">// white</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">@var:</span> red;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#page</span> &#123;</span><br><span class="line">  <span class="selector-id">#header</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="variable">@var</span>; <span class="comment">// white</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">@var:</span> white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>变量的作用就是把值定义在一个地方，然后在各处使用，这样能让代码更易维护：</p><p>变量也可以用在  例如选择器名称，属性名称，URL和@import语句。</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Variables</span></span><br><span class="line"><span class="variable">@mySelector:</span> banner;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage</span></span><br><span class="line"><span class="selector-class">.@&#123;mySelector&#125;</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Variables</span></span><br><span class="line"><span class="variable">@images:</span> <span class="string">"../img"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用法</span></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">  <span class="attribute">background</span>: url(<span class="string">"@&#123;images&#125;/white-sand.png"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>变量是懒加载的，不必要提前声明～～～～而且就近，在当前作用域有，就用当前的，不去父级或者子级拿</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library</span></span><br><span class="line"><span class="variable">@base-color:</span> green;</span><br><span class="line"><span class="variable">@dark-color:</span> darken(<span class="variable">@base-color</span>, <span class="number">10%</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// use of library</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">"library.less"</span>;</span><br><span class="line"><span class="variable">@base-color:</span> red;</span><br></pre></td></tr></table></figure><h2 id="Mixin"><a href="#Mixin" class="headerlink" title="Mixin"></a>Mixin</h2><p>看一个例子</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.a</span>, <span class="selector-id">#b</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mixin-class</span> &#123;</span><br><span class="line">  <span class="selector-class">.a</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mixin-id</span> &#123;</span><br><span class="line">  <span class="selector-id">#b</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里得到的结果是</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.a</span>, <span class="selector-id">#b</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mixin-class</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mixin-id</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里 .a  #b 是并列关系，在后边加上一个括号，相当取将他们里面的css拿出来，添加到对应的地方</p><h2 id="带参数的Mixin"><a href="#带参数的Mixin" class="headerlink" title="带参数的Mixin"></a>带参数的Mixin</h2><p>在这里可以添加例如对字体，颜色，边框，边距的设置，以简单的写法</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.border-radius</span>(<span class="variable">@radius</span>) &#123;</span><br><span class="line">  <span class="attribute">-webkit-border-radius</span>: <span class="variable">@radius</span>;</span><br><span class="line">     <span class="attribute">-moz-border-radius</span>: <span class="variable">@radius</span>;</span><br><span class="line">          <span class="attribute">border-radius</span>: <span class="variable">@radius</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#header</span> &#123;</span><br><span class="line">  <span class="selector-class">.border-radius</span>(<span class="number">4px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.button</span> &#123;</span><br><span class="line">  <span class="selector-class">.border-radius</span>(<span class="number">6px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>还能添加默认值</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.border-radius</span>(<span class="variable">@radius</span>: <span class="number">5px</span>) &#123;</span><br><span class="line">  <span class="attribute">-webkit-border-radius</span>: <span class="variable">@radius</span>;</span><br><span class="line">     <span class="attribute">-moz-border-radius</span>: <span class="variable">@radius</span>;</span><br><span class="line">          <span class="attribute">border-radius</span>: <span class="variable">@radius</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那么这么用</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#header</span> &#123;</span><br><span class="line">  <span class="selector-class">.border-radius</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="多参数-mixin"><a href="#多参数-mixin" class="headerlink" title="多参数 mixin"></a>多参数 mixin</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.mixin</span>(<span class="variable">@color</span>) &#123;</span><br><span class="line">  <span class="attribute">color-1</span>: <span class="variable">@color</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mixin</span>(<span class="variable">@color</span>; <span class="variable">@padding</span>:<span class="number">2</span>) &#123;</span><br><span class="line">  <span class="attribute">color-2</span>: <span class="variable">@color</span>;</span><br><span class="line">  <span class="attribute">padding-2</span>: <span class="variable">@padding</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mixin</span>(<span class="variable">@color</span>; <span class="variable">@padding</span>; <span class="variable">@margin</span>: <span class="number">2</span>) &#123;</span><br><span class="line">  <span class="attribute">color-3</span>: <span class="variable">@color</span>;</span><br><span class="line">  <span class="attribute">padding-3</span>: <span class="variable">@padding</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="variable">@margin</span> <span class="variable">@margin</span> <span class="variable">@margin</span> <span class="variable">@margin</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.some</span> <span class="selector-class">.selector</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="selector-class">.mixin</span>(<span class="number">#008000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译后，满足参数要求的css将被融合进来。</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.some</span> <span class="selector-class">.selector</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">color-1</span>: <span class="number">#008000</span>;</span><br><span class="line">  <span class="attribute">color-2</span>: <span class="number">#008000</span>;</span><br><span class="line">  <span class="attribute">padding-2</span>: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>命名参数，带默认值</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.mixin</span>(<span class="variable">@color</span>: black; <span class="variable">@margin</span>: <span class="number">10px</span>; <span class="variable">@padding</span>: <span class="number">20px</span>) &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="variable">@color</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="variable">@margin</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="variable">@padding</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.class1</span> &#123;</span><br><span class="line">  <span class="selector-class">.mixin</span>(<span class="variable">@margin</span>: <span class="number">20px</span>; <span class="variable">@color</span>: <span class="number">#33acfe</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.class2</span> &#123;</span><br><span class="line">  <span class="selector-class">.mixin</span>(<span class="number">#efca44</span>; <span class="variable">@padding</span>: <span class="number">40px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译后，默认值自动写入</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.class1</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#33acfe</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.class2</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#efca44</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@arguments使用方法，将所有的参数直接填充到里面</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box-shadow</span>(<span class="variable">@x</span>: <span class="number">0</span>; <span class="variable">@y</span>: <span class="number">0</span>; <span class="variable">@blur</span>: <span class="number">1px</span>; <span class="variable">@color</span>: <span class="number">#000</span>) &#123;</span><br><span class="line">  <span class="attribute">-webkit-box-shadow</span>: <span class="variable">@arguments</span>;</span><br><span class="line">     <span class="attribute">-moz-box-shadow</span>: <span class="variable">@arguments</span>;</span><br><span class="line">          <span class="attribute">box-shadow</span>: <span class="variable">@arguments</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.big-block</span> &#123;</span><br><span class="line">  <span class="selector-class">.box-shadow</span>(<span class="number">2px</span>; <span class="number">5px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译后</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.big-block</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-box-shadow</span>: <span class="number">2px</span> <span class="number">5px</span> <span class="number">1px</span> <span class="number">#000</span>;</span><br><span class="line">     <span class="attribute">-moz-box-shadow</span>: <span class="number">2px</span> <span class="number">5px</span> <span class="number">1px</span> <span class="number">#000</span>;</span><br><span class="line">          <span class="attribute">box-shadow</span>: <span class="number">2px</span> <span class="number">5px</span> <span class="number">1px</span> <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="作为函数使用的mixin、"><a href="#作为函数使用的mixin、" class="headerlink" title="作为函数使用的mixin、"></a>作为函数使用的mixin、</h2><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.mixin</span>() &#123;</span><br><span class="line">  <span class="variable">@width:</span>  <span class="number">100%</span>;</span><br><span class="line">  <span class="variable">@height:</span> <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.caller</span> &#123;</span><br><span class="line">  <span class="selector-class">.mixin</span>();</span><br><span class="line">  <span class="attribute">width</span>:  <span class="variable">@width</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="variable">@height</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译后</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.caller</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>:  <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="有条件的混合"><a href="#有条件的混合" class="headerlink" title="有条件的混合"></a>有条件的混合</h2><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">检查类型</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">iscolor</span></span><br><span class="line"><span class="selector-tag">isnumber</span></span><br><span class="line"><span class="selector-tag">isstring</span></span><br><span class="line"><span class="selector-tag">iskeyword</span></span><br><span class="line"><span class="selector-tag">isurl</span></span><br><span class="line"></span><br><span class="line">检查是否有特定单位</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ispixel</span></span><br><span class="line"><span class="selector-tag">ispercentage</span></span><br><span class="line"><span class="selector-tag">isem</span></span><br><span class="line"><span class="selector-tag">isunit</span></span><br></pre></td></tr></table></figure><h2 id="父选择符-amp"><a href="#父选择符-amp" class="headerlink" title="父选择符 &amp;"></a>父选择符 &amp;</h2><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: green;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译后</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">a</span>:hover &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这边就很清楚 &amp; 到底指什么了</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.button</span> &#123;</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-tag">-ok</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: url(<span class="string">"ok.png"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-tag">-cancel</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: url(<span class="string">"cancel.png"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-tag">-custom</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: url(<span class="string">"custom.png"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译后</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.button-ok</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: url(<span class="string">"ok.png"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.button-cancel</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: url(<span class="string">"cancel.png"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.button-custom</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: url(<span class="string">"custom.png"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;入门&quot;&gt;&lt;a href=&quot;#入门&quot; class=&quot;headerlink&quot; title=&quot;入门&quot;&gt;&lt;/a&gt;入门&lt;/h2&gt;&lt;p&gt;  变量：只能定义一次&lt;/p&gt;
  &lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=
      
    
    </summary>
    
    
      <category term="css" scheme="babylovelin.github.io/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>createVueByCli-mobile</title>
    <link href="babylovelin.github.io/2018/02/02/createVueProjectByCli/"/>
    <id>babylovelin.github.io/2018/02/02/createVueProjectByCli/</id>
    <published>2018-02-02T02:34:13.000Z</published>
    <updated>2018-02-02T08:25:03.021Z</updated>
    
    <content type="html"><![CDATA[<h2 id="vue-cli"><a href="#vue-cli" class="headerlink" title="vue-cli"></a>vue-cli</h2><p>  <code>全局安装 vue-cli   $ npm install --global vue-cli   创建一个基于 webpack 模板的新项目   $ vue init webpack my-project   安装依赖，走你   $ cd my-project   $ npm install   $ npm run dev</code></p><p>   这样就新建好了一个基础的vue项目</p><h2 id="安装-less"><a href="#安装-less" class="headerlink" title="安装 less"></a>安装 less</h2><p>  <code>npm install less --save-devnpm install less-loader --save-dev</code></p><p>这里不需要再添加loader的配置，cli中已经配置好了</p><h2 id="配置index"><a href="#配置index" class="headerlink" title="配置index"></a>配置index</h2>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0,maximum-scale=1,minimum-scale=1,user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>  配置rem，根源素的字体大小为屏宽的十分之一，以iphone6为例，屏宽375，那么rem为375/10=37.5px<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">'text/javascript'</span>&gt;</span><br><span class="line">  <span class="built_in">document</span>.getElementsByTagName(<span class="string">'html'</span>)[<span class="number">0</span>].style.fontSize = <span class="built_in">window</span>.screen.width / <span class="number">10</span> + <span class="string">'px'</span>;</span><br><span class="line">  <span class="built_in">document</span>.documentElement.addEventListener(<span class="string">'touchstart'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (event.touches.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    event.preventDefault();</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;, <span class="literal">false</span>);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="配置vux"><a href="#配置vux" class="headerlink" title="配置vux"></a>配置vux</h2>  <div class="note info"><br>    <h5>vux</h5><br>    <p>是基于WeUI和Vue(2.x)开发的移动端UI组件库,用于移动端开发</p><br>  </div><p>  安装：</p><p>  <code>npm install vux --save</code></p><p>  vux2必须配合vux-loader使用, 请在build/webpack.base.conf.js里参照如下代码进行配置</p><p>  <code>const vuxLoader = require(&#39;vux-loader&#39;)const webpackConfig = originalConfig // 原来的 module.exports 代码赋值给变量 webpackConfigmodule.exports = vuxLoader.merge(webpackConfig, {plugins: [&#39;vux-ui&#39;]})</code></p><p>  一些优化：</p><p>  1引入 reset.less，默认样式不包含reset，并且部分用户自己有一套reset样式，因此需要在App.vue进行手动引入</p>  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang="less"&gt;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">'~vux/src/styles/reset.less'</span>;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>  2配置 vux-loader</p><p>  <code>npm i vux-loader --save</code></p><p>  请在build/webpack.base.conf.js里参照如下代码进行配置：</p>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vuxLoader = <span class="built_in">require</span>(<span class="string">'vux-loader'</span>)</span><br><span class="line"><span class="keyword">const</span> webpackConfig = originalConfig <span class="comment">// 原来的 module.exports 代码赋值给变量 webpackConfig</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = vuxLoader.merge(webpackConfig, &#123;</span><br><span class="line">  plugins: [<span class="string">'vux-ui'</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>  在helloworld替换成如下代码，如果出现了alert框，那么就成功了<br>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">alert</span> <span class="attr">v-model</span>=<span class="string">"show"</span> <span class="attr">:title</span>=<span class="string">"'Congratulations'"</span> <span class="attr">:content</span>=<span class="string">"'Your Message is sent successfully~'"</span>&gt;</span><span class="tag">&lt;/<span class="name">alert</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; Alert &#125; <span class="keyword">from</span> <span class="string">'vux'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">'HelloWorld'</span>,</span></span><br><span class="line"><span class="undefined">  data () &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      show:<span class="literal">true</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  components: &#123;</span></span><br><span class="line"><span class="undefined">    Alert</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Add "scoped" attribute to limit CSS to this component only --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">'less'</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">@<span class="keyword">import</span> <span class="string">'~vux/src/styles/reset.less'</span>;</span></span><br><span class="line"><span class="css"><span class="selector-class">.hello</span>&#123;</span></span><br><span class="line"><span class="undefined">  font-size: 1rem</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>  3配置babel-loader以正确编译 VUX 的js源码（通过配置vux-loader实现）</p><p>  <code>plugins: [{  name: &#39;vux-ui&#39;}]</code><br>  4安装less-loader以正确编译less源码</p><p>  5安装 yaml-loader 以正确进行语言文件读取</p><p>  <code>npm install yaml-loader --save-dev</code></p><p>  6添加viewport meta</p><p>  <code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,user-scalable=0&quot;&gt;</code></p><p>  7添加Fastclick移除移动端点击延迟</p><p>  <code>const FastClick = require(&#39;fastclick&#39;)FastClick.attach(document.body)</code></p><p>  8添加webpack plugin, 在构建后去除重复css代码（通过配置vux-loader实现）</p><p>  <code>plugins: [{  name: &#39;duplicate-style&#39;}]</code></p><p>  9如果你使用 webpack-simple 模板或者 webpack 配置里缺少 .vue extension 配置，请记得配置</p><p>  <code>resolve: {  extensions: [&#39;.js&#39;, &#39;.vue&#39;, &#39;.json&#39;]</code></p><p>  10 SEO优化 添加谷歌统计</p>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">i,s,o,g,r,a,m</span>)</span>&#123;i[<span class="string">'GoogleAnalyticsObject'</span>]=r;i[r]=i[r]||<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">(i[r].q=i[r].q||[]).push(<span class="built_in">arguments</span>)&#125;,i[r].l=<span class="number">1</span>*<span class="keyword">new</span> <span class="built_in">Date</span>();a=s.createElement(o),</span><br><span class="line">m=s.getElementsByTagName(o)[<span class="number">0</span>];a.async=<span class="number">1</span>;a.src=g;m.parentNode.insertBefore(a,m)</span><br><span class="line">&#125;)(<span class="built_in">window</span>,<span class="built_in">document</span>,<span class="string">'script'</span>,<span class="string">'https://www.google-analytics.com/analytics.js'</span>,<span class="string">'ga'</span>);</span><br><span class="line"></span><br><span class="line">ga(<span class="string">'create'</span>, <span class="string">'UA-yourID'</span>, <span class="string">'auto'</span>)</span><br><span class="line">ga(<span class="string">'send'</span>, <span class="string">'pageview'</span>) <span class="comment">// 是否要统计着陆页面访问，取决于你的需求，这个不一定需要，会和`router`统计有重复</span></span><br><span class="line"><span class="comment">// main.js 里，如果你使用了 vue-router</span></span><br><span class="line">router.afterEach(<span class="function"><span class="keyword">function</span> (<span class="params">to</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.ga) &#123;</span><br><span class="line">  <span class="built_in">window</span>.ga(<span class="string">'set'</span>, <span class="string">'page'</span>, to.fullPath) <span class="comment">// 你可能想根据请求参数添加其他参数，可以修改这里的 to.fullPath</span></span><br><span class="line">  <span class="built_in">window</span>.ga(<span class="string">'send'</span>, <span class="string">'pageview'</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="界面优化"><a href="#界面优化" class="headerlink" title="界面优化"></a>界面优化</h2><p>1- - - -切换页面显示loading  </p><div class="note info"><br>  <h5>vue-router  vuex</h5><br>  <p>安装vuex <code>npm i vuex --save</code></p><br></div><p>在mian.js中，先引入vuex</p><p><code>import Vuex from &#39;vuex&#39;</code></p><p><code>Vue.use(Vuex)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;&#125;) <span class="comment">// 这里你可能已经有其他 module</span></span><br><span class="line"></span><br><span class="line">store.registerModule(<span class="string">'vux'</span>, &#123; <span class="comment">// 名字自己定义</span></span><br><span class="line">  state: &#123;</span><br><span class="line">    isLoading: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    updateLoadingStatus (state, payload) &#123;</span><br><span class="line">      state.isLoading = payload.isLoading</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>在App.vue里使用loading组件并从vuex获取isLoading状态</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;loading v-model=<span class="string">"isLoading"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">loading</span>&gt;</span></span></span><br><span class="line"><span class="keyword">import</span> &#123; Loading &#125; <span class="keyword">from</span> <span class="string">'vux'</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    Loading</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState(&#123;</span><br><span class="line">      isLoading: <span class="function"><span class="params">state</span> =&gt;</span> state.vux.isLoading</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这里，我们采用rem来进行前端尺寸的调整,我们以ipone6为设计尺寸，1rem=20px</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementsByTagName(<span class="string">'html'</span>)[<span class="number">0</span>].style.fontSize = <span class="number">20</span> * <span class="built_in">window</span>.clientWidth.width / <span class="number">640</span> + <span class="string">'px'</span>;</span><br></pre></td></tr></table></figure><p>2 —- 点击延迟</p><p>在mian.js中加入</p><p><code>const FastClick = require(&#39;fastclick&#39;)FastClick.attach(document.body)</code></p><p>3 —-异步加载组件</p><p>将所有页面组件一次性加载是一个很浪费资源和考验用户耐心的做法，尤其在移动端。</p><p>webpack 提供了code splitting，你可以按照下面写法实现当切换到特定路由时才加载代码。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">'/somepath'</span>,</span><br><span class="line">  component: <span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>([<span class="string">'./demos/somepath.vue'</span>], resolve)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="工具库"><a href="#工具库" class="headerlink" title="工具库"></a>工具库</h2><p>1 - - - base64</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; base64 &#125; <span class="keyword">from</span> <span class="string">'vux'</span></span><br><span class="line"></span><br><span class="line">base64.encode(<span class="string">'VUX'</span>)</span><br><span class="line">base64.decode(<span class="string">'VlVY'</span>)</span><br></pre></td></tr></table></figure><p>2 - - - md5</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; md5 &#125; <span class="keyword">from</span> <span class="string">'vux'</span></span><br><span class="line"></span><br><span class="line">md5(<span class="string">'VUX'</span>)</span><br></pre></td></tr></table></figure><p>3 - - -date 日期格式化</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; dateFormat &#125; <span class="keyword">from</span> <span class="string">'vux'</span></span><br><span class="line"></span><br><span class="line">dateFormat(<span class="keyword">new</span> <span class="built_in">Date</span>(), <span class="string">'YYYY-MM-DD HH:mm:ss'</span>)</span><br></pre></td></tr></table></figure><p>4 - - -number 格式化工具</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//numberComma用于分割数字，默认为3位分割，一般用于格式化金额。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//numberPad用于按照位数补0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//numberRandom用于生成两个整数范围内的随机整数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; numberComma, numberPad, numberRandom &#125; <span class="keyword">from</span> <span class="string">'vux'</span></span><br><span class="line">numberComma(<span class="number">21342132</span>) <span class="comment">// 21,342,132</span></span><br><span class="line">numberComma(<span class="number">21342132</span>, <span class="number">4</span>) <span class="comment">// 2134,2132</span></span><br><span class="line">numberComma(<span class="number">21342132.234</span>) <span class="comment">// 21,342,132.234</span></span><br><span class="line"></span><br><span class="line">numberPad(<span class="number">1</span>) <span class="comment">// 01</span></span><br><span class="line">numberPad(<span class="number">234</span>, <span class="number">4</span>) <span class="comment">// 0234</span></span><br><span class="line"></span><br><span class="line">numberRandom(<span class="number">1</span>, <span class="number">7</span>) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p>5 - - -string 处理工具</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; stringTrim &#125; <span class="keyword">from</span> <span class="string">'vux'</span></span><br><span class="line"></span><br><span class="line">stringTrim(<span class="string">' 1024 '</span>) <span class="comment">// 1024</span></span><br></pre></td></tr></table></figure><p>6 - - -url 参数解析</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; querystring &#125; <span class="keyword">from</span> <span class="string">'vux'</span></span><br><span class="line"></span><br><span class="line">querystring.parse(<span class="string">'a=b&amp;c=d'</span>) <span class="comment">// &#123;a:'b',c:'d'&#125;, 默认参数为 location.search</span></span><br><span class="line"></span><br><span class="line">querystring.stringify(&#123;<span class="attr">a</span>:<span class="string">'b'</span>,<span class="attr">c</span>:<span class="string">'d'</span>&#125;) <span class="comment">// 'a=b&amp;c=d'，注意不支持复杂嵌套的结构</span></span><br></pre></td></tr></table></figure><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>以上的配置就已经满足了移动端开发的基本要求了，接下来如果想利用vux来进行移动端的开发，那么请参考vux官网。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;vue-cli&quot;&gt;&lt;a href=&quot;#vue-cli&quot; class=&quot;headerlink&quot; title=&quot;vue-cli&quot;&gt;&lt;/a&gt;vue-cli&lt;/h2&gt;&lt;p&gt;  &lt;code&gt;全局安装 vue-cli
   $ npm install --global vue
      
    
    </summary>
    
    
      <category term="vue" scheme="babylovelin.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>socket.io</title>
    <link href="babylovelin.github.io/2018/02/01/socletio/"/>
    <id>babylovelin.github.io/2018/02/01/socletio/</id>
    <published>2018-02-01T02:05:44.000Z</published>
    <updated>2018-03-19T06:00:48.906Z</updated>
    
    <content type="html"><![CDATA[<p>  实现功能：群体聊天，谁进了聊天室，谁离开了聊天室，一共有多少人</p><h2 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h2><p>  我们用express</p><p>  首先引用 <code>var express = require(&#39;express&#39;);</code></p><p>  实例化 <code>var app = express();</code></p><p>  设置需要绑定的服务器 <code>var server = require(&#39;http&#39;).Server(app);</code>这里就是app了</p><p>  将socket.io用在这个服务器上 <code>var io = require(&#39;socket.io&#39;)(server);</code></p><p>  引入node自带的path <code>var path = require(&#39;path&#39;);</code></p><p>  设置监听端口  <code>var port = process.env.PORT || 3000;</code></p><p>  设置路由</p><p>  <code>app.get(&#39;/&#39;, function(req, res) {    res.sendFile(__dirname + &#39;/public/index.html&#39;); 这里要在根目录下新建public文件夹，index.html  });</code></p><p>  socket连上时</p><p>  <code>io.on(&#39;connection&#39;,(socket)=&gt;{        在这里写入socket的操作        socket.on 接收来自客户端的socket        socket.emit 向客户端发送socket        socket.broadcast.emit 向客户端进行广播    })</code></p><p>  最后服务器监听端口</p><p>  <code>server.listen(port, () =&gt; {  console.log(&#39;Server listening at port %d&#39;, port);  });</code></p><h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">index.html</span><br><span class="line"></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">    &lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;head&gt;</span><br><span class="line">      &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">      &lt;title&gt;Socket.IO Chat Example&lt;/title&gt;</span><br><span class="line">      &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body&gt;</span><br><span class="line">      &lt;ul class=&quot;pages&quot;&gt;</span><br><span class="line">        &lt;li class=&quot;chat page&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;chatArea&quot;&gt;</span><br><span class="line">            &lt;ul class=&quot;messages&quot;&gt;&lt;/ul&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;input class=&quot;inputMessage&quot; placeholder=&quot;Type here...&quot; /&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li class=&quot;login page&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;form&quot;&gt;</span><br><span class="line">            &lt;h3 class=&quot;title&quot;&gt;What&apos;s your nickname?&lt;/h3&gt;</span><br><span class="line">            &lt;input class=&quot;usernameInput&quot; type=&quot;text&quot; maxlength=&quot;14&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">      &lt;script src=&quot;https://code.jquery.com/jquery-1.10.2.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">      &lt;script src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">      &lt;script src=&quot;/main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//main.js</span></span><br><span class="line"></span><br><span class="line">  $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> FADE_TIME = <span class="number">150</span>; <span class="comment">// ms</span></span><br><span class="line">  <span class="keyword">var</span> TYPING_TIMER_LENGTH = <span class="number">400</span>; <span class="comment">// ms</span></span><br><span class="line">  <span class="keyword">var</span> COLORS = [</span><br><span class="line">    <span class="string">'#e21400'</span>, <span class="string">'#91580f'</span>, <span class="string">'#f8a700'</span>, <span class="string">'#f78b00'</span>,</span><br><span class="line">    <span class="string">'#58dc00'</span>, <span class="string">'#287b00'</span>, <span class="string">'#a8f07a'</span>, <span class="string">'#4ae8c4'</span>,</span><br><span class="line">    <span class="string">'#3b88eb'</span>, <span class="string">'#3824aa'</span>, <span class="string">'#a700ff'</span>, <span class="string">'#d300e7'</span></span><br><span class="line">  ]; <span class="comment">//分配给用户名字的颜色</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Initialize variables 初始化变量</span></span><br><span class="line">  <span class="keyword">var</span> $<span class="built_in">window</span> = $(<span class="built_in">window</span>);</span><br><span class="line">  <span class="keyword">var</span> $usernameInput = $(<span class="string">'.usernameInput'</span>); <span class="comment">// Input for username</span></span><br><span class="line">  <span class="keyword">var</span> $messages = $(<span class="string">'.messages'</span>); <span class="comment">// Messages area</span></span><br><span class="line">  <span class="keyword">var</span> $inputMessage = $(<span class="string">'.inputMessage'</span>); <span class="comment">// Input message input box</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> $loginPage = $(<span class="string">'.login.page'</span>); <span class="comment">// The login page</span></span><br><span class="line">  <span class="keyword">var</span> $chatPage = $(<span class="string">'.chat.page'</span>); <span class="comment">// The chatroom page</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Prompt for setting a username</span></span><br><span class="line">  <span class="keyword">var</span> username;</span><br><span class="line">  <span class="keyword">var</span> connected = <span class="literal">false</span>; <span class="comment">//初始化未连接</span></span><br><span class="line">  <span class="keyword">var</span> typing = <span class="literal">false</span>; <span class="comment">//初始化 未正在打字</span></span><br><span class="line">  <span class="keyword">var</span> lastTypingTime; <span class="comment">// 上一次打字时间</span></span><br><span class="line">  <span class="keyword">var</span> $currentInput = $usernameInput.focus(); <span class="comment">//自动给焦点到input</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> socket = io(); <span class="comment">//开启socket</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//此函数用来显示现在有多少人正在连接</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addParticipantsMessage</span>(<span class="params">data</span>) </span>&#123;  <span class="comment">//这里的data就是socket发送的数据</span></span><br><span class="line">    <span class="keyword">var</span> message = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">if</span> (data.numUsers === <span class="number">1</span>) &#123;</span><br><span class="line">      message += <span class="string">"there's 1 participant"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      message += <span class="string">"there are "</span> + data.numUsers + <span class="string">" participants"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    log(message);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Sets the client's username 设置客户端用户名</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setUsername</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    username = cleanInput($usernameInput.val().trim()); <span class="comment">//去掉空格</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the username is valid 用户名存在，那么</span></span><br><span class="line">    <span class="keyword">if</span> (username) &#123;</span><br><span class="line">      $loginPage.fadeOut();</span><br><span class="line">      $chatPage.show();</span><br><span class="line">      $loginPage.off(<span class="string">'click'</span>); <span class="comment">//移除loginpage上面的click事件</span></span><br><span class="line">      $currentInput = $inputMessage.focus();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Tell the server your username 告诉服务器你叫什么</span></span><br><span class="line">      <span class="comment">// 服务器端 socket.on('add user')接收</span></span><br><span class="line">      socket.emit(<span class="string">'add user'</span>, username);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Sends a chat message  发送一条消息</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sendMessage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> message = $inputMessage.val();</span><br><span class="line">    <span class="comment">// Prevent markup from being injected into the message</span></span><br><span class="line">    message = cleanInput(message);</span><br><span class="line">    <span class="comment">// if there is a non-empty message and a socket connection</span></span><br><span class="line">    <span class="keyword">if</span> (message &amp;&amp; connected) &#123; <span class="comment">//如果有消息且链接正常，那么发送消息</span></span><br><span class="line">      $inputMessage.val(<span class="string">''</span>);</span><br><span class="line">      addChatMessage(&#123; <span class="comment">//构建前端页面显示样式的函数</span></span><br><span class="line">        username: username,</span><br><span class="line">        message: message</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// tell server to execute 'new message' and send along one parameter</span></span><br><span class="line">      socket.emit(<span class="string">'new message'</span>, message); <span class="comment">//告诉服务器有新的消息了</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Log a message 打印一条消息</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">message, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $el = $(<span class="string">'&lt;li&gt;'</span>).addClass(<span class="string">'log'</span>).text(message);</span><br><span class="line">    addMessageElement($el, options);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Adds the visual chat message to the message list</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addChatMessage</span>(<span class="params">data, options</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Don't fade the message in if there is an 'X was typing'</span></span><br><span class="line">    <span class="comment">// 如果有 x is typing 不要让这条消息消失</span></span><br><span class="line">    <span class="keyword">var</span> $typingMessages = getTypingMessages(data);</span><br><span class="line">    options = options || &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> ($typingMessages.length !== <span class="number">0</span>) &#123;</span><br><span class="line">      options.fade = <span class="literal">false</span>;</span><br><span class="line">      $typingMessages.remove();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> $usernameDiv = $(<span class="string">'&lt;span class="username"/&gt;'</span>)</span><br><span class="line">      .text(data.username)</span><br><span class="line">      .css(<span class="string">'color'</span>, getUsernameColor(data.username));</span><br><span class="line">    <span class="keyword">var</span> $messageBodyDiv = $(<span class="string">'&lt;span class="messageBody"&gt;'</span>)</span><br><span class="line">      .text(data.message);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> typingClass = data.typing ? <span class="string">'typing'</span> : <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $messageDiv = $(<span class="string">'&lt;li class="message"/&gt;'</span>)</span><br><span class="line">      .data(<span class="string">'username'</span>, data.username) <span class="comment">//将名字添加到li里面</span></span><br><span class="line">      .addClass(typingClass)</span><br><span class="line">      .append($usernameDiv, $messageBodyDiv);</span><br><span class="line"></span><br><span class="line">    addMessageElement($messageDiv, options);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Adds the visual chat typing message 添加“”正在输入”的文本</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addChatTyping</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    data.typing = <span class="literal">true</span>;</span><br><span class="line">    data.message = <span class="string">'is typing'</span>;</span><br><span class="line">    addChatMessage(data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Removes the visual chat typing message  移除  </span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">removeChatTyping</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    getTypingMessages(data).fadeOut(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      $(<span class="keyword">this</span>).remove();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Adds a message element to the messages and scrolls to the bottom</span></span><br><span class="line">  <span class="comment">// el - The element to add as a message</span></span><br><span class="line">  <span class="comment">// options.fade - If the element should fade-in (default = true)</span></span><br><span class="line">  <span class="comment">// options.prepend - If the element should prepend</span></span><br><span class="line">  <span class="comment">//   all other messages (default = false)</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addMessageElement</span>(<span class="params">el, options</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> $el = $(el);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Setup default options</span></span><br><span class="line">    <span class="keyword">if</span> (!options) &#123;</span><br><span class="line">      options = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> options.fade === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">      options.fade = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> options.prepend === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">      options.prepend = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Apply options</span></span><br><span class="line">    <span class="keyword">if</span> (options.fade) &#123;</span><br><span class="line">      $el.hide().fadeIn(FADE_TIME);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (options.prepend) &#123;</span><br><span class="line">      $messages.prepend($el);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      $messages.append($el);</span><br><span class="line">    &#125;</span><br><span class="line">    $messages[<span class="number">0</span>].scrollTop = $messages[<span class="number">0</span>].scrollHeight;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Prevents input from having injected markup</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">cleanInput</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $(<span class="string">'&lt;div/&gt;'</span>).text(input).html();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Updates the typing event</span></span><br><span class="line">  <span class="comment">// 在 oninput 的时候，调用</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateTyping</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (connected) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!typing) &#123;</span><br><span class="line">        typing = <span class="literal">true</span>;</span><br><span class="line">        socket.emit(<span class="string">'typing'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      lastTypingTime = (<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime();</span><br><span class="line"></span><br><span class="line">      setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> typingTimer = (<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime();</span><br><span class="line">        <span class="keyword">var</span> timeDiff = typingTimer - lastTypingTime;</span><br><span class="line">        <span class="keyword">if</span> (timeDiff &gt;= TYPING_TIMER_LENGTH &amp;&amp; typing) &#123;</span><br><span class="line">          socket.emit(<span class="string">'stop typing'</span>);</span><br><span class="line">          typing = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, TYPING_TIMER_LENGTH);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Gets the 'X is typing' messages of a user</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getTypingMessages</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $(<span class="string">'.typing.message'</span>).filter(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(<span class="keyword">this</span>).data(<span class="string">'username'</span>) === data.username;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Gets the color of a username through our hash function</span></span><br><span class="line">  <span class="comment">// 给username 分配一个颜色</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getUsernameColor</span>(<span class="params">username</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Compute hash code</span></span><br><span class="line">    <span class="keyword">var</span> hash = <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; username.length; i++) &#123;</span><br><span class="line">      hash = username.charCodeAt(i) + (hash &lt;&lt; <span class="number">5</span>) - hash;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Calculate color</span></span><br><span class="line">    <span class="keyword">var</span> index = <span class="built_in">Math</span>.abs(hash % COLORS.length);</span><br><span class="line">    <span class="keyword">return</span> COLORS[index];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Keyboard events</span></span><br><span class="line"></span><br><span class="line">  $<span class="built_in">window</span>.keydown(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Auto-focus the current input when a key is typed</span></span><br><span class="line">    <span class="keyword">if</span> (!(event.ctrlKey || event.metaKey || event.altKey)) &#123;</span><br><span class="line">      $currentInput.focus();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// When the client hits ENTER on their keyboard</span></span><br><span class="line">    <span class="keyword">if</span> (event.which === <span class="number">13</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (username) &#123;</span><br><span class="line">        sendMessage();</span><br><span class="line">        socket.emit(<span class="string">'stop typing'</span>);<span class="comment">//告诉服务器，我的消息写完了，可以发送</span></span><br><span class="line">        typing = <span class="literal">false</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setUsername();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  $inputMessage.on(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    updateTyping();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Click events</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Focus input when clicking anywhere on login page</span></span><br><span class="line">  $loginPage.click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $currentInput.focus();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Focus input when clicking on the message input's border</span></span><br><span class="line">  $inputMessage.click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $inputMessage.focus();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Socket events</span></span><br><span class="line">  <span class="comment">//socket事件</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Whenever the server emits 'login', log the login message</span></span><br><span class="line">  socket.on(<span class="string">'login'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    connected = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// Display the welcome message</span></span><br><span class="line">    <span class="keyword">var</span> message = <span class="string">"Welcome to Socket.IO Chat – "</span>;</span><br><span class="line">    log(message, &#123;</span><br><span class="line">      prepend: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    addParticipantsMessage(data);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Whenever the server emits 'new message', update the chat body</span></span><br><span class="line">  socket.on(<span class="string">'new message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    addChatMessage(data);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Whenever the server emits 'user joined', log it in the chat body</span></span><br><span class="line">  socket.on(<span class="string">'user joined'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    log(data.username + <span class="string">' joined'</span>);</span><br><span class="line">    addParticipantsMessage(data);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Whenever the server emits 'user left', log it in the chat body</span></span><br><span class="line">  socket.on(<span class="string">'user left'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    log(data.username + <span class="string">' left'</span>);</span><br><span class="line">    addParticipantsMessage(data);</span><br><span class="line">    removeChatTyping(data);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Whenever the server emits 'typing', show the typing message</span></span><br><span class="line">  socket.on(<span class="string">'typing'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    addChatTyping(data);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Whenever the server emits 'stop typing', kill the typing message</span></span><br><span class="line">  socket.on(<span class="string">'stop typing'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    removeChatTyping(data);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  socket.on(<span class="string">'disconnect'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    log(<span class="string">'you have been disconnected'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  socket.on(<span class="string">'reconnect'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    log(<span class="string">'you have been reconnected'</span>);</span><br><span class="line">    <span class="keyword">if</span> (username) &#123;</span><br><span class="line">      socket.emit(<span class="string">'add user'</span>, username);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  socket.on(<span class="string">'reconnect_error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    log(<span class="string">'attempt to reconnect has failed'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;  实现功能：群体聊天，谁进了聊天室，谁离开了聊天室，一共有多少人&lt;/p&gt;
&lt;h2 id=&quot;服务器端&quot;&gt;&lt;a href=&quot;#服务器端&quot; class=&quot;headerlink&quot; title=&quot;服务器端&quot;&gt;&lt;/a&gt;服务器端&lt;/h2&gt;&lt;p&gt;  我们用express&lt;/p&gt;
&lt;p&gt; 
      
    
    </summary>
    
    
      <category term="js" scheme="babylovelin.github.io/tags/js/"/>
    
  </entry>
  
</feed>
